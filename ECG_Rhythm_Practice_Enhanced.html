<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECG Rhythm Interpretation Practice | PDCCC EMS Program</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1a2d4a 50%, #0d1f35 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .welcome-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 8px 20px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 30px;
            margin-bottom: 25px;
        }

        .badge-text {
            color: #00ff88;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 2px;
        }

        h1 {
            font-size: 48px;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 15px;
        }

        h1 span {
            color: #00ff88;
        }

        .subtitle {
            font-size: 18px;
            color: #8fa3b8;
            max-width: 500px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 16px;
            padding: 25px 20px;
            text-align: center;
        }

        .stat-icon {
            font-size: 28px;
        }

        .stat-num {
            font-size: 32px;
            font-weight: 700;
            color: #00ff88;
            margin-top: 10px;
        }

        .stat-label {
            font-size: 13px;
            color: #6b7c8a;
            margin-top: 5px;
        }

        .form-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(0, 255, 136, 0.15);
            border-radius: 24px;
            padding: 35px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            color: #8fa3b8;
            font-size: 14px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            font-size: 18px;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            color: white;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: #00ff88;
        }

        .category-section {
            margin-bottom: 25px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-title {
            color: #8fa3b8;
            font-size: 14px;
            font-weight: 500;
        }

        .select-all-btn {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: #00ff88;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-all-btn:hover {
            background: rgba(0, 255, 136, 0.2);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .category-checkbox {
            display: none;
        }

        .category-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: rgba(255,255,255,0.02);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-label:hover {
            border-color: rgba(0, 255, 136, 0.3);
            background: rgba(0, 255, 136, 0.05);
        }

        .category-checkbox:checked + .category-label {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .category-name {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #c0c8d0;
            font-size: 13px;
        }

        .category-checkbox:checked + .category-label .category-name {
            color: white;
        }

        .check-icon {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: transparent;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .category-checkbox:checked + .category-label .check-icon {
            background: #00ff88;
            border-color: #00ff88;
            color: #0a1628;
        }

        .category-count {
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .question-count-section {
            margin-bottom: 25px;
        }

        .count-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .count-input-wrapper {
            flex: 1;
            position: relative;
        }

        .count-input {
            width: 100%;
            padding: 14px 20px;
            font-size: 18px;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            color: white;
            outline: none;
            text-align: center;
        }

        .count-input:focus {
            border-color: #00ff88;
        }

        .quick-select-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 10px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            color: #8fa3b8;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            border-color: rgba(0, 255, 136, 0.5);
            color: white;
        }

        .quick-btn.active {
            background: rgba(0, 255, 136, 0.15);
            border-color: #00ff88;
            color: #00ff88;
        }

        .available-count {
            text-align: center;
            margin-top: 12px;
            color: #6b7c8a;
            font-size: 13px;
        }

        .available-count strong {
            color: #00ff88;
        }

        .btn-primary {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            border: none;
            border-radius: 12px;
            color: #0a1628;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: rgba(100,100,100,0.3);
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn-secondary {
            padding: 18px;
            font-size: 16px;
            font-weight: 700;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .selected-summary {
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-text {
            color: #8fa3b8;
            font-size: 14px;
        }

        .summary-text strong {
            color: #00ff88;
        }

        .summary-categories {
            color: #6b7c8a;
            font-size: 12px;
            max-width: 60%;
            text-align: right;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .student-info {
            color: #8fa3b8;
            font-size: 14px;
        }

        .student-info .name {
            color: #00ff88;
        }

        .category-info {
            color: #6b7c8a;
            font-size: 12px;
            margin-top: 4px;
        }

        .score-badge {
            background: rgba(0, 255, 136, 0.1);
            padding: 10px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .score-num {
            color: #00ff88;
            font-weight: 700;
            font-size: 18px;
        }

        .score-label {
            color: #6b7c8a;
            font-size: 14px;
        }

        .progress-bar {
            background: rgba(0, 255, 136, 0.1);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .question-counter {
            text-align: center;
            margin-bottom: 20px;
        }

        .counter-badge {
            background: rgba(255,255,255,0.05);
            padding: 8px 20px;
            border-radius: 20px;
            color: #8fa3b8;
            font-size: 14px;
        }

        .counter-badge strong {
            color: white;
        }

        .ecg-container {
            background: rgba(0,0,0,0.6);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
        }

        .ecg-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .ecg-label {
            color: #00ff88;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 50, 50, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
        }

        .live-indicator.paused {
            background: rgba(255, 200, 50, 0.2);
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #ff5050;
            border-radius: 50%;
            animation: pulse 1s ease-in-out infinite;
        }

        .live-indicator.paused .live-dot {
            background: #ffc832;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        .live-text {
            color: #ff5050;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .live-indicator.paused .live-text {
            color: #ffc832;
        }

        .pause-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid rgba(0, 255, 136, 0.4);
            color: #00ff88;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 10px;
        }

        .pause-btn:hover {
            background: rgba(0, 255, 136, 0.25);
            transform: scale(1.02);
        }

        .pause-btn .pause-icon {
            font-size: 12px;
        }

        .ecg-category {
            color: #6b7c8a;
            font-size: 12px;
        }

        .ecg-canvas-wrapper {
            display: flex;
            justify-content: center;
            overflow: hidden;
            background: #0a0f0a;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        #ecgCanvas {
            max-width: 100%;
        }

        /* Monitor bezel effect */
        .monitor-bezel {
            position: relative;
        }

        .monitor-bezel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(0,0,0,0.3) 0%, 
                transparent 5%, 
                transparent 95%, 
                rgba(0,0,0,0.3) 100%);
            pointer-events: none;
            border-radius: 8px;
        }

        /* Parameter Input Section */
        .param-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 100, 60, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
        }

        .param-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .param-title {
            color: #00ff88;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .param-instructions {
            color: #8fa3b8;
            font-size: 12px;
        }

        .param-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .param-item {
            text-align: center;
        }

        .param-label {
            color: #6b7c8a;
            font-size: 11px;
            margin-bottom: 6px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .param-input {
            width: 100%;
            padding: 12px 8px;
            font-size: 14px;
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            color: white;
            outline: none;
            text-align: center;
            transition: all 0.2s;
        }

        .param-input:focus {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.05);
        }

        .param-input::placeholder {
            color: #4a5568;
            font-size: 12px;
        }

        .param-input.correct {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
        }

        .param-input.incorrect {
            border-color: #ff5050;
            background: rgba(255, 80, 80, 0.15);
            color: #ff5050;
        }

        .param-input.show-answer {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
        }

        .param-feedback {
            font-size: 10px;
            margin-top: 4px;
            height: 14px;
        }

        .param-feedback.correct {
            color: #00ff88;
        }

        .param-feedback.incorrect {
            color: #ff5050;
        }

        .check-params-btn {
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            font-size: 14px;
            font-weight: 600;
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid rgba(0, 255, 136, 0.4);
            border-radius: 8px;
            color: #00ff88;
            cursor: pointer;
            transition: all 0.2s;
        }

        .check-params-btn:hover {
            background: rgba(0, 255, 136, 0.25);
        }

        .check-params-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .question-text {
            color: white;
            font-size: 22px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 25px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .option-btn {
            padding: 18px 20px;
            font-size: 15px;
            font-weight: 500;
            text-align: left;
            background: rgba(255,255,255,0.03);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option-btn:hover:not(:disabled) {
            border-color: rgba(0, 255, 136, 0.5);
            background: rgba(0, 255, 136, 0.05);
        }

        .option-btn.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .option-btn.correct {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .option-btn.wrong {
            border-color: #ff5050;
            background: rgba(255, 80, 80, 0.2);
            color: #ff5050;
        }

        .option-letter {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            color: #8fa3b8;
            flex-shrink: 0;
        }

        .option-btn.correct .option-letter {
            background: #00ff88;
            color: #0a1628;
        }

        .option-btn.wrong .option-letter {
            background: #ff5050;
            color: #0a1628;
        }

        .feedback-panel {
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .feedback-panel.correct-panel {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .feedback-panel.wrong-panel {
            background: rgba(255, 80, 80, 0.1);
            border: 1px solid rgba(255, 80, 80, 0.3);
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .feedback-icon {
            font-size: 28px;
        }

        .feedback-title {
            font-size: 20px;
            font-weight: 700;
        }

        .correct-panel .feedback-title {
            color: #00ff88;
        }

        .wrong-panel .feedback-title {
            color: #ff5050;
        }

        .correct-answer {
            color: #8fa3b8;
            margin-bottom: 15px;
        }

        .correct-answer strong {
            color: #00ff88;
        }

        .characteristics-box {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 18px;
        }

        .characteristics-label {
            color: #6b7c8a;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .characteristics-text {
            color: #c0c8d0;
            font-size: 14px;
            line-height: 1.6;
        }

        .characteristics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .char-item {
            color: #8fa3b8;
            font-size: 13px;
        }

        .char-item .label {
            color: #6b7c8a;
        }

        .char-item .value {
            color: #00ff88;
        }

        .results-header {
            text-align: center;
            margin-bottom: 35px;
        }

        .results-icon {
            font-size: 72px;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .results-subtitle {
            color: #8fa3b8;
            font-size: 18px;
        }

        .score-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-card.passed {
            border-color: rgba(0, 255, 136, 0.4);
        }

        .score-card.failed {
            border-color: rgba(255, 80, 80, 0.4);
        }

        .score-percentage {
            font-size: 72px;
            font-weight: 800;
            color: #00ff88;
        }

        .failed .score-percentage {
            color: #ff5050;
        }

        .score-fraction {
            color: #8fa3b8;
            font-size: 18px;
            margin-top: 10px;
        }

        .pass-badge {
            display: inline-block;
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1px;
            margin-top: 20px;
        }

        .failed .pass-badge {
            background: rgba(255, 80, 80, 0.15);
            color: #ff5050;
        }

        .breakdown-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .breakdown-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .breakdown-item {
            margin-bottom: 18px;
        }

        .breakdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .breakdown-name {
            color: #c0c8d0;
            font-size: 14px;
        }

        .breakdown-score {
            font-size: 14px;
            font-weight: 600;
        }

        .breakdown-score.good {
            color: #00ff88;
        }

        .breakdown-score.medium {
            color: #ffd700;
        }

        .breakdown-score.poor {
            color: #ff5050;
        }

        .breakdown-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .breakdown-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .breakdown-fill.good {
            background: #00ff88;
        }

        .breakdown-fill.medium {
            background: #ffd700;
        }

        .breakdown-fill.poor {
            background: #ff5050;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .actions-grid.two-col {
            grid-template-columns: repeat(2, 1fr);
        }

        .missed-questions {
            background: rgba(255, 80, 80, 0.05);
            border: 1px solid rgba(255, 80, 80, 0.2);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
        }

        .missed-title {
            color: #ff5050;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .missed-list {
            display: grid;
            gap: 15px;
        }

        .missed-item {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 18px;
        }

        .missed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .missed-category {
            color: #8fa3b8;
            font-size: 12px;
        }

        .missed-id {
            color: #6b7c8a;
            font-size: 12px;
        }

        .missed-answer {
            color: #ff5050;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .missed-answer .label {
            color: #8fa3b8;
        }

        .missed-correct {
            color: #00ff88;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .missed-correct .label {
            color: #8fa3b8;
        }

        .missed-explanation {
            color: #6b7c8a;
            font-size: 13px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .param-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .actions-grid.two-col {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="container">
        <div class="welcome-header">
            <div class="badge">
                <span class="badge-text">PDCCC EMS PROGRAM</span>
            </div>
            <h1>ECG Rhythm<br><span>Interpretation</span></h1>
            <p class="subtitle">Master cardiac rhythm recognition with our comprehensive practice module aligned to CoAEMSP standards</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-num" id="totalRhythms">310</div>
                <div class="stat-label">Practice Rhythms</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÅ</div>
                <div class="stat-num" id="totalCategories">6</div>
                <div class="stat-label">Categories</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-num">85%</div>
                <div class="stat-label">Passing Score</div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label class="form-label">Student Name</label>
                <input type="text" id="studentNameInput" class="form-input" placeholder="Enter your full name">
            </div>

            <div class="category-section">
                <div class="category-header">
                    <span class="category-title">Select Categories to Practice</span>
                    <button id="selectAllBtn" class="select-all-btn">Select All</button>
                </div>
                <div class="categories-grid" id="categoriesGrid"></div>
            </div>

            <div class="question-count-section">
                <label class="form-label">Number of Questions</label>
                <div class="count-controls">
                    <div class="count-input-wrapper">
                        <input type="number" id="questionCountInput" class="count-input" value="20" min="5" max="310">
                    </div>
                    <div class="quick-select-btns">
                        <button class="quick-btn" data-count="10">10</button>
                        <button class="quick-btn active" data-count="20">20</button>
                        <button class="quick-btn" data-count="50">50</button>
                        <button class="quick-btn" data-count="100">All</button>
                    </div>
                </div>
                <p class="available-count">Available: <strong id="availableCount">0</strong> rhythms from selected categories</p>
            </div>

            <div class="selected-summary">
                <span class="summary-text">Ready: <strong id="selectedCount">0</strong> questions</span>
                <span class="summary-categories" id="summaryCategories">No categories selected</span>
            </div>

            <button id="startBtn" class="btn-primary" disabled>Begin Practice Session ‚Üí</button>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quizScreen" class="container hidden">
        <div class="quiz-header">
            <div>
                <div class="student-info">Student: <span class="name" id="quizStudentName"></span></div>
                <div class="category-info" id="quizCategory"></div>
            </div>
            <div class="score-badge">
                <span class="score-num" id="currentScore">0/0</span>
                <span class="score-label">correct</span>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <div class="question-counter">
            <span class="counter-badge">Question <strong id="currentQ">1</strong> of <span id="totalQ">200</span></span>
        </div>

        <div class="ecg-container">
            <div class="ecg-header">
                <span class="ecg-label">
                    ECG RHYTHM STRIP
                    <span class="live-indicator" id="liveIndicator">
                        <span class="live-dot"></span>
                        <span class="live-text" id="liveText">LIVE</span>
                    </span>
                    <button class="pause-btn" id="pauseBtn" onclick="togglePause()">
                        <span class="pause-icon" id="pauseIcon">‚è∏</span>
                        <span id="pauseBtnText">Pause</span>
                    </button>
                </span>
                <span class="ecg-category" id="ecgCategory"></span>
            </div>
            <div class="ecg-canvas-wrapper monitor-bezel">
                <canvas id="ecgCanvas" width="700" height="180"></canvas>
            </div>
            
            <!-- Parameter Input Section -->
            <div class="param-section">
                <div class="param-header">
                    <span class="param-title">üìù CALCULATE RHYTHM PARAMETERS</span>
                    <span class="param-instructions">Enter your measurements before identifying the rhythm</span>
                </div>
                <div class="param-grid">
                    <div class="param-item">
                        <div class="param-label">RATE (BPM)</div>
                        <input type="text" id="paramRate" class="param-input" placeholder="e.g., 72">
                        <div class="param-feedback" id="feedbackRate"></div>
                    </div>
                    <div class="param-item">
                        <div class="param-label">REGULARITY</div>
                        <input type="text" id="paramRegularity" class="param-input" placeholder="e.g., Regular">
                        <div class="param-feedback" id="feedbackRegularity"></div>
                    </div>
                    <div class="param-item">
                        <div class="param-label">PRI (SEC)</div>
                        <input type="text" id="paramPRI" class="param-input" placeholder="e.g., 0.16">
                        <div class="param-feedback" id="feedbackPRI"></div>
                    </div>
                    <div class="param-item">
                        <div class="param-label">QRS WIDTH (SEC)</div>
                        <input type="text" id="paramQRS" class="param-input" placeholder="e.g., 0.08">
                        <div class="param-feedback" id="feedbackQRS"></div>
                    </div>
                </div>
                <button id="checkParamsBtn" class="check-params-btn">‚úì Check My Measurements</button>
            </div>
        </div>

        <h2 class="question-text">Identify this cardiac rhythm:</h2>

        <div class="options-grid" id="optionsGrid"></div>

        <div id="feedbackPanel" class="feedback-panel hidden">
            <div class="feedback-header">
                <span class="feedback-icon" id="feedbackIcon"></span>
                <span class="feedback-title" id="feedbackTitle"></span>
            </div>
            <p class="correct-answer hidden" id="correctAnswerText"></p>
            <div class="characteristics-box">
                <div class="characteristics-label">KEY CHARACTERISTICS:</div>
                <p class="characteristics-text" id="characteristicsText"></p>
                <div class="characteristics-grid">
                    <div class="char-item">
                        <span class="label">P Wave: </span>
                        <span class="value" id="charPWave"></span>
                    </div>
                    <div class="char-item">
                        <span class="label">PR Interval: </span>
                        <span class="value" id="charPR"></span>
                    </div>
                </div>
            </div>
            <button id="nextBtn" class="btn-primary" style="margin-top: 20px;">Next Question ‚Üí</button>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="resultsScreen" class="container hidden">
        <div class="results-header">
            <div class="results-icon" id="resultsIcon">üèÜ</div>
            <h1 class="results-title" id="resultsTitle">Congratulations!</h1>
            <p class="results-subtitle" id="resultsSubtitle"></p>
        </div>

        <div class="score-card" id="scoreCard">
            <div class="score-percentage" id="scorePercentage">0%</div>
            <div class="score-fraction" id="scoreFraction">0 out of 0 correct</div>
            <div class="pass-badge" id="passBadge">‚úì PASSED</div>
        </div>

        <div class="breakdown-card">
            <h3 class="breakdown-title">Performance by Category</h3>
            <div id="breakdownList"></div>
        </div>

        <div class="actions-grid" id="actionsGrid">
            <button id="certificateBtn" class="btn-primary">üìú Download Certificate</button>
            <button id="restartBtn" class="btn-secondary">üîÑ Practice Again</button>
        </div>

        <div class="missed-questions hidden" id="missedQuestions">
            <h3 class="missed-title">üìù Review Missed Questions</h3>
            <div class="missed-list" id="missedList"></div>
        </div>
    </div>

    <script>
        // Category definitions with CoAEMSP alignment
        const CATEGORIES = {
            'Sinus Rhythms': { icon: 'üíö', count: 40, fullName: 'Sinus Rhythms' },
            'Atrial Dysrhythmias': { icon: 'üíõ', count: 60, fullName: 'Atrial Dysrhythmias' },
            'AV Node Dysrhythmias': { icon: 'üß°', count: 50, fullName: 'AV Node Dysrhythmias' },
            'Ventricular Dysrhythmias': { icon: '‚ù§Ô∏è', count: 60, fullName: 'Ventricular Dysrhythmias' },
            'Heart Blocks': { icon: 'üíú', count: 60, fullName: 'AV Blocks' },
            'Pacemaker and Other': { icon: 'üíô', count: 40, fullName: 'Pacemaker & Special Conditions' }
        };

        // Complete ECG rhythm database
        const ECG_RHYTHMS = [
            // SINUS RHYTHMS (1-40)
            { id: 1, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '72 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'Classic NSR with all normal intervals' },
            { id: 2, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '68 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.18 sec', qrsWidth: '0.10 sec', characteristics: 'NSR with slightly prolonged PR' },
            { id: 3, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '80 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.14 sec', qrsWidth: '0.08 sec', characteristics: 'NSR at upper normal rate' },
            { id: 4, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '62 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'NSR at lower normal rate' },
            { id: 5, category: 'Sinus Rhythms', rhythm: 'Sinus bradycardia', rate: '52 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.18 sec', qrsWidth: '0.08 sec', characteristics: 'Rate < 60, athlete or beta-blocker effect' },
            { id: 6, category: 'Sinus Rhythms', rhythm: 'Sinus bradycardia', rate: '48 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.10 sec', characteristics: 'Moderate bradycardia, may be symptomatic' },
            { id: 7, category: 'Sinus Rhythms', rhythm: 'Sinus bradycardia', rate: '44 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.20 sec', qrsWidth: '0.08 sec', characteristics: 'Significant bradycardia, monitor closely' },
            { id: 8, category: 'Sinus Rhythms', rhythm: 'Sinus bradycardia', rate: '38 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'Severe bradycardia, likely symptomatic' },
            { id: 9, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '108 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.14 sec', qrsWidth: '0.08 sec', characteristics: 'Mild tachycardia, anxiety or pain' },
            { id: 10, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '118 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.12 sec', qrsWidth: '0.08 sec', characteristics: 'Moderate tachycardia, fever or hypovolemia' },
            { id: 11, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '132 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.12 sec', qrsWidth: '0.10 sec', characteristics: 'Significant tachycardia, assess for cause' },
            { id: 12, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '145 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.10 sec', qrsWidth: '0.08 sec', characteristics: 'Severe tachycardia, P waves may merge with T' },
            { id: 13, category: 'Sinus Rhythms', rhythm: 'Sinus arrhythmia', rate: '58-78 bpm', regularity: 'Irregular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'Rate varies with respiration, normal variant' },
            { id: 14, category: 'Sinus Rhythms', rhythm: 'Sinus arrhythmia', rate: '62-82 bpm', regularity: 'Irregular', pWave: 'Present, upright', prInterval: '0.14 sec', qrsWidth: '0.08 sec', characteristics: 'Classic respiratory variation' },
            { id: 15, category: 'Sinus Rhythms', rhythm: 'Sinus arrhythmia', rate: '55-75 bpm', regularity: 'Irregular', pWave: 'Present, upright', prInterval: '0.18 sec', qrsWidth: '0.10 sec', characteristics: 'More pronounced in younger patients' },
            { id: 16, category: 'Sinus Rhythms', rhythm: 'Sinus arrest (sinus pause)', rate: 'Variable with pause', regularity: 'Irregular', pWave: 'Absent during pause', prInterval: 'N/A during pause', qrsWidth: '0.08 sec', characteristics: 'Pause > 2x normal P-P interval' },
            { id: 17, category: 'Sinus Rhythms', rhythm: 'Sinus arrest (sinus pause)', rate: '68 bpm with 3 sec pause', regularity: 'Irregular', pWave: 'Missing during pause', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'SA node failure with escape beat' },
            { id: 18, category: 'Sinus Rhythms', rhythm: 'Sinus arrest (sinus pause)', rate: '72 bpm with 2.4 sec pause', regularity: 'Irregular', pWave: 'Absent during pause', prInterval: 'N/A', qrsWidth: '0.10 sec', characteristics: 'Brief sinus arrest, junctional escape' },
            { id: 19, category: 'Sinus Rhythms', rhythm: 'Sinoatrial (SA) exit block', rate: '60-75 bpm', regularity: 'Irregular', pWave: 'Missing at intervals', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'Dropped P-QRS cycles, pause = 2x P-P' },
            { id: 20, category: 'Sinus Rhythms', rhythm: 'Sinoatrial (SA) exit block', rate: '58-70 bpm', regularity: 'Irregular', pWave: 'Periodically absent', prInterval: '0.18 sec', qrsWidth: '0.08 sec', characteristics: 'Type II SA block pattern' },
            { id: 21, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '75 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.20 sec', qrsWidth: '0.08 sec', characteristics: 'NSR with PR at upper limit of normal' },
            { id: 22, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '88 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'NSR, slightly elevated rate' },
            { id: 23, category: 'Sinus Rhythms', rhythm: 'Sinus bradycardia', rate: '55 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'Mild bradycardia, likely asymptomatic' },
            { id: 24, category: 'Sinus Rhythms', rhythm: 'Sinus bradycardia', rate: '42 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.18 sec', qrsWidth: '0.08 sec', characteristics: 'Marked bradycardia, assess symptoms' },
            { id: 25, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '102 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.14 sec', qrsWidth: '0.08 sec', characteristics: 'Just above normal rate, mild tachycardia' },
            { id: 26, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '125 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.12 sec', qrsWidth: '0.08 sec', characteristics: 'P waves visible, consider underlying cause' },
            { id: 27, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '138 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.10 sec', qrsWidth: '0.08 sec', characteristics: 'High rate, P waves may be difficult to see' },
            { id: 28, category: 'Sinus Rhythms', rhythm: 'Sinus arrhythmia', rate: '65-85 bpm', regularity: 'Irregular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'Rate increases with inspiration' },
            { id: 29, category: 'Sinus Rhythms', rhythm: 'Sinus arrest (sinus pause)', rate: '70 bpm with 2.8 sec pause', regularity: 'Irregular', pWave: 'Absent during pause', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Moderate pause, may need pacing evaluation' },
            { id: 30, category: 'Sinus Rhythms', rhythm: 'Sinoatrial (SA) exit block', rate: '62-68 bpm', regularity: 'Irregular', pWave: 'Dropped periodically', prInterval: '0.16 sec', qrsWidth: '0.10 sec', characteristics: 'Wenckebach-type SA block' },
            { id: 31, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '65 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.14 sec', qrsWidth: '0.06 sec', characteristics: 'Narrow QRS, healthy conduction' },
            { id: 32, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '78 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.10 sec', characteristics: 'QRS at upper limit of normal' },
            { id: 33, category: 'Sinus Rhythms', rhythm: 'Sinus bradycardia', rate: '50 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.20 sec', qrsWidth: '0.08 sec', characteristics: 'Borderline first-degree block' },
            { id: 34, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '115 bpm', regularity: 'Regular', pWave: 'Present, peaked', prInterval: '0.12 sec', qrsWidth: '0.08 sec', characteristics: 'Peaked P waves suggest right atrial enlargement' },
            { id: 35, category: 'Sinus Rhythms', rhythm: 'Sinus arrhythmia', rate: '60-80 bpm', regularity: 'Irregular', pWave: 'Present, upright', prInterval: '0.18 sec', qrsWidth: '0.08 sec', characteristics: 'Common in pediatric patients' },
            { id: 36, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '70 bpm', regularity: 'Regular', pWave: 'Present, biphasic in V1', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'Normal variant P wave morphology' },
            { id: 37, category: 'Sinus Rhythms', rhythm: 'Sinus bradycardia', rate: '46 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'May see in hypothyroid or increased ICP' },
            { id: 38, category: 'Sinus Rhythms', rhythm: 'Sinus tachycardia', rate: '140 bpm', regularity: 'Regular', pWave: 'Present, merged with T', prInterval: '0.10 sec', qrsWidth: '0.08 sec', characteristics: 'P waves superimposed on preceding T waves' },
            { id: 39, category: 'Sinus Rhythms', rhythm: 'Sinus arrest (sinus pause)', rate: '74 bpm with 3.5 sec pause', regularity: 'Irregular', pWave: 'Absent during pause', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Significant pause, watch for syncope' },
            { id: 40, category: 'Sinus Rhythms', rhythm: 'Normal sinus rhythm', rate: '82 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.18 sec', qrsWidth: '0.08 sec', characteristics: 'Textbook NSR presentation' },

            // ATRIAL DYSRHYTHMIAS (101-160)
            { id: 101, category: 'Atrial Dysrhythmias', rhythm: 'Atrial fibrillation (AF) - rapid ventricular response', rate: '142 bpm', regularity: 'Irregularly irregular', pWave: 'Absent; fibrillatory waves', prInterval: 'None', qrsWidth: '0.08 sec', characteristics: 'New onset AF, may require rate control' },
            { id: 102, category: 'Atrial Dysrhythmias', rhythm: 'Atrial fibrillation (AF) - controlled', rate: '78 bpm', regularity: 'Irregularly irregular', pWave: 'Absent; fibrillatory waves', prInterval: 'None', qrsWidth: '0.08 sec', characteristics: 'Well-controlled on medications' },
            { id: 103, category: 'Atrial Dysrhythmias', rhythm: 'Atrial fibrillation (AF)', rate: '115 bpm', regularity: 'Irregularly irregular', pWave: 'Absent', prInterval: 'None', qrsWidth: '0.10 sec', characteristics: 'Moderate ventricular response' },
            { id: 104, category: 'Atrial Dysrhythmias', rhythm: 'Atrial flutter - 2:1 conduction', rate: 'Atrial 300, Vent 150', regularity: 'Regular', pWave: 'Sawtooth flutter waves', prInterval: 'Not measurable', qrsWidth: '0.08 sec', characteristics: 'Classic 2:1 flutter pattern' },
            { id: 105, category: 'Atrial Dysrhythmias', rhythm: 'Atrial flutter - 4:1 conduction', rate: 'Atrial 300, Vent 75', regularity: 'Regular', pWave: 'Sawtooth flutter waves', prInterval: 'Not measurable', qrsWidth: '0.08 sec', characteristics: 'Well-controlled flutter' },
            { id: 106, category: 'Atrial Dysrhythmias', rhythm: 'Atrial flutter - variable block', rate: 'Atrial 280, Vent 70-140', regularity: 'Irregular', pWave: 'Sawtooth pattern', prInterval: 'Not measurable', qrsWidth: '0.08 sec', characteristics: 'Variable AV conduction' },
            { id: 107, category: 'Atrial Dysrhythmias', rhythm: 'PAC - premature atrial contraction', rate: '75 bpm with early beats', regularity: 'Irregular', pWave: 'Different morphology on PAC', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: 'Early beat with abnormal P wave' },
            { id: 108, category: 'Atrial Dysrhythmias', rhythm: 'PAC - bigeminy', rate: '70 bpm', regularity: 'Regular irregularity', pWave: 'Alternating normal/abnormal', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: 'Every other beat is PAC' },
            { id: 109, category: 'Atrial Dysrhythmias', rhythm: 'PAC - trigeminy', rate: '72 bpm', regularity: 'Regular irregularity', pWave: 'Every 3rd abnormal', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: 'PAC every third beat' },
            { id: 110, category: 'Atrial Dysrhythmias', rhythm: 'PAC - couplet', rate: '68 bpm', regularity: 'Irregular', pWave: 'Two consecutive abnormal', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: 'Two PACs in a row' },
            { id: 111, category: 'Atrial Dysrhythmias', rhythm: 'Multifocal atrial tachycardia (MAT)', rate: '118 bpm', regularity: 'Irregular', pWave: '‚â•3 different P wave morphologies', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: 'Common in COPD patients' },
            { id: 112, category: 'Atrial Dysrhythmias', rhythm: 'Multifocal atrial tachycardia (MAT)', rate: '125 bpm', regularity: 'Irregular', pWave: 'Multiple P wave shapes', prInterval: 'Variable', qrsWidth: '0.10 sec', characteristics: 'Chaotic atrial rhythm' },
            { id: 113, category: 'Atrial Dysrhythmias', rhythm: 'Wandering atrial pacemaker (WAP)', rate: '68 bpm', regularity: 'Irregular', pWave: '‚â•3 different morphologies', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: 'Rate < 100, multiple pacemaker sites' },
            { id: 114, category: 'Atrial Dysrhythmias', rhythm: 'PSVT (paroxysmal supraventricular tachycardia)', rate: '178 bpm', regularity: 'Regular', pWave: 'Hidden in QRS or T', prInterval: 'Not measurable', qrsWidth: '0.08 sec', characteristics: 'Sudden onset, narrow QRS' },
            { id: 115, category: 'Atrial Dysrhythmias', rhythm: 'PSVT', rate: '195 bpm', regularity: 'Regular', pWave: 'Not visible', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Very rapid, responds to vagal maneuvers' },
            { id: 116, category: 'Atrial Dysrhythmias', rhythm: 'PSVT', rate: '162 bpm', regularity: 'Regular', pWave: 'Retrograde P waves', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'AVNRT most common type' },
            { id: 117, category: 'Atrial Dysrhythmias', rhythm: 'Atrial tachycardia', rate: '155 bpm', regularity: 'Regular', pWave: 'Abnormal but consistent', prInterval: '0.12 sec', qrsWidth: '0.08 sec', characteristics: 'Ectopic atrial focus, P before each QRS' },
            { id: 118, category: 'Atrial Dysrhythmias', rhythm: 'Atrial tachycardia', rate: '168 bpm', regularity: 'Regular', pWave: 'Peaked, abnormal axis', prInterval: '0.14 sec', qrsWidth: '0.08 sec', characteristics: 'Digitalis toxicity consideration' },
            { id: 119, category: 'Atrial Dysrhythmias', rhythm: 'Atrial fibrillation with RVR', rate: '165 bpm', regularity: 'Irregularly irregular', pWave: 'Absent', prInterval: 'None', qrsWidth: '0.08 sec', characteristics: 'Rapid, needs immediate rate control' },
            { id: 120, category: 'Atrial Dysrhythmias', rhythm: 'Atrial fibrillation - slow', rate: '55 bpm', regularity: 'Irregularly irregular', pWave: 'Absent', prInterval: 'None', qrsWidth: '0.08 sec', characteristics: 'May indicate AV node disease' },
            { id: 121, category: 'Atrial Dysrhythmias', rhythm: 'Atrial flutter - 3:1', rate: 'Atrial 300, Vent 100', regularity: 'Regular', pWave: 'Sawtooth', prInterval: 'Not measurable', qrsWidth: '0.08 sec', characteristics: 'Unusual ratio, partially treated' },
            { id: 122, category: 'Atrial Dysrhythmias', rhythm: 'PAC with aberrancy', rate: '72 bpm', regularity: 'Irregular', pWave: 'Early abnormal P', prInterval: '0.14 sec', qrsWidth: '0.14 sec (wide on PAC)', characteristics: 'Wide QRS on PAC mimics PVC' },
            { id: 123, category: 'Atrial Dysrhythmias', rhythm: 'Atrial fibrillation', rate: '92 bpm', regularity: 'Irregularly irregular', pWave: 'Fibrillatory baseline', prInterval: 'None', qrsWidth: '0.08 sec', characteristics: 'Rate controlled, chronic AF' },
            { id: 124, category: 'Atrial Dysrhythmias', rhythm: 'Atrial flutter - typical', rate: 'Atrial 300, Vent 75', regularity: 'Regular', pWave: 'Classic sawtooth II, III, aVF', prInterval: 'Not measurable', qrsWidth: '0.08 sec', characteristics: 'Counterclockwise flutter' },
            { id: 125, category: 'Atrial Dysrhythmias', rhythm: 'Ectopic atrial rhythm', rate: '65 bpm', regularity: 'Regular', pWave: 'Inverted in inferior leads', prInterval: '0.14 sec', qrsWidth: '0.08 sec', characteristics: 'Low atrial focus' },
            { id: 126, category: 'Atrial Dysrhythmias', rhythm: 'AF with slow ventricular response', rate: '48 bpm', regularity: 'Irregularly irregular', pWave: 'Absent', prInterval: 'None', qrsWidth: '0.08 sec', characteristics: 'Over-treated or sick sinus' },
            { id: 127, category: 'Atrial Dysrhythmias', rhythm: 'PAC - frequent', rate: '82 bpm', regularity: 'Irregular', pWave: 'Multiple abnormal', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: '>6 PACs/minute' },
            { id: 128, category: 'Atrial Dysrhythmias', rhythm: 'PSVT - AVNRT', rate: '185 bpm', regularity: 'Regular', pWave: 'Pseudo R\' in V1', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Typical slow-fast AVNRT' },
            { id: 129, category: 'Atrial Dysrhythmias', rhythm: 'Atrial flutter - atypical', rate: 'Atrial 240, Vent 80', regularity: 'Regular', pWave: 'Positive in inferior leads', prInterval: 'Not measurable', qrsWidth: '0.08 sec', characteristics: 'Clockwise or scar-related' },
            { id: 130, category: 'Atrial Dysrhythmias', rhythm: 'AF with aberrant conduction', rate: '138 bpm', regularity: 'Irregularly irregular', pWave: 'Absent', prInterval: 'None', qrsWidth: '0.14 sec', characteristics: 'Wide QRS, rate-related BBB' },

            // AV NODE DYSRHYTHMIAS (151-200)
            { id: 151, category: 'AV Node Dysrhythmias', rhythm: 'Junctional escape complexes or rhythms', rate: '45 bpm', regularity: 'Regular', pWave: 'Absent or inverted after QRS', prInterval: 'None or short', qrsWidth: '0.08 sec', characteristics: 'SA node failure, AV node takes over' },
            { id: 152, category: 'AV Node Dysrhythmias', rhythm: 'Junctional escape complexes or rhythms', rate: '52 bpm', regularity: 'Regular', pWave: 'Inverted before QRS', prInterval: '< 0.12 sec', qrsWidth: '0.08 sec', characteristics: 'High junctional pacemaker' },
            { id: 153, category: 'AV Node Dysrhythmias', rhythm: 'Junctional escape complexes or rhythms', rate: '38 bpm', regularity: 'Regular', pWave: 'Hidden in QRS', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Slow junctional, symptomatic' },
            { id: 154, category: 'AV Node Dysrhythmias', rhythm: 'Accelerated junctional rhythm', rate: '68 bpm', regularity: 'Regular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Rate 60-100, enhanced automaticity' },
            { id: 155, category: 'AV Node Dysrhythmias', rhythm: 'Accelerated junctional rhythm', rate: '85 bpm', regularity: 'Regular', pWave: 'Inverted in II, III, aVF', prInterval: '< 0.12 sec', qrsWidth: '0.08 sec', characteristics: 'Digoxin toxicity classic finding' },
            { id: 156, category: 'AV Node Dysrhythmias', rhythm: 'Accelerated junctional rhythm', rate: '75 bpm', regularity: 'Regular', pWave: 'After QRS (retrograde)', prInterval: 'N/A', qrsWidth: '0.10 sec', characteristics: 'Post-cardiac surgery common' },
            { id: 157, category: 'AV Node Dysrhythmias', rhythm: 'Junctional tachycardia', rate: '115 bpm', regularity: 'Regular', pWave: 'Inverted or absent', prInterval: 'Short or N/A', qrsWidth: '0.08 sec', characteristics: 'Rate > 100, needs treatment' },
            { id: 158, category: 'AV Node Dysrhythmias', rhythm: 'Junctional tachycardia', rate: '128 bpm', regularity: 'Regular', pWave: 'Retrograde', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'May respond to adenosine' },
            { id: 159, category: 'AV Node Dysrhythmias', rhythm: 'PJC - premature junctional contraction', rate: '72 bpm with early beats', regularity: 'Irregular', pWave: 'Inverted or absent on PJC', prInterval: 'Short', qrsWidth: '0.08 sec', characteristics: 'Early narrow QRS, abnormal P' },
            { id: 160, category: 'AV Node Dysrhythmias', rhythm: 'PJC - bigeminy', rate: '68 bpm', regularity: 'Regular irregularity', pWave: 'Alternating', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: 'Every other beat from junction' },

            // Additional AV Node rhythms
            { id: 161, category: 'AV Node Dysrhythmias', rhythm: 'Junctional escape complexes or rhythms', rate: '48 bpm', regularity: 'Regular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Intrinsic rate of AV junction' },
            { id: 162, category: 'AV Node Dysrhythmias', rhythm: 'Accelerated junctional rhythm', rate: '92 bpm', regularity: 'Regular', pWave: 'Inverted before QRS', prInterval: '0.08 sec', qrsWidth: '0.08 sec', characteristics: 'Upper limit of accelerated junctional' },
            { id: 163, category: 'AV Node Dysrhythmias', rhythm: 'Junctional tachycardia', rate: '105 bpm', regularity: 'Regular', pWave: 'Hidden', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Just above 100, early junctional tach' },
            { id: 164, category: 'AV Node Dysrhythmias', rhythm: 'PJC - couplet', rate: '78 bpm', regularity: 'Irregular', pWave: 'Two inverted P waves', prInterval: 'Short', qrsWidth: '0.08 sec', characteristics: 'Two consecutive PJCs' },
            { id: 165, category: 'AV Node Dysrhythmias', rhythm: 'Junctional escape complexes or rhythms', rate: '55 bpm', regularity: 'Regular', pWave: 'Inverted after QRS', prInterval: 'N/A', qrsWidth: '0.08 sec', characteristics: 'Low junctional pacemaker' },

            // VENTRICULAR DYSRHYTHMIAS (201-260)
            { id: 201, category: 'Ventricular Dysrhythmias', rhythm: 'PVC - unifocal', rate: '72 bpm with PVCs', regularity: 'Irregular', pWave: 'Absent on PVC', prInterval: 'N/A', qrsWidth: '>0.12 sec on PVC', characteristics: 'Same morphology, single focus' },
            { id: 202, category: 'Ventricular Dysrhythmias', rhythm: 'PVC - multifocal', rate: '78 bpm with PVCs', regularity: 'Irregular', pWave: 'Absent on PVCs', prInterval: 'N/A', qrsWidth: '>0.12 sec', characteristics: 'Different morphologies, multiple foci' },
            { id: 203, category: 'Ventricular Dysrhythmias', rhythm: 'PVC - bigeminy', rate: '65 bpm', regularity: 'Regular irregularity', pWave: 'Absent on alternate beats', prInterval: 'N/A on PVC', qrsWidth: '>0.12 sec on PVC', characteristics: 'Every other beat is PVC' },
            { id: 204, category: 'Ventricular Dysrhythmias', rhythm: 'PVC - trigeminy', rate: '75 bpm', regularity: 'Regular irregularity', pWave: 'Absent every 3rd beat', prInterval: 'N/A', qrsWidth: '>0.12 sec on PVC', characteristics: 'PVC every third beat' },
            { id: 205, category: 'Ventricular Dysrhythmias', rhythm: 'PVC - couplet', rate: '70 bpm', regularity: 'Irregular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: '>0.12 sec', characteristics: 'Two consecutive PVCs, concerning' },
            { id: 206, category: 'Ventricular Dysrhythmias', rhythm: 'PVC - R-on-T', rate: '68 bpm', regularity: 'Irregular', pWave: 'Absent on PVC', prInterval: 'N/A', qrsWidth: '>0.12 sec', characteristics: 'PVC on vulnerable period, dangerous' },
            { id: 207, category: 'Ventricular Dysrhythmias', rhythm: 'Ventricular tachycardia (VT) - monomorphic', rate: '165 bpm', regularity: 'Regular', pWave: 'Absent or dissociated', prInterval: 'N/A', qrsWidth: '>0.12 sec', characteristics: 'Wide, regular, same morphology' },
            { id: 208, category: 'Ventricular Dysrhythmias', rhythm: 'Ventricular tachycardia (VT) - monomorphic', rate: '185 bpm', regularity: 'Regular', pWave: 'AV dissociation', prInterval: 'N/A', qrsWidth: '0.16 sec', characteristics: 'Capture and fusion beats may be seen' },
            { id: 209, category: 'Ventricular Dysrhythmias', rhythm: 'Ventricular tachycardia (VT) - polymorphic', rate: '200+ bpm', regularity: 'Irregular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: 'Variable, wide', characteristics: 'Changing axis and morphology' },
            { id: 210, category: 'Ventricular Dysrhythmias', rhythm: 'Torsades de pointes', rate: '200-250 bpm', regularity: 'Irregular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: 'Variable', characteristics: 'Twisting around baseline, long QT' },
            { id: 211, category: 'Ventricular Dysrhythmias', rhythm: 'Ventricular fibrillation (VF) - coarse', rate: 'Indeterminate', regularity: 'Chaotic', pWave: 'Absent', prInterval: 'N/A', qrsWidth: 'N/A', characteristics: 'Large amplitude, more recent onset' },
            { id: 212, category: 'Ventricular Dysrhythmias', rhythm: 'Ventricular fibrillation (VF) - fine', rate: 'Indeterminate', regularity: 'Chaotic', pWave: 'Absent', prInterval: 'N/A', qrsWidth: 'N/A', characteristics: 'Small amplitude, prolonged VF' },
            { id: 213, category: 'Ventricular Dysrhythmias', rhythm: 'Idioventricular rhythm', rate: '35 bpm', regularity: 'Regular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: '>0.12 sec', characteristics: 'Escape rhythm, ventricular pacemaker' },
            { id: 214, category: 'Ventricular Dysrhythmias', rhythm: 'Accelerated idioventricular rhythm (AIVR)', rate: '72 bpm', regularity: 'Regular', pWave: 'Absent or dissociated', prInterval: 'N/A', qrsWidth: '>0.12 sec', characteristics: 'Rate 40-100, reperfusion rhythm' },
            { id: 215, category: 'Ventricular Dysrhythmias', rhythm: 'Accelerated idioventricular rhythm (AIVR)', rate: '88 bpm', regularity: 'Regular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: '0.14 sec', characteristics: 'Common post-thrombolytics' },
            { id: 216, category: 'Ventricular Dysrhythmias', rhythm: 'Ventricular escape complexes or rhythms', rate: '28 bpm', regularity: 'Regular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: '>0.12 sec', characteristics: 'Last resort pacemaker' },
            { id: 217, category: 'Ventricular Dysrhythmias', rhythm: 'Asystole', rate: '0', regularity: 'Absent', pWave: 'Absent', prInterval: 'N/A', qrsWidth: 'N/A', characteristics: 'No electrical activity, flat line' },
            { id: 218, category: 'Ventricular Dysrhythmias', rhythm: 'Pulseless electrical activity (PEA)', rate: '45 bpm (no pulse)', regularity: 'Organized', pWave: 'May be present', prInterval: 'May be present', qrsWidth: 'Variable', characteristics: 'Electrical activity without perfusion' },
            { id: 219, category: 'Ventricular Dysrhythmias', rhythm: 'Agonal rhythm', rate: '< 20 bpm', regularity: 'Irregular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: 'Wide, bizarre', characteristics: 'Dying heart, pre-arrest' },
            { id: 220, category: 'Ventricular Dysrhythmias', rhythm: 'VT - sustained', rate: '175 bpm', regularity: 'Regular', pWave: 'AV dissociation', prInterval: 'N/A', qrsWidth: '0.18 sec', characteristics: '> 30 seconds or hemodynamically unstable' },

            // HEART BLOCKS (261-310)
            { id: 261, category: 'Heart Blocks', rhythm: 'First-degree AV block', rate: '72 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.24 sec', qrsWidth: '0.08 sec', characteristics: 'PR > 0.20 sec, all P waves conducted' },
            { id: 262, category: 'Heart Blocks', rhythm: 'First-degree AV block', rate: '68 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.28 sec', qrsWidth: '0.08 sec', characteristics: 'Marked first-degree, monitor for progression' },
            { id: 263, category: 'Heart Blocks', rhythm: 'First-degree AV block', rate: '58 bpm', regularity: 'Regular', pWave: 'Present, upright', prInterval: '0.32 sec', qrsWidth: '0.10 sec', characteristics: 'Very prolonged PR, medication effect' },
            { id: 264, category: 'Heart Blocks', rhythm: 'Second-degree AV block Type I (Wenckebach)', rate: '55-70 bpm', regularity: 'Irregular', pWave: 'Present', prInterval: 'Progressive lengthening', qrsWidth: '0.08 sec', characteristics: 'PR lengthens until QRS dropped' },
            { id: 265, category: 'Heart Blocks', rhythm: 'Second-degree AV block Type I (Wenckebach)', rate: '50-65 bpm', regularity: 'Irregular', pWave: 'More P than QRS', prInterval: 'Progressive lengthening', qrsWidth: '0.08 sec', characteristics: 'Group beating pattern, narrow QRS' },
            { id: 266, category: 'Heart Blocks', rhythm: 'Second-degree AV block Type I (Wenckebach)', rate: '48-62 bpm', regularity: 'Irregular', pWave: 'Present', prInterval: '0.20 to 0.36 sec progressive', qrsWidth: '0.08 sec', characteristics: 'Classic Mobitz I, usually benign' },
            { id: 267, category: 'Heart Blocks', rhythm: 'Second-degree AV block Type II', rate: '55 bpm', regularity: 'Irregular', pWave: 'Present, some not conducted', prInterval: 'Constant when conducted', qrsWidth: '0.12 sec', characteristics: 'Sudden dropped QRS, wide QRS' },
            { id: 268, category: 'Heart Blocks', rhythm: 'Second-degree AV block Type II', rate: '45 bpm', regularity: 'Irregular', pWave: 'Regular P waves', prInterval: '0.18 sec constant', qrsWidth: '0.14 sec', characteristics: 'Infranodal block, pacing often needed' },
            { id: 269, category: 'Heart Blocks', rhythm: 'Second-degree AV block Type II', rate: '50 bpm', regularity: 'Irregular', pWave: 'Present', prInterval: '0.16 sec constant', qrsWidth: '0.16 sec', characteristics: '2:1 or 3:1 conduction possible' },
            { id: 270, category: 'Heart Blocks', rhythm: 'Second-degree AV block - 2:1 conduction', rate: '35-40 bpm', regularity: 'Regular', pWave: 'Every other P conducted', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'Could be Type I or II, observe' },
            { id: 271, category: 'Heart Blocks', rhythm: 'Second-degree AV block - 2:1 conduction', rate: '38 bpm', regularity: 'Regular', pWave: '2 P for each QRS', prInterval: '0.20 sec', qrsWidth: '0.14 sec', characteristics: 'Wide QRS suggests Type II' },
            { id: 272, category: 'Heart Blocks', rhythm: 'Second-degree AV block - high-grade', rate: '30 bpm', regularity: 'Regular', pWave: '3:1 or worse', prInterval: 'Constant when conducted', qrsWidth: '0.12 sec', characteristics: 'Multiple non-conducted P waves' },
            { id: 273, category: 'Heart Blocks', rhythm: 'Third-degree (complete) AV block', rate: 'Atrial 80, Vent 38', regularity: 'Regular P, Regular QRS', pWave: 'Dissociated from QRS', prInterval: 'Variable (no relationship)', qrsWidth: '0.14 sec', characteristics: 'Complete dissociation, junctional/ventricular escape' },
            { id: 274, category: 'Heart Blocks', rhythm: 'Third-degree (complete) AV block', rate: 'Atrial 72, Vent 32', regularity: 'Regular', pWave: 'March through QRS', prInterval: 'No consistent PR', qrsWidth: '0.16 sec', characteristics: 'Wide QRS, ventricular escape' },
            { id: 275, category: 'Heart Blocks', rhythm: 'Third-degree (complete) AV block', rate: 'Atrial 85, Vent 45', regularity: 'Regular', pWave: 'Independent of QRS', prInterval: 'Variable', qrsWidth: '0.08 sec', characteristics: 'Narrow QRS, junctional escape' },
            { id: 276, category: 'Heart Blocks', rhythm: 'Bundle branch block - RBBB', rate: '75 bpm', regularity: 'Regular', pWave: 'Present, normal', prInterval: '0.16 sec', qrsWidth: '0.14 sec', characteristics: 'RSR\' in V1, wide S in I, V6' },
            { id: 277, category: 'Heart Blocks', rhythm: 'Bundle branch block - RBBB', rate: '82 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.18 sec', qrsWidth: '0.12 sec', characteristics: 'Incomplete RBBB pattern' },
            { id: 278, category: 'Heart Blocks', rhythm: 'Bundle branch block - LBBB', rate: '70 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.16 sec', qrsWidth: '0.16 sec', characteristics: 'Broad notched R in I, V5-V6' },
            { id: 279, category: 'Heart Blocks', rhythm: 'Bundle branch block - LBBB', rate: '68 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.14 sec', qrsWidth: '0.14 sec', characteristics: 'QS in V1, absence of Q in V6' },
            { id: 280, category: 'Heart Blocks', rhythm: 'Bifascicular block', rate: '65 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.18 sec', qrsWidth: '0.14 sec', characteristics: 'RBBB + LAFB most common' },

            // Additional Heart Blocks
            { id: 281, category: 'Heart Blocks', rhythm: 'First-degree AV block', rate: '78 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.22 sec', qrsWidth: '0.08 sec', characteristics: 'Mild first-degree block' },
            { id: 282, category: 'Heart Blocks', rhythm: 'Second-degree AV block Type I (Wenckebach)', rate: '52-68 bpm', regularity: 'Irregular', pWave: 'Present', prInterval: 'Lengthening 0.18-0.32', qrsWidth: '0.08 sec', characteristics: 'Typical grouped beating' },
            { id: 283, category: 'Heart Blocks', rhythm: 'Second-degree AV block Type II', rate: '42 bpm', regularity: 'Irregular', pWave: 'Regular', prInterval: '0.20 sec constant', qrsWidth: '0.16 sec', characteristics: 'High risk for CHB' },
            { id: 284, category: 'Heart Blocks', rhythm: 'Third-degree (complete) AV block', rate: 'Atrial 90, Vent 35', regularity: 'Regular', pWave: 'Dissociated', prInterval: 'None', qrsWidth: '0.18 sec', characteristics: 'Symptomatic, needs pacing' },
            { id: 285, category: 'Heart Blocks', rhythm: 'Bundle branch block - RBBB', rate: '88 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.16 sec', qrsWidth: '0.13 sec', characteristics: 'Classic RBBB morphology' },

            // PACEMAKER AND OTHER (286-310)
            { id: 286, category: 'Pacemaker and Other', rhythm: 'Ventricular paced rhythm', rate: '70 bpm', regularity: 'Regular', pWave: 'Absent or not sensed', prInterval: 'N/A', qrsWidth: '>0.12 sec', characteristics: 'Pacing spike before wide QRS' },
            { id: 287, category: 'Pacemaker and Other', rhythm: 'Ventricular paced rhythm', rate: '60 bpm', regularity: 'Regular', pWave: 'May be present', prInterval: 'N/A', qrsWidth: '0.16 sec', characteristics: 'VVI pacing mode' },
            { id: 288, category: 'Pacemaker and Other', rhythm: 'Dual chamber paced rhythm (DDD)', rate: '72 bpm', regularity: 'Regular', pWave: 'Paced', prInterval: 'Programmed', qrsWidth: '>0.12 sec', characteristics: 'Atrial and ventricular spikes' },
            { id: 289, category: 'Pacemaker and Other', rhythm: 'Atrial paced rhythm', rate: '75 bpm', regularity: 'Regular', pWave: 'Paced spike before P', prInterval: 'Normal', qrsWidth: '0.08 sec', characteristics: 'AAI pacing, narrow QRS' },
            { id: 290, category: 'Pacemaker and Other', rhythm: 'Pacemaker malfunction - failure to capture', rate: 'Variable', regularity: 'Irregular', pWave: 'Variable', prInterval: 'Variable', qrsWidth: 'Variable', characteristics: 'Spike without QRS, no capture' },
            { id: 291, category: 'Pacemaker and Other', rhythm: 'Pacemaker malfunction - failure to sense', rate: 'Variable', regularity: 'Irregular', pWave: 'Variable', prInterval: 'Variable', qrsWidth: 'Variable', characteristics: 'Inappropriate pacing spikes' },
            { id: 292, category: 'Pacemaker and Other', rhythm: 'Pacemaker malfunction - failure to pace', rate: 'Variable (low)', regularity: 'Irregular', pWave: 'Variable', prInterval: 'Variable', qrsWidth: 'Variable', characteristics: 'No spikes when expected' },
            { id: 293, category: 'Pacemaker and Other', rhythm: 'WPW (Wolff-Parkinson-White)', rate: '85 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '< 0.12 sec', qrsWidth: '>0.10 sec with delta wave', characteristics: 'Short PR, delta wave, wide QRS' },
            { id: 294, category: 'Pacemaker and Other', rhythm: 'WPW (Wolff-Parkinson-White)', rate: '78 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.08 sec', qrsWidth: '0.14 sec', characteristics: 'Accessory pathway conduction' },
            { id: 295, category: 'Pacemaker and Other', rhythm: 'LGL syndrome', rate: '90 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '< 0.12 sec', qrsWidth: '0.08 sec', characteristics: 'Short PR, normal QRS, no delta' },
            { id: 296, category: 'Pacemaker and Other', rhythm: 'Artifact - 60 Hz interference', rate: 'Unable to determine', regularity: 'Obscured', pWave: 'Obscured', prInterval: 'Obscured', qrsWidth: 'Obscured', characteristics: 'Regular artifact, electrical interference' },
            { id: 297, category: 'Pacemaker and Other', rhythm: 'Artifact - muscle tremor', rate: 'Obscured', regularity: 'Obscured', pWave: 'Obscured', prInterval: 'Obscured', qrsWidth: 'May be visible', characteristics: 'Irregular baseline, patient movement' },
            { id: 298, category: 'Pacemaker and Other', rhythm: 'Artifact - loose lead', rate: 'Variable', regularity: 'Chaotic', pWave: 'Variable', prInterval: 'Variable', qrsWidth: 'Variable', characteristics: 'Wandering baseline, check connections' },
            { id: 299, category: 'Pacemaker and Other', rhythm: 'Hyperkalemia pattern', rate: '55 bpm', regularity: 'Regular', pWave: 'Flattened or absent', prInterval: 'Prolonged', qrsWidth: 'Widened', characteristics: 'Peaked T waves, wide QRS' },
            { id: 300, category: 'Pacemaker and Other', rhythm: 'Hyperkalemia - severe', rate: '45 bpm', regularity: 'Regular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: '0.20 sec', characteristics: 'Sine wave pattern, critical' },
            { id: 301, category: 'Pacemaker and Other', rhythm: 'Hypokalemia pattern', rate: '75 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.18 sec', qrsWidth: '0.08 sec', characteristics: 'U waves, flat T waves, long QT' },
            { id: 302, category: 'Pacemaker and Other', rhythm: 'Digitalis effect', rate: '62 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.24 sec', qrsWidth: '0.08 sec', characteristics: 'Scooped ST depression, short QT' },
            { id: 303, category: 'Pacemaker and Other', rhythm: 'Hypothermia (Osborn waves)', rate: '48 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.20 sec', qrsWidth: '0.10 sec', characteristics: 'J waves at QRS-ST junction' },
            { id: 304, category: 'Pacemaker and Other', rhythm: 'Long QT syndrome', rate: '68 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.16 sec', qrsWidth: '0.08 sec', characteristics: 'QTc > 0.46 sec, risk for TdP' },
            { id: 305, category: 'Pacemaker and Other', rhythm: 'Brugada pattern', rate: '72 bpm', regularity: 'Regular', pWave: 'Present', prInterval: '0.16 sec', qrsWidth: '0.10 sec', characteristics: 'Coved ST elevation V1-V3' },
            { id: 306, category: 'Pacemaker and Other', rhythm: 'Ventricular paced rhythm', rate: '80 bpm', regularity: 'Regular', pWave: 'Not tracked', prInterval: 'N/A', qrsWidth: '0.18 sec', characteristics: 'Rate responsive pacing' },
            { id: 307, category: 'Pacemaker and Other', rhythm: 'Dual chamber paced rhythm (DDD)', rate: '65 bpm', regularity: 'Regular', pWave: 'Paced', prInterval: '0.16 sec (programmed)', qrsWidth: '0.16 sec', characteristics: 'Both chambers being paced' },
            { id: 308, category: 'Pacemaker and Other', rhythm: 'WPW with AF', rate: '200+ bpm', regularity: 'Irregularly irregular', pWave: 'Absent', prInterval: 'N/A', qrsWidth: 'Variable, wide', characteristics: 'Very dangerous, avoid AV nodal blockers' },
            { id: 309, category: 'Pacemaker and Other', rhythm: 'Pacemaker-mediated tachycardia', rate: '130 bpm', regularity: 'Regular', pWave: 'Retrograde', prInterval: 'N/A', qrsWidth: '0.16 sec', characteristics: 'Endless loop tachycardia' },
            { id: 310, category: 'Pacemaker and Other', rhythm: 'Biventricular paced rhythm (CRT)', rate: '70 bpm', regularity: 'Regular', pWave: 'May be paced or native', prInterval: 'Programmed', qrsWidth: '0.12-0.14 sec', characteristics: 'Narrower QRS than RV pacing alone' }
        ];

        // State variables
        let studentName = '';
        let selectedCategories = [];
        let questionCount = 20;
        let currentQuestion = 0;
        let score = 0;
        let questions = [];
        let answeredQuestions = [];
        let showFeedback = false;
        let paramsChecked = false;
        let animationId = null;
        let ecgOffset = 0;
        let ecgData = [];
        let isPaused = false;

        // DOM elements
        const welcomeScreen = document.getElementById('welcomeScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const studentNameInput = document.getElementById('studentNameInput');
        const startBtn = document.getElementById('startBtn');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const questionCountInput = document.getElementById('questionCountInput');

        // Initialize categories
        function initCategories() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = '';

            Object.entries(CATEGORIES).forEach(([cat, data]) => {
                const id = cat.replace(/\s+/g, '-').toLowerCase();
                grid.innerHTML += `
                    <div>
                        <input type="checkbox" class="category-checkbox" id="${id}" value="${cat}">
                        <label class="category-label" for="${id}">
                            <span class="category-name">
                                <span class="check-icon">‚úì</span>
                                <span>${data.icon} ${cat}</span>
                            </span>
                            <span class="category-count">${data.count}</span>
                        </label>
                    </div>
                `;
            });

            document.querySelectorAll('.category-checkbox').forEach(cb => {
                cb.addEventListener('change', updateSelection);
            });
        }

        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('.category-checkbox');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(cb => cb.checked = !allChecked);
            selectAllBtn.textContent = !allChecked ? 'Deselect All' : 'Select All';
            updateSelection();
        }

        function updateSelection() {
            const checkboxes = document.querySelectorAll('.category-checkbox');
            selectedCategories = Array.from(checkboxes)
                .filter(cb => cb.checked)
                .map(cb => cb.value);

            const available = ECG_RHYTHMS.filter(r => selectedCategories.includes(r.category)).length;
            document.getElementById('availableCount').textContent = available;
            document.getElementById('selectedCount').textContent = Math.min(questionCount, available);
            
            const catNames = selectedCategories.length > 0 
                ? selectedCategories.join(', ') 
                : 'No categories selected';
            document.getElementById('summaryCategories').textContent = 
                catNames.length > 50 ? catNames.substring(0, 47) + '...' : catNames;

            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            selectAllBtn.textContent = allChecked ? 'Deselect All' : 'Select All';
            
            validateForm();
        }

        function handleCountChange(e) {
            let value = parseInt(e.target.value) || 5;
            value = Math.max(5, Math.min(310, value));
            questionCount = value;
            
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            updateSelection();
        }

        function handleQuickCount(count) {
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.count === count) btn.classList.add('active');
            });
            
            if (count === '100') {
                const available = ECG_RHYTHMS.filter(r => selectedCategories.includes(r.category)).length;
                questionCount = available;
                questionCountInput.value = available;
            } else {
                questionCount = parseInt(count);
                questionCountInput.value = count;
            }
            
            updateSelection();
        }

        function validateForm() {
            const nameValid = studentNameInput.value.trim().length >= 2;
            const categoriesValid = selectedCategories.length > 0;
            startBtn.disabled = !(nameValid && categoriesValid);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function generateOptions(correctRhythm, allRhythms) {
            const options = [correctRhythm.rhythm];
            const sameCategoryRhythms = allRhythms
                .filter(r => r.category === correctRhythm.category && r.rhythm !== correctRhythm.rhythm)
                .map(r => r.rhythm);
            
            const uniqueSameCat = [...new Set(sameCategoryRhythms)];
            const shuffledSameCat = shuffleArray(uniqueSameCat);
            
            let addedFromSameCat = 0;
            for (const rhythm of shuffledSameCat) {
                if (options.length < 4 && !options.includes(rhythm)) {
                    options.push(rhythm);
                    addedFromSameCat++;
                    if (addedFromSameCat >= 2) break;
                }
            }
            
            const otherRhythms = allRhythms
                .filter(r => r.category !== correctRhythm.category)
                .map(r => r.rhythm);
            const uniqueOther = [...new Set(otherRhythms)];
            const shuffledOther = shuffleArray(uniqueOther);
            
            for (const rhythm of shuffledOther) {
                if (options.length >= 4) break;
                if (!options.includes(rhythm)) {
                    options.push(rhythm);
                }
            }
            
            return shuffleArray(options);
        }

        // Generate ECG waveform data for animation
        function generateECGData(rhythm) {
            const data = [];
            const width = 1400; // Double width for scrolling
            const height = 180;
            const baseline = height / 2;
            let x = 0;
            
            const rhythmName = rhythm.rhythm.toLowerCase();
            
            function addNormalBeat(hasPWave = true, qrsWidth = 'narrow') {
                // Flat baseline before P wave
                for (let i = 0; i < 10; i++) {
                    data.push({ x: x++, y: baseline + (Math.random() * 2 - 1) });
                }
                
                if (hasPWave) {
                    // P wave
                    for (let i = 0; i < 16; i++) {
                        const pHeight = Math.sin((i / 16) * Math.PI) * 12;
                        data.push({ x: x++, y: baseline - pHeight + (Math.random() * 1 - 0.5) });
                    }
                    // PR segment
                    for (let i = 0; i < 8; i++) {
                        data.push({ x: x++, y: baseline + (Math.random() * 1 - 0.5) });
                    }
                }
                
                // QRS complex
                if (qrsWidth === 'wide') {
                    // Q wave
                    for (let i = 0; i < 4; i++) {
                        data.push({ x: x++, y: baseline + (i * 2) });
                    }
                    // R wave up
                    for (let i = 0; i < 8; i++) {
                        data.push({ x: x++, y: baseline + 8 - (i * 8) });
                    }
                    // R wave peak to S
                    for (let i = 0; i < 8; i++) {
                        data.push({ x: x++, y: baseline - 56 + (i * 10) });
                    }
                    // S wave return
                    for (let i = 0; i < 6; i++) {
                        data.push({ x: x++, y: baseline + 24 - (i * 4) });
                    }
                } else {
                    // Q wave
                    data.push({ x: x++, y: baseline + 3 });
                    data.push({ x: x++, y: baseline + 5 });
                    // R wave
                    for (let i = 0; i < 5; i++) {
                        data.push({ x: x++, y: baseline + 5 - (i * 12) });
                    }
                    // S wave
                    for (let i = 0; i < 4; i++) {
                        data.push({ x: x++, y: baseline - 55 + (i * 17) });
                    }
                    data.push({ x: x++, y: baseline + 10 });
                    data.push({ x: x++, y: baseline + 5 });
                    data.push({ x: x++, y: baseline });
                }
                
                // ST segment
                for (let i = 0; i < 8; i++) {
                    data.push({ x: x++, y: baseline + (Math.random() * 1 - 0.5) });
                }
                
                // T wave
                for (let i = 0; i < 20; i++) {
                    const tHeight = Math.sin((i / 20) * Math.PI) * 15;
                    data.push({ x: x++, y: baseline - tHeight + (Math.random() * 1 - 0.5) });
                }
                
                // Return to baseline
                for (let i = 0; i < 15; i++) {
                    data.push({ x: x++, y: baseline + (Math.random() * 2 - 1) });
                }
            }
            
            // Generate based on rhythm type
            if (rhythmName.includes('ventricular fibrillation') || rhythmName.includes('vf')) {
                while (x < width) {
                    const amp = (Math.random() * 50 - 25) * (rhythmName.includes('coarse') ? 1.5 : 0.5);
                    data.push({ x: x++, y: baseline + amp });
                }
            } else if (rhythmName.includes('asystole') || rhythmName.includes('agonal')) {
                while (x < width) {
                    data.push({ x: x++, y: baseline + (Math.random() * 3 - 1.5) });
                }
            } else if (rhythmName.includes('atrial fibrillation') || rhythmName.includes('af')) {
                while (x < width - 100) {
                    // Fibrillatory baseline
                    for (let i = 0; i < 20 + Math.random() * 30; i++) {
                        data.push({ x: x++, y: baseline + (Math.random() * 6 - 3) });
                    }
                    // QRS (no P wave)
                    data.push({ x: x++, y: baseline + 3 });
                    for (let i = 0; i < 4; i++) {
                        data.push({ x: x++, y: baseline - (i * 12) });
                    }
                    for (let i = 0; i < 3; i++) {
                        data.push({ x: x++, y: baseline - 48 + (i * 20) });
                    }
                    data.push({ x: x++, y: baseline + 8 });
                    data.push({ x: x++, y: baseline });
                    // T wave
                    for (let i = 0; i < 16; i++) {
                        const tHeight = Math.sin((i / 16) * Math.PI) * 12;
                        data.push({ x: x++, y: baseline - tHeight });
                    }
                    // Variable RR interval (irregular)
                    for (let i = 0; i < Math.random() * 40 + 20; i++) {
                        data.push({ x: x++, y: baseline + (Math.random() * 4 - 2) });
                    }
                }
            } else if (rhythmName.includes('atrial flutter')) {
                while (x < width - 100) {
                    // Sawtooth flutter waves
                    for (let cycle = 0; cycle < 4; cycle++) {
                        for (let i = 0; i < 15; i++) {
                            const y = baseline + (i < 8 ? -i * 2.5 : (i - 15) * 2.5);
                            data.push({ x: x++, y: y });
                        }
                    }
                    // QRS
                    data.push({ x: x++, y: baseline + 3 });
                    for (let i = 0; i < 4; i++) {
                        data.push({ x: x++, y: baseline - (i * 12) });
                    }
                    for (let i = 0; i < 3; i++) {
                        data.push({ x: x++, y: baseline - 48 + (i * 20) });
                    }
                    data.push({ x: x++, y: baseline + 8 });
                    data.push({ x: x++, y: baseline });
                }
            } else if (rhythmName.includes('ventricular tachycardia') || rhythmName.includes('vt')) {
                while (x < width - 80) {
                    addNormalBeat(false, 'wide');
                    x += 5;
                }
            } else if (rhythmName.includes('pvc')) {
                addNormalBeat(true, 'narrow');
                x += 15;
                addNormalBeat(false, 'wide');
                x += 15;
                addNormalBeat(true, 'narrow');
                if (rhythmName.includes('bigeminy')) {
                    x += 15;
                    addNormalBeat(false, 'wide');
                    x += 15;
                    addNormalBeat(true, 'narrow');
                    x += 15;
                    addNormalBeat(false, 'wide');
                }
            } else if (rhythmName.includes('bradycardia')) {
                while (x < width - 150) {
                    addNormalBeat(true, 'narrow');
                    x += 60;
                }
            } else if (rhythmName.includes('tachycardia') || rhythmName.includes('psvt')) {
                while (x < width - 80) {
                    addNormalBeat(true, 'narrow');
                }
            } else if (rhythmName.includes('junctional')) {
                while (x < width - 100) {
                    // No P wave or inverted P after QRS
                    addNormalBeat(false, 'narrow');
                    // Add small inverted P after QRS occasionally
                    if (Math.random() > 0.5) {
                        for (let i = 0; i < 10; i++) {
                            const pHeight = Math.sin((i / 10) * Math.PI) * 6;
                            data.push({ x: x++, y: baseline + pHeight });
                        }
                    }
                    x += 30;
                }
            } else if (rhythmName.includes('pacemaker') || rhythmName.includes('paced')) {
                while (x < width - 100) {
                    // Pacing spike
                    data.push({ x: x++, y: baseline });
                    data.push({ x: x++, y: baseline - 35 });
                    data.push({ x: x++, y: baseline });
                    x += 3;
                    // Wide paced QRS
                    addNormalBeat(false, 'wide');
                    x += 30;
                }
            } else if (rhythmName.includes('third-degree') || rhythmName.includes('complete')) {
                // AV dissociation - P waves independent of QRS
                let pX = 20;
                while (x < width - 80) {
                    // Add P wave at regular intervals
                    while (pX < x + 100 && pX < width) {
                        for (let i = 0; i < 16; i++) {
                            const pHeight = Math.sin((i / 16) * Math.PI) * 12;
                            if (data[pX + i]) {
                                data[pX + i].y = Math.min(data[pX + i].y, baseline - pHeight);
                            }
                        }
                        pX += 60;
                    }
                    addNormalBeat(false, 'wide');
                    x += 40;
                }
            } else {
                // Default: normal sinus rhythm
                while (x < width - 100) {
                    addNormalBeat(true, 'narrow');
                    x += 20;
                }
            }
            
            // Fill remaining with baseline
            while (data.length < width) {
                data.push({ x: data.length, y: baseline + (Math.random() * 2 - 1) });
            }
            
            return data;
        }

        // Draw animated ECG
        function drawAnimatedECG(rhythm) {
            const canvas = document.getElementById('ecgCanvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Generate ECG data if not already generated
            if (ecgData.length === 0) {
                ecgData = generateECGData(rhythm);
            }
            
            function animate() {
                // Clear canvas
                ctx.fillStyle = '#0a0f0a';
                ctx.fillRect(0, 0, width, height);
                
                // Draw grid
                const smallGrid = 5;
                const largeGrid = 25;
                
                ctx.strokeStyle = 'rgba(0, 100, 50, 0.3)';
                ctx.lineWidth = 0.5;
                for (let x = 0; x <= width; x += smallGrid) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                }
                for (let y = 0; y <= height; y += smallGrid) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                }
                
                ctx.strokeStyle = 'rgba(0, 150, 70, 0.5)';
                ctx.lineWidth = 1;
                for (let x = 0; x <= width; x += largeGrid) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                }
                for (let y = 0; y <= height; y += largeGrid) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                }
                
                // Draw ECG trace with glow effect
                ctx.shadowColor = '#00ff88';
                ctx.shadowBlur = 8;
                ctx.strokeStyle = '#00ff88';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const dataLen = ecgData.length;
                for (let i = 0; i < width; i++) {
                    const dataIndex = Math.floor((i + ecgOffset) % dataLen);
                    const point = ecgData[dataIndex];
                    if (i === 0) {
                        ctx.moveTo(i, point.y);
                    } else {
                        ctx.lineTo(i, point.y);
                    }
                }
                ctx.stroke();
                ctx.shadowBlur = 0;
                
                // Draw sweep line
                const sweepX = width - 5;
                ctx.fillStyle = 'rgba(0, 255, 136, 0.3)';
                ctx.fillRect(sweepX - 20, 0, 25, height);
                
                // Increment offset for scrolling effect
                ecgOffset += 2;
                if (ecgOffset >= dataLen) {
                    ecgOffset = 0;
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            // Start animation
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            animate();
        }

        function stopAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        function togglePause() {
            isPaused = !isPaused;
            
            const liveIndicator = document.getElementById('liveIndicator');
            const liveText = document.getElementById('liveText');
            const pauseIcon = document.getElementById('pauseIcon');
            const pauseBtnText = document.getElementById('pauseBtnText');
            
            if (isPaused) {
                liveIndicator.classList.add('paused');
                liveText.textContent = 'PAUSED';
                pauseIcon.textContent = '‚ñ∂';
                pauseBtnText.textContent = 'Play';
                stopAnimation();
            } else {
                liveIndicator.classList.remove('paused');
                liveText.textContent = 'LIVE';
                pauseIcon.textContent = '‚è∏';
                pauseBtnText.textContent = 'Pause';
                // Resume animation
                const question = questions[currentQuestion];
                if (question) {
                    drawAnimatedECG(question);
                }
            }
        }

        // Check parameter answers
        function checkParameters() {
            const question = questions[currentQuestion];
            let allCorrect = true;
            
            // Rate check
            const rateInput = document.getElementById('paramRate');
            const rateFeedback = document.getElementById('feedbackRate');
            const userRate = rateInput.value.trim().toLowerCase();
            const correctRate = question.rate.toLowerCase();
            
            if (userRate && (correctRate.includes(userRate) || userRate.includes(correctRate.split(' ')[0]))) {
                rateInput.classList.add('correct');
                rateInput.classList.remove('incorrect');
                rateFeedback.textContent = '‚úì Correct';
                rateFeedback.className = 'param-feedback correct';
            } else {
                rateInput.classList.add('show-answer');
                rateInput.classList.remove('incorrect');
                rateFeedback.textContent = question.rate;
                rateFeedback.className = 'param-feedback incorrect';
                allCorrect = false;
            }
            
            // Regularity check
            const regInput = document.getElementById('paramRegularity');
            const regFeedback = document.getElementById('feedbackRegularity');
            const userReg = regInput.value.trim().toLowerCase();
            const correctReg = question.regularity.toLowerCase();
            
            if (userReg && (correctReg.includes(userReg) || userReg.includes(correctReg.split(' ')[0]))) {
                regInput.classList.add('correct');
                regInput.classList.remove('incorrect');
                regFeedback.textContent = '‚úì Correct';
                regFeedback.className = 'param-feedback correct';
            } else {
                regInput.classList.add('show-answer');
                regInput.classList.remove('incorrect');
                regFeedback.textContent = question.regularity;
                regFeedback.className = 'param-feedback incorrect';
                allCorrect = false;
            }
            
            // PRI check
            const priInput = document.getElementById('paramPRI');
            const priFeedback = document.getElementById('feedbackPRI');
            const userPRI = priInput.value.trim().toLowerCase();
            const correctPRI = question.prInterval.toLowerCase();
            
            if (userPRI && (correctPRI.includes(userPRI) || userPRI.includes(correctPRI.replace(' sec', '').replace('sec', '')))) {
                priInput.classList.add('correct');
                priInput.classList.remove('incorrect');
                priFeedback.textContent = '‚úì Correct';
                priFeedback.className = 'param-feedback correct';
            } else {
                priInput.classList.add('show-answer');
                priInput.classList.remove('incorrect');
                priFeedback.textContent = question.prInterval;
                priFeedback.className = 'param-feedback incorrect';
                allCorrect = false;
            }
            
            // QRS check
            const qrsInput = document.getElementById('paramQRS');
            const qrsFeedback = document.getElementById('feedbackQRS');
            const userQRS = qrsInput.value.trim().toLowerCase();
            const correctQRS = question.qrsWidth.toLowerCase();
            
            if (userQRS && (correctQRS.includes(userQRS) || userQRS.includes(correctQRS.replace(' sec', '').replace('sec', '')))) {
                qrsInput.classList.add('correct');
                qrsInput.classList.remove('incorrect');
                qrsFeedback.textContent = '‚úì Correct';
                qrsFeedback.className = 'param-feedback correct';
            } else {
                qrsInput.classList.add('show-answer');
                qrsInput.classList.remove('incorrect');
                qrsFeedback.textContent = question.qrsWidth;
                qrsFeedback.className = 'param-feedback incorrect';
                allCorrect = false;
            }
            
            paramsChecked = true;
            document.getElementById('checkParamsBtn').disabled = true;
            document.getElementById('checkParamsBtn').textContent = allCorrect ? '‚úì All Correct!' : 'Answers Revealed';
        }

        function displayQuestion() {
            const question = questions[currentQuestion];
            
            document.getElementById('quizStudentName').textContent = studentName;
            document.getElementById('quizCategory').textContent = selectedCategories.length === Object.keys(CATEGORIES).length 
                ? 'All Categories (Shuffled)' 
                : `${selectedCategories.length} Categories`;
            document.getElementById('currentScore').textContent = `${score}/${currentQuestion}`;
            document.getElementById('progressFill').style.width = `${((currentQuestion + 1) / questions.length) * 100}%`;
            document.getElementById('currentQ').textContent = currentQuestion + 1;
            document.getElementById('totalQ').textContent = questions.length;
            document.getElementById('ecgCategory').textContent = CATEGORIES[question.category]?.fullName || question.category;
            
            // Reset parameter inputs
            const paramInputs = ['paramRate', 'paramRegularity', 'paramPRI', 'paramQRS'];
            paramInputs.forEach(id => {
                const input = document.getElementById(id);
                input.value = '';
                input.classList.remove('correct', 'incorrect', 'show-answer');
            });
            
            const feedbackIds = ['feedbackRate', 'feedbackRegularity', 'feedbackPRI', 'feedbackQRS'];
            feedbackIds.forEach(id => {
                document.getElementById(id).textContent = '';
                document.getElementById(id).className = 'param-feedback';
            });
            
            document.getElementById('checkParamsBtn').disabled = false;
            document.getElementById('checkParamsBtn').textContent = '‚úì Check My Measurements';
            paramsChecked = false;
            
            // Reset and start animation
            ecgData = [];
            ecgOffset = 0;
            isPaused = false;
            
            // Reset pause button UI
            const liveIndicator = document.getElementById('liveIndicator');
            const liveText = document.getElementById('liveText');
            const pauseIcon = document.getElementById('pauseIcon');
            const pauseBtnText = document.getElementById('pauseBtnText');
            liveIndicator.classList.remove('paused');
            liveText.textContent = 'LIVE';
            pauseIcon.textContent = '‚è∏';
            pauseBtnText.textContent = 'Pause';
            
            drawAnimatedECG(question);

            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            
            const letters = ['A', 'B', 'C', 'D'];
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `
                    <span class="option-letter">${letters[index]}</span>
                    <span>${option}</span>
                `;
                btn.addEventListener('click', () => handleAnswer(option, btn));
                optionsGrid.appendChild(btn);
            });

            document.getElementById('feedbackPanel').classList.add('hidden');
            showFeedback = false;
        }

        function handleAnswer(selected, btn) {
            if (showFeedback) return;
            showFeedback = true;

            const question = questions[currentQuestion];
            const isCorrect = selected === question.rhythm;
            
            // Stop animation when answer is selected
            stopAnimation();
            
            if (isCorrect) {
                score++;
                btn.classList.add('correct');
            } else {
                btn.classList.add('wrong');
                document.querySelectorAll('.option-btn').forEach(b => {
                    if (b.querySelector('span:last-child').textContent === question.rhythm) {
                        b.classList.add('correct');
                    }
                });
            }

            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

            answeredQuestions.push({
                id: question.id,
                category: question.category,
                rhythm: question.rhythm,
                userAnswer: selected,
                correct: isCorrect,
                characteristics: question.characteristics
            });

            document.getElementById('currentScore').textContent = `${score}/${currentQuestion + 1}`;

            const feedbackPanel = document.getElementById('feedbackPanel');
            feedbackPanel.classList.remove('hidden', 'correct-panel', 'wrong-panel');
            feedbackPanel.classList.add(isCorrect ? 'correct-panel' : 'wrong-panel');
            
            document.getElementById('feedbackIcon').textContent = isCorrect ? '‚úì' : '‚úó';
            document.getElementById('feedbackTitle').textContent = isCorrect ? 'Correct!' : 'Incorrect';
            
            const correctAnswerText = document.getElementById('correctAnswerText');
            if (!isCorrect) {
                correctAnswerText.classList.remove('hidden');
                correctAnswerText.innerHTML = `The correct answer is: <strong>${question.rhythm}</strong>`;
            } else {
                correctAnswerText.classList.add('hidden');
            }
            
            document.getElementById('characteristicsText').textContent = question.characteristics;
            document.getElementById('charPWave').textContent = question.pWave;
            document.getElementById('charPR').textContent = question.prInterval;

            if (currentQuestion >= questions.length - 1) {
                document.getElementById('nextBtn').textContent = 'View Results ‚Üí';
            }
        }

        function handleNext() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            stopAnimation();
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');

            const percentage = Math.round((score / questions.length) * 100);
            const passed = percentage >= 85;

            document.getElementById('scorePercentage').textContent = `${percentage}%`;
            document.getElementById('scoreFraction').textContent = `${score} out of ${questions.length} correct`;
            
            const scoreCard = document.getElementById('scoreCard');
            scoreCard.classList.remove('passed', 'failed');
            scoreCard.classList.add(passed ? 'passed' : 'failed');
            
            document.getElementById('passBadge').textContent = passed ? '‚úì PASSED' : '‚úó NEEDS IMPROVEMENT';
            document.getElementById('resultsIcon').textContent = passed ? 'üèÜ' : 'üìö';
            document.getElementById('resultsTitle').textContent = passed ? 'Congratulations!' : 'Keep Practicing!';
            document.getElementById('resultsSubtitle').textContent = passed 
                ? `Great job, ${studentName}! You've demonstrated proficiency in ECG interpretation.`
                : `${studentName}, review the missed questions and try again to reach the 85% passing score.`;

            const categoryScores = {};
            answeredQuestions.forEach(q => {
                if (!categoryScores[q.category]) {
                    categoryScores[q.category] = { correct: 0, total: 0 };
                }
                categoryScores[q.category].total++;
                if (q.correct) categoryScores[q.category].correct++;
            });

            const breakdownList = document.getElementById('breakdownList');
            breakdownList.innerHTML = '';

            Object.entries(categoryScores).forEach(([cat, data]) => {
                const catPercent = Math.round((data.correct / data.total) * 100);
                let scoreClass = 'good';
                if (catPercent < 50) scoreClass = 'poor';
                else if (catPercent < 70) scoreClass = 'medium';

                const displayName = CATEGORIES[cat]?.fullName || cat;

                breakdownList.innerHTML += `
                    <div class="breakdown-item">
                        <div class="breakdown-header">
                            <span class="breakdown-name">${displayName}</span>
                            <span class="breakdown-score ${scoreClass}">${data.correct}/${data.total} (${catPercent}%)</span>
                        </div>
                        <div class="breakdown-bar">
                            <div class="breakdown-fill ${scoreClass}" style="width: ${catPercent}%"></div>
                        </div>
                    </div>
                `;
            });

            const actionsGrid = document.getElementById('actionsGrid');
            if (passed) {
                actionsGrid.classList.add('two-col');
                document.getElementById('certificateBtn').classList.remove('hidden');
            } else {
                actionsGrid.classList.remove('two-col');
                document.getElementById('certificateBtn').classList.add('hidden');
            }

            const missedQuestions = document.getElementById('missedQuestions');
            const missed = answeredQuestions.filter(q => !q.correct);
            
            if (missed.length > 0) {
                missedQuestions.classList.remove('hidden');
                const missedList = document.getElementById('missedList');
                missedList.innerHTML = '';

                missed.forEach(q => {
                    const displayCat = CATEGORIES[q.category]?.fullName || q.category;
                    missedList.innerHTML += `
                        <div class="missed-item">
                            <div class="missed-header">
                                <span class="missed-category">${displayCat}</span>
                                <span class="missed-id">#${q.id}</span>
                            </div>
                            <div class="missed-answer">
                                <span class="label">Your answer: </span>
                                <span class="value">${q.userAnswer}</span>
                            </div>
                            <div class="missed-correct">
                                <span class="label">Correct answer: </span>
                                <span class="value">${q.rhythm}</span>
                            </div>
                            <div class="missed-explanation">${q.characteristics}</div>
                        </div>
                    `;
                });
            } else {
                missedQuestions.classList.add('hidden');
            }
        }

        async function generateCertificate() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: 'a4'
            });

            const width = 297;
            const height = 210;
            const percentage = Math.round((score / questions.length) * 100);
            const date = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            doc.setFillColor(10, 22, 40);
            doc.rect(0, 0, width, height, 'F');

            doc.setDrawColor(0, 255, 136);
            doc.setLineWidth(2);
            doc.rect(10, 10, width - 20, height - 20);

            doc.setLineWidth(0.5);
            doc.rect(15, 15, width - 30, height - 30);

            doc.setDrawColor(0, 200, 100);
            doc.setLineWidth(1);
            doc.line(20, 30, 20, 20);
            doc.line(20, 20, 30, 20);
            doc.line(width - 20, 30, width - 20, 20);
            doc.line(width - 20, 20, width - 30, 20);
            doc.line(20, height - 30, 20, height - 20);
            doc.line(20, height - 20, 30, height - 20);
            doc.line(width - 20, height - 30, width - 20, height - 20);
            doc.line(width - 20, height - 20, width - 30, height - 20);

            doc.setTextColor(0, 255, 136);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'normal');
            doc.text('PAUL D. CAMP COMMUNITY COLLEGE', width / 2, 35, { align: 'center' });

            doc.setFontSize(12);
            doc.setTextColor(150, 180, 200);
            doc.text('Emergency Medical Services Program', width / 2, 43, { align: 'center' });

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(32);
            doc.setFont('helvetica', 'bold');
            doc.text('CERTIFICATE OF COMPLETION', width / 2, 65, { align: 'center' });

            doc.setFontSize(16);
            doc.setTextColor(0, 255, 136);
            doc.setFont('helvetica', 'normal');
            doc.text('ECG Rhythm Interpretation Proficiency Assessment', width / 2, 78, { align: 'center' });

            doc.setTextColor(200, 200, 200);
            doc.setFontSize(12);
            doc.text('This certifies that', width / 2, 95, { align: 'center' });

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(28);
            doc.setFont('helvetica', 'bold');
            doc.text(studentName.toUpperCase(), width / 2, 112, { align: 'center' });

            const nameWidth = doc.getTextWidth(studentName.toUpperCase());
            doc.setDrawColor(0, 255, 136);
            doc.setLineWidth(0.5);
            doc.line((width - nameWidth) / 2 - 10, 117, (width + nameWidth) / 2 + 10, 117);

            doc.setTextColor(200, 200, 200);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('has successfully completed the comprehensive', width / 2, 130, { align: 'center' });
            doc.text('ECG Dysrhythmia Interpretation Practice Assessment', width / 2, 138, { align: 'center' });

            doc.setFillColor(0, 50, 30);
            doc.roundedRect(width / 2 - 45, 145, 90, 25, 3, 3, 'F');
            doc.setDrawColor(0, 255, 136);
            doc.roundedRect(width / 2 - 45, 145, 90, 25, 3, 3, 'S');

            doc.setTextColor(0, 255, 136);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text(`SCORE: ${score}/${questions.length} (${percentage}%)`, width / 2, 161, { align: 'center' });

            doc.setTextColor(180, 180, 180);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text(`Completed on: ${date}`, width / 2, 180, { align: 'center' });

            doc.setFontSize(8);
            doc.setTextColor(100, 120, 140);
            const catDisplay = selectedCategories.length === Object.keys(CATEGORIES).length 
                ? 'All Categories' 
                : selectedCategories.slice(0, 3).join(', ') + (selectedCategories.length > 3 ? '...' : '');
            doc.text(`Categories tested: ${catDisplay}`, width / 2, 190, { align: 'center' });
            doc.text('CoAEMSP Standards Aligned | Paul D. Camp Community College EMS Program', width / 2, 198, { align: 'center' });

            doc.save(`ECG_Certificate_${studentName.replace(/\s+/g, '_')}.pdf`);
        }

        function startQuiz() {
            studentName = studentNameInput.value.trim();

            let rhythms = ECG_RHYTHMS.filter(r => selectedCategories.includes(r.category));
            
            const shuffled = shuffleArray(rhythms);
            const selectedRhythms = shuffled.slice(0, questionCount);
            
            questions = selectedRhythms.map(rhythm => ({
                ...rhythm,
                options: generateOptions(rhythm, ECG_RHYTHMS)
            }));

            currentQuestion = 0;
            score = 0;
            answeredQuestions = [];
            showFeedback = false;

            welcomeScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            displayQuestion();
        }

        function restart() {
            stopAnimation();
            studentNameInput.value = '';
            studentName = '';
            selectedCategories = [];
            questionCount = 20;
            currentQuestion = 0;
            score = 0;
            questions = [];
            answeredQuestions = [];
            showFeedback = false;
            ecgData = [];
            ecgOffset = 0;
            isPaused = false;

            const checkboxes = document.querySelectorAll('.category-checkbox');
            checkboxes.forEach(cb => cb.checked = false);

            questionCountInput.value = 20;
            
            const quickBtns = document.querySelectorAll('.quick-btn');
            quickBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.count === '20') btn.classList.add('active');
            });

            resultsScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');

            updateSelection();
            startBtn.disabled = true;
        }

        // Event listeners
        studentNameInput.addEventListener('input', validateForm);
        startBtn.addEventListener('click', startQuiz);
        selectAllBtn.addEventListener('click', toggleSelectAll);
        questionCountInput.addEventListener('input', handleCountChange);
        document.getElementById('nextBtn').addEventListener('click', handleNext);
        document.getElementById('certificateBtn').addEventListener('click', generateCertificate);
        document.getElementById('restartBtn').addEventListener('click', restart);
        document.getElementById('checkParamsBtn').addEventListener('click', checkParameters);

        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', () => handleQuickCount(btn.dataset.count));
        });

        // Initialize
        initCategories();
        updateSelection();
    </script>
</body>
</html>
