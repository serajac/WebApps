<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GutWise ‚Äî Meal Planner</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:#FAFAF7;color:#1A1A17;-webkit-font-smoothing:antialiased;line-height:1.6}
button{font-family:inherit;cursor:pointer;border:none;outline:none;background:none}
textarea,input,select{font-family:inherit;outline:none}
h1,h2,h3,h4{font-family:'Fraunces',serif;font-weight:600;letter-spacing:-0.02em}
::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#D4CFC4;border-radius:10px}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
@keyframes scaleIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.au{animation:fadeUp .45s cubic-bezier(.23,1,.32,1) both}.as{animation:scaleIn .3s ease both}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:9999;opacity:.15;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E")}
@media(max-width:900px){.grid-r{grid-template-columns:1fr!important}.prof-grid{grid-template-columns:1fr!important}}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none}input[type=number]{-moz-appearance:textfield}
.cattabs{display:flex;gap:4px;overflow-x:auto;padding:8px 0;scrollbar-width:none;-ms-overflow-style:none}.cattabs::-webkit-scrollbar{display:none}
.swap-btn{opacity:0;transition:opacity .2s}.meal-row:hover .swap-btn{opacity:1}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const h=React.createElement;
const{useState,useEffect}=React;
const P={cream:'#FAFAF7',sand:'#F0EDE5',stone:'#E4DFD4',warm:'#D4CFC4',bark:'#8C8577',earth:'#5C564C',ink:'#1A1A17',green:'#4C8C4A',gL:'#E8F2E4',gD:'#3A6B38',amber:'#C4923A',aL:'#FFF5E0',coral:'#C4564A',cL:'#FCEAE8',sky:'#4A8CC4',sL:'#E4F0FA',plum:'#7A5C8C',pL:'#F2EBF6',white:'#FFFFFF'};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TRANSLATIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const TX={
en:{brand:"GutWise",tag:"IBS + Bypass Meal Planner",tG:"Guide",tP:"Planner",tH:"History",
profTitle:"Your Profile",profSub:"Calculate your BMI and daily caloric needs",
sexLbl:"Biological Sex",male:"Male",female:"Female",ageLbl:"Age (years)",wtLbl:"Weight",htLbl:"Height",
imperial:"Imperial",metric:"Metric",lbs:"lbs",kg:"kg",ft:"ft",inches:"in",cm:"cm",calcBtn:"Calculate My Needs",
bmiLabel:"BMI",catLabel:"Category",tdeeLabel:"Daily Calories",adjNote:"+30% for post-bypass malabsorption",
goalLose:"Lose Weight",goalMaint:"Maintain",goalGain:"Increase Mass",goalLoseD:"~500 cal deficit",goalMaintD:"Match daily energy",goalGainD:"~300 cal surplus",
targetLabel:"Daily Target",mealLabel:"Per Meal (5/day)",proLabel:"Protein",carbLabel:"Carbs",fatLabel:"Fat",fibLabel:"Fiber",editBtn:"Edit Profile",
bmiU:"Underweight",bmiN:"Normal",bmiOv:"Overweight",bmiO1:"Obese I",bmiO2:"Obese II",bmiO3:"Obese III",
gI:"Managing IBS and gastric bypass together means choosing low-FODMAP foods in small, protein-first portions.",
ibsT:"IBS / Low-FODMAP",bypT:"Gastric Bypass",avT:"Avoid",saT:"Safe",ruT:"Rules",caT:"Caution",
ibsA:["High-fructose fruits (apples, mangos, pears)","Garlic, onion, leek, shallots","Wheat, rye, barley in large amounts","Lactose-rich dairy","Legumes in large portions","Sugar alcohols","Honey, agave, HFCS","Cauliflower, mushrooms in excess"],
ibsS:["Strawberries, blueberries, grapes, kiwi","Carrots, zucchini, bell peppers, spinach","Rice, oats, quinoa, GF bread","Hard/aged cheeses, lactose-free dairy","Meats, fish, tofu, eggs","Sourdough (long-fermented)","Herbs: basil, oregano, thyme","Ginger, turmeric, cinnamon"],
bypR:["Max 1‚Äì1.5 cups per meal","Protein first (60‚Äì80g/day)","30 min per meal, chew 20‚Äì30√ó","No drinks 30 min before/after","Avoid sugar ‚Üí dumping syndrome","Daily supplements required","Hydrate 64oz between meals"],
bypC:["Tough meats, fried foods","Carbonated drinks","Raw fibrous veg early post-op","Sugar, alcohol"],
piT:"Build Your Plate",piD:"Select ingredients, then generate your personalized menu.",
sel:"selected",gen:"Generate Menu",regen:"New Menu",ging:"Creating...",minW:"Need 1+ protein, 1+ carb, 1+ vegetable",swapBtn:"Swap",
mT:"Your Weekly Menu",sav:"Save & Track",sup:"Daily Supplements",
bf:"Breakfast",lu:"Lunch",di:"Dinner",s1:"Snack 1",s2:"Snack 2",
mo:"Monday",tu:"Tuesday",we:"Wednesday",th:"Thursday",fr:"Friday",sa:"Saturday",su:"Sunday",
hT:"Tracking",hD:"Check off meals and monitor progress.",nH:"No plans yet",nHS:"Generate a menu to start!",
wO:"Week of",oM:"of meals",no:"Notes",noP:"How did you feel?",hlT:"Health Benefits",prT:"Preparation",day:"Day",
cPr:"Proteins",cCa:"Carbs",cFa:"Healthy Fats",cVe:"Vegetables",cFr:"Fruits",cCh:"Cheeses",cDe:"Desserts",cGF:"Gluten-Free",cVg:"Vegetarian",cSo:"Sourdough",cPb:"Probiotics",cSu:"Supplements",
allBtn:"All",clrBtn:"Clear",searchPh:"Search ingredients...",disc:"‚ö†Ô∏è Medical Disclaimer: For informational purposes only. Always follow your healthcare team's guidelines."},
es:{brand:"GutWise",tag:"Plan SII + Bypass",tG:"Gu√≠a",tP:"Plan",tH:"Historial",profTitle:"Tu Perfil",profSub:"Calcula tu IMC y necesidades",sexLbl:"Sexo",male:"Masculino",female:"Femenino",ageLbl:"Edad (a√±os)",wtLbl:"Peso",htLbl:"Altura",imperial:"Imperial",metric:"M√©trico",lbs:"lbs",kg:"kg",ft:"ft",inches:"in",cm:"cm",calcBtn:"Calcular",bmiLabel:"IMC",catLabel:"Categor√≠a",tdeeLabel:"Calor√≠as/D√≠a",adjNote:"+30% malabsorci√≥n",goalLose:"Perder",goalMaint:"Mantener",goalGain:"Ganar",goalLoseD:"D√©ficit ~500",goalMaintD:"Igualar",goalGainD:"Surplus ~300",targetLabel:"Objetivo",mealLabel:"Por Comida",proLabel:"Prote√≠na",carbLabel:"Carbos",fatLabel:"Grasa",fibLabel:"Fibra",editBtn:"Editar",bmiU:"Bajo peso",bmiN:"Normal",bmiOv:"Sobrepeso",bmiO1:"Obesidad I",bmiO2:"Obesidad II",bmiO3:"Obesidad III",gI:"SII y bypass requieren FODMAP bajo, prote√≠nas primero.",ibsT:"SII/Bajo FODMAP",bypT:"Bypass",avT:"Evitar",saT:"Seguro",ruT:"Reglas",caT:"Precauci√≥n",ibsA:["Frutas altas fructosa","Ajo, cebolla","Trigo, centeno","L√°cteos lactosa","Legumbres","Alcoholes az√∫car","Miel, agave","Coliflor, champi√±ones"],ibsS:["Fresas, ar√°ndanos, uvas","Zanahorias, calabac√≠n","Arroz, avena, quinoa","Quesos duros","Carnes, pescado, tofu","Masa madre","Hierbas","Jengibre, c√∫rcuma"],bypR:["M√°x 1‚Äì1.5 tazas","Prote√≠na primero","30 min/comida","No beber 30 min antes/despu√©s","Evitar az√∫car","Suplementos diarios","2L agua entre comidas"],bypC:["Carnes duras, fritos","Carbonatadas","Verduras crudas fibrosas","Az√∫car, alcohol"],piT:"Arma Tu Plato",piD:"Selecciona ingredientes.",sel:"seleccionados",gen:"Generar",regen:"Nuevo",ging:"Creando...",minW:"Necesitas 1+ prote√≠na, 1+ carb, 1+ vegetal",swapBtn:"Cambiar",mT:"Tu Men√∫",sav:"Guardar",sup:"Suplementos",bf:"Desayuno",lu:"Almuerzo",di:"Cena",s1:"Merienda 1",s2:"Merienda 2",mo:"Lunes",tu:"Martes",we:"Mi√©rcoles",th:"Jueves",fr:"Viernes",sa:"S√°bado",su:"Domingo",hT:"Seguimiento",hD:"Marca comidas.",nH:"Sin planes",nHS:"¬°Genera!",wO:"Semana del",oM:"de comidas",no:"Notas",noP:"¬øC√≥mo te sentiste?",hlT:"Beneficios",prT:"Preparaci√≥n",day:"D√≠a",cPr:"Prote√≠nas",cCa:"Carbohidratos",cFa:"Grasas",cVe:"Vegetales",cFr:"Frutas",cCh:"Quesos",cDe:"Postres",cGF:"Sin Gluten",cVg:"Vegetariano",cSo:"Masa Madre",cPb:"Probi√≥ticos",cSu:"Suplementos",allBtn:"Todo",clrBtn:"Limpiar",searchPh:"Buscar...",disc:"‚ö†Ô∏è Solo informativo."},
fr:{brand:"GutWise",tag:"Plan SII + Bypass",tG:"Guide",tP:"Menu",tH:"Historique",profTitle:"Votre Profil",profSub:"Calculez IMC et besoins",sexLbl:"Sexe",male:"Homme",female:"Femme",ageLbl:"√Çge (ans)",wtLbl:"Poids",htLbl:"Taille",imperial:"Imp√©rial",metric:"M√©trique",lbs:"lbs",kg:"kg",ft:"ft",inches:"po",cm:"cm",calcBtn:"Calculer",bmiLabel:"IMC",catLabel:"Cat√©gorie",tdeeLabel:"Calories/Jour",adjNote:"+30% malabsorption",goalLose:"Perdre",goalMaint:"Maintenir",goalGain:"Prendre",goalLoseD:"D√©ficit ~500",goalMaintD:"√âgaler",goalGainD:"Surplus ~300",targetLabel:"Objectif",mealLabel:"Par Repas",proLabel:"Prot√©ines",carbLabel:"Glucides",fatLabel:"Lipides",fibLabel:"Fibres",editBtn:"Modifier",bmiU:"Insuffisance",bmiN:"Normal",bmiOv:"Surpoids",bmiO1:"Ob√©sit√© I",bmiO2:"Ob√©sit√© II",bmiO3:"Ob√©sit√© III",gI:"SII et bypass: FODMAP bas, prot√©ines d'abord.",ibsT:"SII/Bas FODMAP",bypT:"Bypass",avT:"√âviter",saT:"S√ªr",ruT:"R√®gles",caT:"Prudence",ibsA:["Fruits fructose","Ail, oignon","Bl√©, seigle","Lactose","L√©gumineuses","Sucres-alcools","Miel","Chou-fleur, champignons"],ibsS:["Fraises, myrtilles","Carottes, courgettes","Riz, avoine","Fromages durs","Viandes, poisson","Levain","Basilic, origan","Gingembre"],bypR:["Max 1‚Äì1,5 tasse","Prot√©ines d'abord","30 min/repas","Pas boisson 30 min","√âviter sucre","Suppl√©ments","2L entre repas"],bypC:["Viandes dures","Gazeuses","L√©gumes crus","Sucre, alcool"],piT:"Composez",piD:"S√©lectionnez puis g√©n√©rez.",sel:"s√©lectionn√©s",gen:"G√©n√©rer",regen:"R√©g√©n√©rer",ging:"Cr√©ation...",minW:"1+ prot√©ine, 1+ glucide, 1+ l√©gume",swapBtn:"Changer",mT:"Votre Menu",sav:"Sauvegarder",sup:"Suppl√©ments",bf:"Petit-d√©j",lu:"D√©jeuner",di:"D√Æner",s1:"Collation 1",s2:"Collation 2",mo:"Lundi",tu:"Mardi",we:"Mercredi",th:"Jeudi",fr:"Vendredi",sa:"Samedi",su:"Dimanche",hT:"Suivi",hD:"Cochez repas.",nH:"Aucun plan",nHS:"G√©n√©rez!",wO:"Semaine du",oM:"des repas",no:"Notes",noP:"Comment?",hlT:"Bienfaits",prT:"Pr√©paration",day:"Jour",cPr:"Prot√©ines",cCa:"Glucides",cFa:"Graisses",cVe:"L√©gumes",cFr:"Fruits",cCh:"Fromages",cDe:"Desserts",cGF:"Sans Gluten",cVg:"V√©g√©tarien",cSo:"Levain",cPb:"Probiotiques",cSu:"Suppl√©ments",allBtn:"Tout",clrBtn:"Effacer",searchPh:"Rechercher...",disc:"‚ö†Ô∏è Informatif uniquement."},
it:{brand:"GutWise",tag:"Piano SII + Bypass",tG:"Guida",tP:"Menu",tH:"Cronologia",profTitle:"Profilo",profSub:"Calcola BMI e fabbisogno",sexLbl:"Sesso",male:"Maschio",female:"Femmina",ageLbl:"Et√† (anni)",wtLbl:"Peso",htLbl:"Altezza",imperial:"Imperiale",metric:"Metrico",lbs:"lbs",kg:"kg",ft:"ft",inches:"in",cm:"cm",calcBtn:"Calcola",bmiLabel:"BMI",catLabel:"Categoria",tdeeLabel:"Calorie/Giorno",adjNote:"+30% malassorbimento",goalLose:"Perdere",goalMaint:"Mantenere",goalGain:"Aumentare",goalLoseD:"Deficit ~500",goalMaintD:"Pareggiare",goalGainD:"Surplus ~300",targetLabel:"Obiettivo",mealLabel:"Per Pasto",proLabel:"Proteine",carbLabel:"Carboidrati",fatLabel:"Grassi",fibLabel:"Fibre",editBtn:"Modifica",bmiU:"Sottopeso",bmiN:"Normale",bmiOv:"Sovrappeso",bmiO1:"Obesit√† I",bmiO2:"Obesit√† II",bmiO3:"Obesit√† III",gI:"SII e bypass: FODMAP basso, proteine prima.",ibsT:"SII/Basso FODMAP",bypT:"Bypass",avT:"Evitare",saT:"Sicuro",ruT:"Regole",caT:"Cautela",ibsA:["Frutta fruttosio","Aglio, cipolla","Grano, segale","Latticini","Legumi","Alcoli zucchero","Miele","Cavolfiore, funghi"],ibsS:["Fragole, mirtilli","Carote, zucchine","Riso, avena","Formaggi stagionati","Carni, pesce","Lievito madre","Basilico, origano","Zenzero"],bypR:["Max 1‚Äì1,5 tazze","Proteine prima","30 min/pasto","Non bere 30 min","Evitare zucchero","Integratori","2L tra pasti"],bypC:["Carni dure","Gassate","Verdure crude","Zucchero, alcol"],piT:"Componi",piD:"Seleziona poi genera.",sel:"selezionati",gen:"Genera",regen:"Rigenera",ging:"Creazione...",minW:"1+ proteina, 1+ carb, 1+ verdura",swapBtn:"Cambia",mT:"Il Tuo Menu",sav:"Salva",sup:"Integratori",bf:"Colazione",lu:"Pranzo",di:"Cena",s1:"Spuntino 1",s2:"Spuntino 2",mo:"Luned√¨",tu:"Marted√¨",we:"Mercoled√¨",th:"Gioved√¨",fr:"Venerd√¨",sa:"Sabato",su:"Domenica",hT:"Monitoraggio",hD:"Spunta pasti.",nH:"Nessun piano",nHS:"Genera!",wO:"Settimana del",oM:"dei pasti",no:"Note",noP:"Come ti sei sentito?",hlT:"Benefici",prT:"Preparazione",day:"Giorno",cPr:"Proteine",cCa:"Carboidrati",cFa:"Grassi",cVe:"Verdure",cFr:"Frutta",cCh:"Formaggi",cDe:"Dolci",cGF:"Senza Glutine",cVg:"Vegetariano",cSo:"Lievito Madre",cPb:"Probiotici",cSu:"Integratori",allBtn:"Tutto",clrBtn:"Pulisci",searchPh:"Cerca...",disc:"‚ö†Ô∏è Solo informativo."}
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EXPANDED FOOD DATABASE (350+ items) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const DB={
proteins:{k:'cPr',ico:'ü•©',clr:'#C4564A',bg:'#FCEAE8',subs:{
'Poultry':[{id:'p1',n:'Chicken Breast',cal:165,pro:31,crb:0,fat:3.6},{id:'p2',n:'Ground Turkey',cal:170,pro:21,crb:0,fat:9},{id:'p3',n:'Turkey Breast',cal:125,pro:26,crb:0,fat:1.8},{id:'p4',n:'Chicken Thigh',cal:178,pro:26,crb:0,fat:8},{id:'p5',n:'Ground Chicken',cal:143,pro:17,crb:0,fat:8},{id:'p6',n:'Duck Breast',cal:140,pro:23,crb:0,fat:5},{id:'p40',n:'Cornish Hen',cal:220,pro:19,crb:0,fat:15},{id:'p41',n:'Turkey Meatballs',cal:160,pro:18,crb:4,fat:8}],
'Fish':[{id:'p7',n:'Salmon Fillet',cal:208,pro:20,crb:0,fat:13},{id:'p8',n:'Cod',cal:105,pro:23,crb:0,fat:1},{id:'p9',n:'Tilapia',cal:128,pro:26,crb:0,fat:2.7},{id:'p10',n:'Sea Bass',cal:124,pro:24,crb:0,fat:2.6},{id:'p11',n:'Mahi Mahi',cal:109,pro:24,crb:0,fat:1},{id:'p12',n:'Halibut',cal:140,pro:27,crb:0,fat:3},{id:'p13',n:'Trout',cal:150,pro:21,crb:0,fat:7},{id:'p14',n:'Sardines',cal:130,pro:18,crb:0,fat:6},{id:'p15',n:'Swordfish',cal:146,pro:24,crb:0,fat:5},{id:'p16',n:'Snapper',cal:128,pro:26,crb:0,fat:2},{id:'p17',n:'Sole/Flounder',cal:100,pro:21,crb:0,fat:1.3},{id:'p18',n:'Barramundi',cal:110,pro:23,crb:0,fat:2},{id:'p42',n:'Arctic Char',cal:135,pro:20,crb:0,fat:6},{id:'p43',n:'Grouper',cal:118,pro:25,crb:0,fat:1.3},{id:'p44',n:'Tuna Steak',cal:132,pro:28,crb:0,fat:1.2}],
'Shellfish':[{id:'p19',n:'Shrimp',cal:99,pro:24,crb:0,fat:0.3},{id:'p20',n:'Scallops',cal:111,pro:21,crb:5,fat:0.5},{id:'p21',n:'Crab Meat',cal:97,pro:19,crb:0,fat:1.5},{id:'p22',n:'Lobster',cal:98,pro:20,crb:1,fat:1},{id:'p23',n:'Mussels',cal:86,pro:12,crb:4,fat:2.3},{id:'p45',n:'Clams',cal:73,pro:13,crb:3,fat:1},{id:'p46',n:'Crawfish',cal:82,pro:16,crb:0,fat:1.2}],
'Meat':[{id:'p24',n:'Pork Tenderloin',cal:143,pro:26,crb:0,fat:3.5},{id:'p25',n:'Lean Beef Sirloin',cal:155,pro:26,crb:0,fat:5},{id:'p26',n:'Bison',cal:146,pro:20,crb:0,fat:7},{id:'p27',n:'Lamb Loin',cal:158,pro:24,crb:0,fat:6},{id:'p28',n:'Venison',cal:134,pro:26,crb:0,fat:2.7},{id:'p47',n:'Lean Ground Beef',cal:164,pro:22,crb:0,fat:8},{id:'p48',n:'Elk',cal:120,pro:26,crb:0,fat:1.5},{id:'p49',n:'Rabbit',cal:136,pro:20,crb:0,fat:6}],
'Eggs & Canned':[{id:'p29',n:'Eggs (2)',cal:147,pro:10,crb:1,fat:11},{id:'p30',n:'Egg Whites (4)',cal:68,pro:14,crb:1,fat:0},{id:'p31',n:'Tuna (canned)',cal:116,pro:26,crb:0,fat:1},{id:'p32',n:'Salmon (canned)',cal:130,pro:20,crb:0,fat:5},{id:'p50',n:'Chicken (canned)',cal:130,pro:24,crb:0,fat:3},{id:'p51',n:'Smoked Salmon',cal:117,pro:18,crb:0,fat:4}]}},
carbs:{k:'cCa',ico:'üçö',clr:'#C4923A',bg:'#FFF5E0',subs:{
'Whole Grains':[{id:'c1',n:'Brown Rice',cal:216,pro:5,crb:45,fat:1.8},{id:'c2',n:'Quinoa',cal:222,pro:8,crb:39,fat:3.5},{id:'c3',n:'Oats',cal:154,pro:5,crb:27,fat:2.6},{id:'c4',n:'Millet',cal:207,pro:6,crb:41,fat:1.7},{id:'c5',n:'Buckwheat',cal:155,pro:6,crb:34,fat:1},{id:'c6',n:'Amaranth',cal:251,pro:9,crb:46,fat:4},{id:'c7',n:'Teff',cal:255,pro:10,crb:50,fat:2},{id:'c8',n:'Wild Rice',cal:166,pro:7,crb:35,fat:0.6},{id:'c30',n:'Sorghum',cal:193,pro:6,crb:40,fat:2},{id:'c31',n:'Steel Cut Oats',cal:170,pro:7,crb:29,fat:3}],
'White':[{id:'c9',n:'White Rice',cal:206,pro:4,crb:45,fat:0.4},{id:'c10',n:'Jasmine Rice',cal:205,pro:4,crb:45,fat:0.4},{id:'c11',n:'Basmati Rice',cal:210,pro:4,crb:46,fat:0.5},{id:'c32',n:'Sushi Rice',cal:200,pro:4,crb:44,fat:0.3}],
'Starchy Veg':[{id:'c12',n:'Sweet Potato',cal:103,pro:2,crb:24,fat:0.1},{id:'c13',n:'Potato',cal:161,pro:4,crb:37,fat:0.2},{id:'c14',n:'Plantain',cal:116,pro:1,crb:31,fat:0.2},{id:'c15',n:'Taro',cal:142,pro:1,crb:34,fat:0.1},{id:'c16',n:'Butternut Squash',cal:82,pro:2,crb:22,fat:0.2},{id:'c17',n:'Parsnip',cal:75,pro:1,crb:18,fat:0.3},{id:'c33',n:'Acorn Squash',cal:56,pro:1,crb:15,fat:0.1},{id:'c34',n:'Yuca/Cassava',cal:160,pro:1,crb:38,fat:0.3}],
'Pasta':[{id:'c18',n:'GF Pasta',cal:176,pro:4,crb:39,fat:0.6},{id:'c19',n:'Rice Noodles',cal:192,pro:2,crb:44,fat:0.4},{id:'c20',n:'Polenta',cal:70,pro:2,crb:15,fat:0.3},{id:'c21',n:'Soba',cal:113,pro:6,crb:24,fat:0.1},{id:'c22',n:'Glass Noodles',cal:160,pro:0,crb:40,fat:0},{id:'c35',n:'Zucchini Noodles',cal:21,pro:2,crb:4,fat:0.4},{id:'c36',n:'Shirataki Noodles',cal:10,pro:0,crb:3,fat:0}],
'Wraps':[{id:'c23',n:'Corn Tortilla',cal:52,pro:1,crb:11,fat:0.7},{id:'c24',n:'Rice Cakes (2)',cal:70,pro:1,crb:14,fat:0.6},{id:'c25',n:'GF Bread',cal:80,pro:2,crb:15,fat:2},{id:'c26',n:'GF Wrap',cal:120,pro:2,crb:22,fat:3},{id:'c37',n:'Lettuce Wrap',cal:5,pro:0,crb:1,fat:0},{id:'c38',n:'Nori Sheets (4)',cal:20,pro:2,crb:2,fat:0}]}},
fats:{k:'cFa',ico:'ü•ë',clr:'#6B8E3A',bg:'#F0F5E8',subs:{
'Whole':[{id:'f1',n:'Avocado (¬º)',cal:80,pro:1,crb:4,fat:7.3},{id:'f2',n:'Olives (8)',cal:40,pro:0,crb:2,fat:4},{id:'f24',n:'Coconut Flakes (2T)',cal:70,pro:1,crb:3,fat:7}],
'Oils':[{id:'f3',n:'Olive Oil (1T)',cal:119,pro:0,crb:0,fat:14},{id:'f4',n:'Coconut Oil (1t)',cal:40,pro:0,crb:0,fat:5},{id:'f5',n:'Avocado Oil (1T)',cal:124,pro:0,crb:0,fat:14},{id:'f6',n:'Sesame Oil (1t)',cal:40,pro:0,crb:0,fat:5},{id:'f7',n:'Garlic-Infused Oil',cal:119,pro:0,crb:0,fat:14},{id:'f8',n:'Ghee (1t)',cal:45,pro:0,crb:0,fat:5},{id:'f25',n:'Walnut Oil (1T)',cal:120,pro:0,crb:0,fat:14},{id:'f26',n:'MCT Oil (1T)',cal:100,pro:0,crb:0,fat:14}],
'Nuts':[{id:'f9',n:'Walnuts (10)',cal:98,pro:2,crb:2,fat:10},{id:'f10',n:'Pecans (8)',cal:99,pro:1,crb:2,fat:10},{id:'f11',n:'Macadamia (6)',cal:102,pro:1,crb:2,fat:11},{id:'f12',n:'Almonds (10)',cal:70,pro:3,crb:2,fat:6},{id:'f13',n:'Pine Nuts (1T)',cal:57,pro:1,crb:1,fat:6},{id:'f14',n:'Cashews (10)',cal:78,pro:3,crb:4,fat:6},{id:'f27',n:'Brazil Nuts (3)',cal:99,pro:2,crb:2,fat:10},{id:'f28',n:'Hazelnuts (10)',cal:88,pro:2,crb:2,fat:9}],
'Seeds':[{id:'f15',n:'Chia Seeds (1T)',cal:58,pro:2,crb:5,fat:4},{id:'f16',n:'Flax Seeds (1T)',cal:37,pro:1,crb:2,fat:3},{id:'f17',n:'Hemp Hearts (1T)',cal:57,pro:3,crb:1,fat:4},{id:'f18',n:'Pumpkin Seeds (1T)',cal:47,pro:2,crb:1,fat:4},{id:'f19',n:'Sunflower Seeds',cal:51,pro:2,crb:2,fat:5},{id:'f29',n:'Sesame Seeds (1T)',cal:52,pro:2,crb:2,fat:4}],
'Butters':[{id:'f20',n:'Almond Butter (1T)',cal:98,pro:3,crb:3,fat:9},{id:'f21',n:'Tahini (1T)',cal:89,pro:3,crb:3,fat:8},{id:'f22',n:'Peanut Butter (1T)',cal:94,pro:4,crb:3,fat:8},{id:'f23',n:'Sunflower Butter',cal:99,pro:3,crb:4,fat:9},{id:'f30',n:'Cashew Butter (1T)',cal:94,pro:3,crb:4,fat:8}]}},
vegetables:{k:'cVe',ico:'ü•¨',clr:'#4C8C4A',bg:'#E8F2E4',subs:{
'Leafy':[{id:'v1',n:'Spinach',cal:23,pro:3,crb:4,fat:0.4},{id:'v2',n:'Kale',cal:33,pro:3,crb:6,fat:0.6},{id:'v3',n:'Swiss Chard',cal:19,pro:2,crb:4,fat:0.2},{id:'v4',n:'Bok Choy',cal:13,pro:2,crb:2,fat:0.2},{id:'v5',n:'Romaine',cal:15,pro:1,crb:3,fat:0.2},{id:'v6',n:'Arugula',cal:25,pro:3,crb:4,fat:0.7},{id:'v7',n:'Collard Greens',cal:32,pro:3,crb:6,fat:0.4},{id:'v30',n:'Watercress',cal:11,pro:2,crb:1,fat:0.1},{id:'v31',n:'Endive',cal:17,pro:1,crb:3,fat:0.2}],
'Root':[{id:'v8',n:'Carrots',cal:41,pro:1,crb:10,fat:0.2},{id:'v9',n:'Turnip',cal:28,pro:1,crb:6,fat:0.1},{id:'v10',n:'Radishes',cal:16,pro:1,crb:3,fat:0.1},{id:'v11',n:'Rutabaga',cal:37,pro:1,crb:9,fat:0.2},{id:'v12',n:'Jicama',cal:38,pro:1,crb:9,fat:0.1},{id:'v13',n:'Beets (sm)',cal:43,pro:2,crb:10,fat:0.2},{id:'v32',n:'Ginger Root',cal:5,pro:0,crb:1,fat:0},{id:'v33',n:'Daikon',cal:18,pro:1,crb:4,fat:0.1}],
'Fruiting':[{id:'v14',n:'Zucchini',cal:17,pro:1,crb:3,fat:0.3},{id:'v15',n:'Bell Pepper',cal:31,pro:1,crb:6,fat:0.3},{id:'v16',n:'Eggplant',cal:25,pro:1,crb:6,fat:0.2},{id:'v17',n:'Tomato',cal:18,pro:1,crb:4,fat:0.2},{id:'v18',n:'Cucumber',cal:16,pro:1,crb:4,fat:0.1},{id:'v19',n:'Yellow Squash',cal:18,pro:1,crb:4,fat:0.2},{id:'v20',n:'Spaghetti Squash',cal:31,pro:1,crb:7,fat:0.6},{id:'v34',n:'Cherry Tomatoes',cal:18,pro:1,crb:4,fat:0.2},{id:'v35',n:'Chayote Squash',cal:19,pro:1,crb:4,fat:0.1}],
'Pods & Stems':[{id:'v21',n:'Green Beans',cal:31,pro:2,crb:7,fat:0.1},{id:'v22',n:'Chives',cal:3,pro:0,crb:1,fat:0},{id:'v23',n:'Bean Sprouts',cal:31,pro:3,crb:6,fat:0.2},{id:'v24',n:'Bamboo Shoots',cal:27,pro:3,crb:5,fat:0.3},{id:'v25',n:'Fennel',cal:27,pro:1,crb:6,fat:0.2},{id:'v26',n:'Celery',cal:6,pro:0,crb:1,fat:0.1},{id:'v27',n:'Snap Peas',cal:26,pro:2,crb:4,fat:0.1},{id:'v28',n:'Okra',cal:33,pro:2,crb:7,fat:0.2},{id:'v36',n:'Asparagus Tips',cal:20,pro:2,crb:4,fat:0.1},{id:'v37',n:'Hearts of Palm',cal:28,pro:3,crb:5,fat:0.5}]}},
fruits:{k:'cFr',ico:'üçì',clr:'#C44A7A',bg:'#FCE8F0',subs:{
'Berries':[{id:'fr1',n:'Strawberries',cal:32,pro:1,crb:8,fat:0.3},{id:'fr2',n:'Blueberries',cal:57,pro:1,crb:14,fat:0.3},{id:'fr3',n:'Raspberries',cal:52,pro:1,crb:12,fat:0.7},{id:'fr4',n:'Blackberries',cal:43,pro:1,crb:10,fat:0.5},{id:'fr5',n:'Cranberries',cal:46,pro:0,crb:12,fat:0.1},{id:'fr22',n:'Gooseberries',cal:44,pro:1,crb:10,fat:0.4}],
'Citrus':[{id:'fr6',n:'Orange',cal:47,pro:1,crb:12,fat:0.1},{id:'fr7',n:'Clementine',cal:35,pro:1,crb:9,fat:0.1},{id:'fr8',n:'Lemon',cal:17,pro:1,crb:5,fat:0.2},{id:'fr9',n:'Lime',cal:20,pro:0,crb:7,fat:0.1},{id:'fr10',n:'Grapefruit (¬Ω)',cal:42,pro:1,crb:11,fat:0.1},{id:'fr23',n:'Kumquat (3)',cal:40,pro:1,crb:9,fat:0.5}],
'Tropical':[{id:'fr11',n:'Kiwi',cal:42,pro:1,crb:10,fat:0.4},{id:'fr12',n:'Pineapple',cal:50,pro:1,crb:13,fat:0.1},{id:'fr13',n:'Papaya',cal:43,pro:1,crb:11,fat:0.3},{id:'fr14',n:'Dragon Fruit',cal:60,pro:1,crb:13,fat:0.4},{id:'fr15',n:'Star Fruit',cal:31,pro:1,crb:7,fat:0.3},{id:'fr16',n:'Passion Fruit',cal:17,pro:0,crb:4,fat:0.1},{id:'fr24',n:'Guava',cal:37,pro:1,crb:8,fat:0.5}],
'Melons & Other':[{id:'fr17',n:'Cantaloupe',cal:34,pro:1,crb:8,fat:0.2},{id:'fr18',n:'Honeydew',cal:36,pro:1,crb:9,fat:0.1},{id:'fr19',n:'Grapes (sm)',cal:62,pro:1,crb:16,fat:0.3},{id:'fr20',n:'Firm Banana',cal:89,pro:1,crb:23,fat:0.3},{id:'fr21',n:'Rhubarb',cal:21,pro:1,crb:5,fat:0.2},{id:'fr25',n:'Pomegranate Seeds',cal:72,pro:1,crb:16,fat:1}]}},
cheese:{k:'cCh',ico:'üßÄ',clr:'#B8860B',bg:'#FFF8E7',subs:{
'Hard':[{id:'ch1',n:'Aged Cheddar',cal:113,pro:7,crb:0,fat:9},{id:'ch2',n:'Parmesan',cal:110,pro:10,crb:1,fat:7},{id:'ch3',n:'Gruy√®re',cal:117,pro:8,crb:0,fat:9},{id:'ch4',n:'Manchego',cal:110,pro:7,crb:0,fat:9},{id:'ch5',n:'Aged Gouda',cal:101,pro:7,crb:1,fat:8},{id:'ch6',n:'Pecorino',cal:110,pro:8,crb:1,fat:8},{id:'ch7',n:'Emmental',cal:108,pro:8,crb:0,fat:8},{id:'ch8',n:'Comt√©',cal:114,pro:8,crb:0,fat:9},{id:'ch20',n:'Asiago',cal:110,pro:7,crb:1,fat:9}],
'Semi-Soft':[{id:'ch9',n:'Swiss',cal:108,pro:8,crb:2,fat:8},{id:'ch10',n:'Brie',cal:95,pro:6,crb:0,fat:8},{id:'ch11',n:'Havarti',cal:105,pro:6,crb:0,fat:9},{id:'ch12',n:'Monterey Jack',cal:106,pro:7,crb:0,fat:9},{id:'ch13',n:'Camembert',cal:85,pro:6,crb:0,fat:7},{id:'ch21',n:'Provolone',cal:98,pro:7,crb:1,fat:7}],
'Soft':[{id:'ch14',n:'Feta',cal:75,pro:4,crb:1,fat:6},{id:'ch15',n:'Mozzarella',cal:70,pro:5,crb:1,fat:5},{id:'ch16',n:'Goat Cheese',cal:75,pro:5,crb:0,fat:6},{id:'ch17',n:'Cottage LF',cal:98,pro:11,crb:3,fat:4},{id:'ch18',n:'Ricotta LF',cal:85,pro:7,crb:3,fat:5},{id:'ch19',n:'Cream Cheese LF',cal:70,pro:3,crb:2,fat:6},{id:'ch22',n:'Mascarpone LF',cal:80,pro:2,crb:1,fat:7}]}},
desserts:{k:'cDe',ico:'üçÆ',clr:'#A0522D',bg:'#FDF5EF',subs:{
'Chocolate':[{id:'d1',n:'Dark Choc 85%',cal:90,pro:1,crb:10,fat:6},{id:'d2',n:'Cacao Nibs',cal:35,pro:1,crb:3,fat:3},{id:'d3',n:'Coconut Macaroons',cal:120,pro:1,crb:14,fat:7},{id:'d4',n:'PB Energy Balls',cal:140,pro:5,crb:12,fat:9},{id:'d16',n:'Choc Avocado Mousse',cal:130,pro:2,crb:12,fat:9}],
'Puddings':[{id:'d5',n:'Chia Pudding',cal:140,pro:4,crb:15,fat:8},{id:'d6',n:'Rice Pudding LF',cal:130,pro:4,crb:22,fat:3},{id:'d7',n:'Panna Cotta LF',cal:150,pro:3,crb:16,fat:8},{id:'d8',n:'Coconut Pudding',cal:135,pro:1,crb:18,fat:7},{id:'d17',n:'Tapioca Pudding',cal:120,pro:2,crb:20,fat:3}],
'Frozen':[{id:'d9',n:'Banana Nice Cream',cal:105,pro:1,crb:27,fat:0.3},{id:'d10',n:'Strawberry Sorbet',cal:80,pro:0,crb:21,fat:0},{id:'d11',n:'Lemon Sorbet',cal:80,pro:0,crb:21,fat:0},{id:'d18',n:'Coconut Milk Popsicle',cal:60,pro:0,crb:10,fat:3}],
'Baked GF':[{id:'d12',n:'GF Oat Cookie',cal:95,pro:2,crb:14,fat:4},{id:'d13',n:'Flourless Cake',cal:120,pro:3,crb:14,fat:7},{id:'d14',n:'GF Muffin',cal:130,pro:2,crb:20,fat:5},{id:'d15',n:'Maple Baked Pear',cal:110,pro:0,crb:28,fat:0.2},{id:'d19',n:'GF Banana Bread',cal:140,pro:3,crb:22,fat:5}]}},
glutenfree:{k:'cGF',ico:'üåæ',clr:'#8B7355',bg:'#F7F3ED',subs:{
'Flours':[{id:'gf1',n:'Almond Flour',cal:160,pro:6,crb:6,fat:14},{id:'gf2',n:'Coconut Flour',cal:60,pro:2,crb:9,fat:2.5},{id:'gf3',n:'Rice Flour',cal:145,pro:2,crb:32,fat:0.5},{id:'gf4',n:'Tapioca Starch',cal:52,pro:0,crb:13,fat:0},{id:'gf5',n:'Oat Flour GF',cal:120,pro:4,crb:21,fat:2},{id:'gf6',n:'Buckwheat Flour',cal:100,pro:4,crb:21,fat:1},{id:'gf15',n:'Cassava Flour',cal:114,pro:0,crb:28,fat:0},{id:'gf16',n:'Sorghum Flour',cal:120,pro:4,crb:25,fat:1}],
'Bread':[{id:'gf7',n:'GF Bread',cal:80,pro:2,crb:15,fat:2},{id:'gf8',n:'GF Tortilla',cal:120,pro:2,crb:22,fat:3},{id:'gf9',n:'Rice Paper (2)',cal:60,pro:0,crb:14,fat:0},{id:'gf10',n:'GF Pita',cal:140,pro:3,crb:28,fat:2}],
'Crackers':[{id:'gf11',n:'GF Crackers (6)',cal:70,pro:1,crb:12,fat:2},{id:'gf12',n:'Rice Cakes (2)',cal:70,pro:1,crb:14,fat:0.6},{id:'gf13',n:'GF Granola',cal:130,pro:3,crb:18,fat:5},{id:'gf14',n:'GF Pretzels',cal:110,pro:1,crb:23,fat:1},{id:'gf17',n:'Seed Crackers (6)',cal:90,pro:3,crb:8,fat:6}]}},
vegetarian:{k:'cVg',ico:'üå±',clr:'#2E8B57',bg:'#E8F8EE',subs:{
'Soy':[{id:'vg1',n:'Extra Firm Tofu',cal:144,pro:17,crb:3,fat:9},{id:'vg2',n:'Tempeh',cal:192,pro:20,crb:8,fat:11},{id:'vg3',n:'Edamame',cal:95,pro:9,crb:7,fat:4},{id:'vg4',n:'Smoked Tofu',cal:140,pro:16,crb:2,fat:8},{id:'vg13',n:'Silken Tofu',cal:55,pro:5,crb:2,fat:3}],
'Dairy':[{id:'vg5',n:'Greek Yogurt LF',cal:100,pro:17,crb:6,fat:0.7},{id:'vg6',n:'Eggs (2)',cal:147,pro:10,crb:1,fat:11},{id:'vg7',n:'Egg Whites (4)',cal:68,pro:14,crb:1,fat:0},{id:'vg8',n:'Paneer',cal:164,pro:12,crb:2,fat:12}],
'Boosters':[{id:'vg9',n:'Nutritional Yeast',cal:45,pro:8,crb:5,fat:0.5},{id:'vg10',n:'Hemp Hearts',cal:170,pro:10,crb:3,fat:13},{id:'vg11',n:'Spirulina',cal:20,pro:4,crb:1,fat:0.5},{id:'vg12',n:'Plant Protein',cal:110,pro:24,crb:3,fat:1},{id:'vg14',n:'Bee Pollen (1t)',cal:16,pro:1,crb:3,fat:0.3}]}},
sourdough:{k:'cSo',ico:'üçû',clr:'#CD853F',bg:'#FFF5E6',subs:{
'Loaves':[{id:'sd1',n:'Classic Sourdough',cal:90,pro:4,crb:18,fat:0.5},{id:'sd2',n:'Spelt SD',cal:95,pro:4,crb:19,fat:0.5},{id:'sd3',n:'Rye SD',cal:85,pro:3,crb:17,fat:0.5},{id:'sd4',n:'GF Sourdough',cal:80,pro:2,crb:16,fat:1},{id:'sd5',n:'Multigrain SD',cal:100,pro:4,crb:19,fat:1},{id:'sd6',n:'Olive SD',cal:105,pro:3,crb:18,fat:3}],
'Specialty':[{id:'sd7',n:'SD English Muffin',cal:120,pro:4,crb:22,fat:1.5},{id:'sd8',n:'SD Bagel (¬Ω)',cal:140,pro:5,crb:26,fat:1},{id:'sd9',n:'SD Flatbread',cal:110,pro:3,crb:20,fat:2},{id:'sd10',n:'SD Crackers',cal:80,pro:2,crb:14,fat:2}],
'Cooking':[{id:'sd11',n:'SD Pizza Dough',cal:150,pro:5,crb:28,fat:2},{id:'sd12',n:'SD Pancakes',cal:160,pro:5,crb:24,fat:5},{id:'sd13',n:'SD Breadcrumbs',cal:50,pro:2,crb:10,fat:0.5}]}},
probiotics:{k:'cPb',ico:'ü¶†',clr:'#7A5C8C',bg:'#F2EBF6',subs:{
'Dairy':[{id:'pb1',n:'Kefir LF',cal:110,pro:11,crb:12,fat:2},{id:'pb2',n:'Coconut Yogurt',cal:110,pro:1,crb:8,fat:7},{id:'pb3',n:'Skyr LF',cal:100,pro:15,crb:7,fat:0.5},{id:'pb4',n:'Almond Yogurt',cal:80,pro:1,crb:10,fat:4},{id:'pb13',n:'Oat Yogurt',cal:90,pro:2,crb:14,fat:3}],
'Fermented':[{id:'pb5',n:'Sauerkraut',cal:14,pro:1,crb:3,fat:0.1},{id:'pb6',n:'Kimchi (mild)',cal:15,pro:1,crb:2,fat:0.5},{id:'pb7',n:'Miso Paste',cal:34,pro:2,crb:4,fat:1},{id:'pb8',n:'Pickles',cal:8,pro:0,crb:2,fat:0},{id:'pb9',n:'Natto',cal:43,pro:4,crb:3,fat:2},{id:'pb14',n:'Fermented Carrots',cal:12,pro:0,crb:3,fat:0}],
'Drinks':[{id:'pb10',n:'Kombucha',cal:30,pro:0,crb:7,fat:0},{id:'pb11',n:'Water Kefir',cal:20,pro:0,crb:5,fat:0},{id:'pb12',n:'ACV (1T)',cal:3,pro:0,crb:0,fat:0}]}},
supplements:{k:'cSu',ico:'üíä',clr:'#4A8CC4',bg:'#E4F0FA',subs:{
'Essential':[{id:'su1',n:'Multivitamin+Iron',cal:0,pro:0,crb:0,fat:0,note:'Daily'},{id:'su2',n:'Calcium Citrate+D',cal:0,pro:0,crb:0,fat:0,note:'1500mg/day'},{id:'su3',n:'B12 Sublingual',cal:0,pro:0,crb:0,fat:0,note:'500mcg'},{id:'su4',n:'Vitamin D3',cal:0,pro:0,crb:0,fat:0,note:'800IU'},{id:'su5',n:'Iron',cal:0,pro:0,crb:0,fat:0,note:'If needed'}],
'Recommended':[{id:'su6',n:'Protein Powder',cal:120,pro:30,crb:3,fat:1,note:'Whey/plant'},{id:'su7',n:'Probiotic Capsule',cal:0,pro:0,crb:0,fat:0,note:'Gut health'},{id:'su8',n:'Omega-3 Fish Oil',cal:10,pro:0,crb:0,fat:1,note:'EPA/DHA'},{id:'su9',n:'Magnesium',cal:0,pro:0,crb:0,fat:0,note:'200-400mg'},{id:'su10',n:'Zinc',cal:0,pro:0,crb:0,fat:0,note:'8-11mg'},{id:'su11',n:'Collagen',cal:40,pro:10,crb:0,fat:0,note:'Joint/skin'}]}}
};
const flatDB=function(cat){var o=[];var keys=Object.keys(cat.subs);for(var i=0;i<keys.length;i++){var arr=cat.subs[keys[i]];for(var j=0;j<arr.length;j++){o.push(arr[j]);}}return o;};
const catKeys=Object.keys(DB);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BMI & CALORIE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function calcBMI(wk,hc){return wk/Math.pow(hc/100,2);}
function bmiCat(b,t){if(b<18.5)return{l:t.bmiU,c:'#4A8CC4',bg:'#E4F0FA'};if(b<25)return{l:t.bmiN,c:'#4C8C4A',bg:'#E8F2E4'};if(b<30)return{l:t.bmiOv,c:'#C4923A',bg:'#FFF5E0'};if(b<35)return{l:t.bmiO1,c:'#C4564A',bg:'#FCEAE8'};if(b<40)return{l:t.bmiO2,c:'#C4564A',bg:'#FCEAE8'};return{l:t.bmiO3,c:'#8B0000',bg:'#FFE0E0'};}
function calcBMR(sex,wk,hc,age){return sex==='male'?(10*wk+6.25*hc-5*age+5):(10*wk+6.25*hc-5*age-161);}
function calcTDEE(bmr){return Math.round(bmr*1.2*1.3);}
function goalCal(tdee,g){return g==='lose'?Math.max(800,tdee-500):g==='gain'?tdee+300:tdee;}
function macroSplit(cal,g){var s=g==='lose'?{p:.40,c:.30,f:.30}:g==='gain'?{p:.35,c:.40,f:.25}:{p:.35,c:.35,f:.30};return{pro:Math.round(cal*s.p/4),crb:Math.round(cal*s.c/4),fat:Math.round(cal*s.f/9),fib:Math.round(cal/1000*14)};}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EXPANDED MEAL GENERATOR ‚Äî detailed preps ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function pickReal(a){if(!a||!a.length)return null;var real=[];for(var i=0;i<a.length;i++){if(!a[i].na)real.push(a[i]);}return real.length?real[Math.floor(Math.random()*real.length)]:null;}
function pick(a){return pickReal(a);}
function genMeal(type,sel,cal){
  var p=pick(sel.proteins||[]),c=pick(sel.carbs||[]),f=pick(sel.fats||[]),v=pick(sel.vegetables||[]),fr=pick(sel.fruits||[]),ch=pick(sel.cheese||[]),ds=pick(sel.desserts||[]),gf=pick(sel.glutenfree||[]),vg=pick(sel.vegetarian||[]),sd=pick(sel.sourdough||[]),pb=pick(sel.probiotics||[]);
  var pn=p?p.n:'Chicken Breast',cn=c?c.n:'Brown Rice',fn=f?f.n:'Olive Oil',vn=v?v.n:'Spinach',frn=fr?fr.n:'Blueberries',chn=ch?ch.n:'Parmesan',dsn=ds?ds.n:'Dark Choc 85%',gfn=gf?gf.n:'GF Crackers',vgn=vg?vg.n:'Tempeh',sdn=sd?sd.n:'Classic Sourdough',pbn=pb?pb.n:'Kefir LF';
  cal=cal||350;var sz=cal<300?'small':cal<400?'standard':'generous';
  var bT='‚ö†Ô∏è BYPASS TIP: ';
  var meals={
  breakfast:[
    {name:pn+' Scramble + '+chn,desc:pn+' scrambled with '+vn+', topped with '+chn+', side of '+frn,
     health:'High-protein breakfast stabilizes blood sugar post-bypass. '+vn+' adds iron and fiber. Aged cheese provides calcium with virtually no lactose ‚Äî critical after bypass when dairy tolerance drops.',
     prep:'PREP TIME: 12 min | COOK: 8 min | TOTAL: 20 min\n\n1. MISE EN PLACE: Dice '+vn+' into small, uniform pieces (¬Ω-inch). Grate or crumble '+chn+' (about 1 oz). Wash and portion '+frn+'.\n2. HEAT: Warm a non-stick skillet over medium heat (not high ‚Äî bypass patients need gentle cooking to preserve moisture). Add '+fn+' and swirl to coat.\n3. PROTEIN FIRST: If using raw '+pn+', cook through for 3-4 min, breaking into small bite-size pieces. Season with pinch of salt, black pepper, and dried oregano.\n4. ADD VEGETABLES: Toss in '+vn+', saut√© 2 min until just wilted but still vibrant green. Stir gently.\n5. FINISH: Remove from heat. Top immediately with '+chn+' so it melts slightly from residual heat.\n6. PLATE: Serve '+sz+' portions on a warm plate. Place '+frn+' on the side ‚Äî eat protein first, fruit last.\n7. EATING PACE: Set a 20-minute timer. Take small bites, chew each 20-25 times before swallowing.\n\n'+bT+'Eat protein portion first ('+pn+' + '+chn+'), then vegetables, then fruit. This ensures you get adequate protein even if you feel full early.',cal:cal},
    {name:sdn+' Toast + '+pn,desc:'Toasted '+sdn+' with seasoned '+pn+', '+vn+', melted '+chn,
     health:'Sourdough fermentation breaks down ~90% of FODMAPs (fructans) that trigger IBS symptoms. The long fermentation also partially digests gluten proteins, making it gentler on a post-bypass digestive system.',
     prep:'PREP TIME: 5 min | COOK: 10 min | TOTAL: 15 min\n\n1. TOAST: Slice '+sdn+' to ¬æ-inch thickness. Toast until golden and crisp ‚Äî this makes it easier to digest and less doughy.\n2. PROTEIN: Season '+pn+' with smoked paprika, cumin, and a pinch of salt. Cook in a skillet with '+fn+' over medium heat, 3-4 min per side until internal temp reaches 165¬∞F.\n3. SLICE: Rest '+pn+' for 2 min, then slice thin against the grain. Thin slices are critical for bypass ‚Äî easier to chew thoroughly.\n4. WILT VEG: In the same skillet (don\'t wash ‚Äî use residual flavor), add '+vn+' and toss 60 seconds until just wilted.\n5. ASSEMBLE: Place '+vn+' on toast, layer '+pn+' slices on top, finish with '+chn+'.\n6. OPTIONAL: Flash under broiler 30 seconds to melt '+chn+'.\n7. CUT: Slice into strips for easier handling. Eat open-faced to halve bread intake.\n\n'+bT+'One slice of sourdough is enough post-bypass. The protein-to-bread ratio should favor protein heavily.',cal:cal},
    {name:'Overnight '+cn+' Bowl',desc:cn+' soaked overnight with '+pbn+', topped with '+frn+' and '+fn,
     health:'Overnight soaking pre-digests starches through enzymatic breakdown ‚Äî this significantly eases digestion for bypass patients. '+pbn+' introduces beneficial probiotics that help rebuild gut flora disrupted by surgery.',
     prep:'PREP TIME: 5 min (night before) | MORNING: 3 min | TOTAL: 8 min active\n\n1. EVENING PREP: In a mason jar or container, combine ¬Ω cup '+cn+' with ¬Ω cup '+pbn+'. Stir well.\n2. FLAVOR: Add a pinch of cinnamon and a drop of vanilla extract. These are FODMAP-safe flavor boosters.\n3. SEAL & CHILL: Cover tightly and refrigerate 6-8 hours (overnight). The '+cn+' will absorb liquid and soften.\n4. MORNING CHECK: Stir well. If too thick, add 1-2 tablespoons of '+pbn+' to reach desired consistency.\n5. TOP: Layer '+frn+' on top. Drizzle with '+fn+' for healthy fats and satiety.\n6. OPTIONAL PROTEIN BOOST: Stir in 1 scoop protein powder or 1T chia seeds for added protein (aim for 20g+ per meal).\n7. TEMPERATURE: Eat cold or microwave 60 seconds for warm porridge ‚Äî both work well.\n\n'+bT+'This is an excellent bypass-friendly breakfast because the soaking pre-digests the grains. Start with the protein-boosted portion first.',cal:cal},
    {name:vgn+' Breakfast Bowl',desc:'Seasoned '+vgn+' with saut√©ed '+vn+', '+cn+', and '+pbn,
     health:'Plant protein from '+vgn+' provides complete amino acids with anti-inflammatory isoflavones. Easier to digest in the morning when the gastric pouch is most sensitive.',
     prep:'PREP TIME: 5 min | COOK: 10 min | TOTAL: 15 min\n\n1. CRUMBLE: Break '+vgn+' into small pieces with your hands or a fork ‚Äî pea-sized crumbles work best.\n2. SEASON: Toss crumbles with turmeric (¬º tsp), smoked paprika (¬º tsp), and pinch of salt.\n3. PAN-FRY: Heat '+fn+' in a skillet over medium heat. Add '+vgn+' crumbles and cook 4-5 min, stirring occasionally, until golden and slightly crispy on edges.\n4. ADD GREENS: Push '+vgn+' to one side. Add '+vn+' to empty side, saut√© 1-2 min until wilted.\n5. GRAIN: Warm ¬º cup pre-cooked '+cn+' (microwave 30 sec or add to pan edge).\n6. BOWL: Layer: '+cn+' base, '+vn+' middle, '+vgn+' on top.\n7. FINISH: Side of '+pbn+' in a small cup. Garnish with fresh herbs if available.\n\n'+bT+'Chew '+vgn+' very thoroughly ‚Äî plant proteins are denser and need more mechanical breakdown in a smaller stomach.',cal:cal},
    {name:'Protein '+pbn+' Parfait',desc:'Layered '+pbn+' with '+frn+', '+fn+', and '+gfn+' crumble',
     health:'Probiotic-rich '+pbn+' rebuilds gut microbiome diversity after bypass surgery. Layered eating helps pace consumption, and the combination of protein, fat, and carbs provides sustained energy.',
     prep:'PREP TIME: 5 min | TOTAL: 5 min (no cook!)\n\n1. BASE: Spoon ¬Ω cup '+pbn+' into a glass or bowl.\n2. CRUNCH: Crush 2-3 '+gfn+' into small pieces. Sprinkle half over yogurt.\n3. FRUIT: Add a layer of '+frn+'.\n4. REPEAT: Another layer of '+pbn+' (¬º cup), remaining crumble, more '+frn+'.\n5. DRIZZLE: Finish with '+fn+' for healthy fats.\n6. PROTEIN BOOST: Optional ‚Äî fold in 1 scoop protein powder into first '+pbn+' layer before assembling.\n7. EAT SLOWLY: Use a small spoon. Take 15-20 minutes minimum.\n\n'+bT+'This cold, soft meal is ideal for mornings when the pouch feels tight. The layers naturally slow your eating pace.',cal:cal},
    {name:pn+' & '+vn+' Frittata',desc:'Baked egg frittata with '+pn+', '+vn+', and '+chn,
     health:'Frittatas are among the best bypass-friendly meals ‚Äî soft texture, high protein, easily portioned. Baking instead of frying reduces added fat while keeping moisture.',
     prep:'PREP TIME: 10 min | COOK: 20 min | TOTAL: 30 min\n\n1. PREHEAT oven to 350¬∞F. Grease an oven-safe skillet or 8" baking dish with '+fn+'.\n2. PREP PROTEIN: Dice '+pn+' small (¬º-inch). Season lightly with Italian herbs, salt, pepper.\n3. SAUT√â: Cook '+pn+' in skillet 3-4 min over medium heat until cooked through.\n4. ADD VEG: Toss in '+vn+', cook 1-2 min until just wilted.\n5. WHISK: In a bowl, beat 4 eggs (or 2 eggs + 4 whites for higher protein). Season with salt and pepper.\n6. COMBINE: Pour egg mixture over the '+pn+' and '+vn+' in skillet. Sprinkle '+chn+' on top.\n7. BAKE: Transfer to oven, bake 18-20 min until eggs are set and top is lightly golden.\n8. REST: Let cool 5 min. Slice into '+sz+' wedges. Refrigerate extras for up to 3 days.\n\n'+bT+'Cut into small wedges. One wedge = one bypass meal. The soft texture requires less chewing but STILL chew thoroughly.',cal:cal}
  ],
  lunch:[
    {name:'Grilled '+pn+' Power Bowl',desc:pn+' over '+cn+' with '+vn+', '+fn+', '+chn,
     health:'Protein-forward bowl supports muscle maintenance post-surgery. The combination of complex carbs and protein provides steady energy without the blood sugar spikes that trigger dumping syndrome.',
     prep:'PREP TIME: 10 min | COOK: 15 min | TOTAL: 25 min\n\n1. GRAIN PREP: Cook '+cn+' according to package (or use pre-cooked). You need ¬Ω cup cooked ‚Äî measure precisely for bypass portioning.\n2. SEASON PROTEIN: Pat '+pn+' dry with paper towels. Season both sides with: cumin (¬Ω tsp), smoked paprika (¬Ω tsp), garlic-infused oil (1 tsp), salt, pepper.\n3. GRILL/PAN-SEAR: Heat a grill pan or skillet to medium-high. Cook '+pn+' 4-5 min per side. For fish: 3-4 min per side. Internal temp: chicken 165¬∞F, fish 145¬∞F.\n4. REST: Remove '+pn+' to a cutting board. Rest 3-5 min (this keeps it juicy and tender ‚Äî critical for bypass digestion).\n5. VEG: While protein rests, steam or saut√© '+vn+' with a splash of water, 2-3 min. Season with lemon juice.\n6. SLICE: Cut '+pn+' into thin strips against the grain. Small, thin pieces prevent blockage.\n7. BOWL: Layer: '+cn+' base ‚Üí '+vn+' ‚Üí '+pn+' strips ‚Üí '+chn+' shavings ‚Üí drizzle of '+fn+'.\n8. GARNISH: Fresh herbs (basil, parsley), squeeze of lemon.\n\n'+bT+'Eat in order: protein first, then vegetables, then grain. Stop when you feel satisfied ‚Äî do not finish if full.',cal:cal},
    {name:sdn+' Open Sandwich',desc:'Open-face '+sdn+' with '+pn+', '+vn+', melted '+chn,
     health:'Open-faced cuts bread intake by 50%. Sourdough\'s lower glycemic index (54 vs 71 for white bread) prevents blood sugar crashes that are dangerous post-bypass.',
     prep:'PREP TIME: 5 min | COOK: 12 min | TOTAL: 17 min\n\n1. TOAST: Slice '+sdn+' ¬æ-inch thick. Toast until golden and firm ‚Äî not soft and doughy.\n2. COOK PROTEIN: Season '+pn+' with herbs de Provence. Cook in skillet with '+fn+' over medium heat. Slice very thin when done.\n3. PREP VEG: Wash and prep '+vn+'. If leafy, keep raw for crunch. If firm, quick saut√© 1-2 min.\n4. SPREAD: Optional thin smear of mustard or '+fn+' on toast as moisture barrier.\n5. LAYER: '+vn+' first (bed), then '+pn+' slices (generous), '+chn+' on top.\n6. MELT: Place under broiler 45-60 seconds until '+chn+' is melted and bubbly.\n7. CUT: Slice diagonally into strips. Eat with knife and fork, not hands ‚Äî smaller bites.\n\n'+bT+'One slice only. The protein and cheese should be the stars, bread is just the vehicle.',cal:cal},
    {name:pn+' Lettuce Wraps',desc:pn+' in crisp lettuce cups with '+vn+', '+fn+', herbs',
     health:'Lettuce wraps eliminate bread entirely while adding hydration. The high water content of lettuce supports the 64oz daily fluid goal. Zero FODMAPs in lettuce.',
     prep:'PREP TIME: 10 min | COOK: 8 min | TOTAL: 18 min\n\n1. LETTUCE: Carefully separate large butter lettuce or romaine leaves. Wash, pat dry, set in cups on a plate.\n2. DICE: Cut '+pn+' into very small dice (¬º-inch cubes). This is essential for bypass ‚Äî small pieces prevent food from getting stuck.\n3. SEASON: Toss '+pn+' with ground ginger (¬º tsp), garlic-infused oil (1 tsp), pinch of salt, and a splash of tamari/soy sauce (GF).\n4. COOK: Heat '+fn+' in wok or large skillet over medium-high. Stir-fry '+pn+' 3-4 min until golden.\n5. ADD VEG: Toss in finely diced '+vn+', stir-fry 1-2 min until tender-crisp.\n6. FILL: Spoon 2-3 tablespoons of mixture into each lettuce cup. Don\'t overfill.\n7. GARNISH: Fresh cilantro, squeeze of lime, sesame seeds.\n8. SERVE: Make 3-4 small wraps. Eat one at a time, chewing completely.\n\n'+bT+'These are one of the best bypass meals ‚Äî soft filling, fresh wrapper, easy to portion, naturally small servings.',cal:cal},
    {name:'Mediterranean '+cn+' Plate',desc:cn+' + '+pn+', roasted '+vn+', '+chn+', herbs',
     health:'Mediterranean diet is clinically shown to reduce inflammation by 20-30% ‚Äî critical for IBS. Anti-inflammatory olive oil provides oleic acid that soothes the gut lining.',
     prep:'PREP TIME: 10 min | COOK: 25 min | TOTAL: 35 min\n\n1. PREHEAT: Oven to 400¬∞F. Line a sheet pan with parchment paper.\n2. PREP VEG: Cut '+vn+' into uniform small pieces. Toss with '+fn+', dried oregano, salt, and pepper.\n3. ROAST: Spread '+vn+' on sheet pan in single layer. Roast 18-22 min until edges are golden and caramelized.\n4. GRAIN: While veg roasts, cook '+cn+' ‚Äî ¬Ω cup measured after cooking. Fluff with fork.\n5. PROTEIN: Season '+pn+' with lemon zest, oregano, salt. Pan-sear in skillet 4-5 min per side.\n6. SLICE: Let '+pn+' rest 3 min, then slice thin.\n7. PLATE: Arrange '+cn+' on plate, fan '+pn+' slices alongside, pile roasted '+vn+', crumble '+chn+' over everything.\n8. DRESS: Drizzle with '+fn+', squeeze of fresh lemon, fresh basil if available.\n\n'+bT+'This plate naturally encourages the bypass eating order: start with protein slices, move to vegetables, finish with grain.',cal:cal},
    {name:vgn+' Stir-Fry Bowl',desc:'Crispy '+vgn+' with '+vn+', '+cn+', ginger-sesame sauce',
     health:'Plant-based protein variety prevents flavor fatigue on a restricted diet. '+vgn+' provides both protein and prebiotics (food for probiotics), supporting gut health from both ends.',
     prep:'PREP TIME: 8 min | COOK: 10 min | TOTAL: 18 min\n\n1. CUBE: Cut '+vgn+' into ¬Ω-inch cubes. Pat dry with paper towel (moisture = no crisp).\n2. SAUCE: Mix 1T tamari/soy sauce + 1t ginger (grated) + '+fn+' (1t) + splash of rice vinegar.\n3. SEAR: Heat '+fn+' in a large skillet or wok over medium-high. Add '+vgn+' cubes in single layer. Don\'t stir for 2-3 min to get golden crust. Flip, cook 2 min more.\n4. VEG: Push '+vgn+' aside, add '+vn+' cut into thin strips. Toss 1-2 min.\n5. SAUCE: Pour sauce over everything, toss to coat. Cook 30 seconds.\n6. BASE: Serve over ¬Ω cup warmed '+cn+'.\n7. FINISH: Sesame seeds, sliced green onion tops (green part only ‚Äî FODMAP safe).\n\n'+bT+'Chew '+vgn+' especially well. Plant proteins are dense and need thorough mechanical breakdown.',cal:cal}
  ],
  dinner:[
    {name:'Herb-Baked '+pn+' & '+vn,desc:pn+' baked with herbs, roasted '+vn+', '+cn+', melted '+chn,
     health:'Baking at moderate temperature preserves nutrients and creates tender, moist protein that\'s ideal for the small gastric pouch. Fresh herbs are all FODMAP-safe and rich in anti-inflammatory compounds.',
     prep:'PREP TIME: 10 min | COOK: 25 min | TOTAL: 35 min\n\n1. PREHEAT: Oven to 375¬∞F. Line a baking dish with parchment for easy cleanup.\n2. SEASON PROTEIN: Pat '+pn+' dry. Rub both sides with: '+fn+' (1 tsp), dried thyme, rosemary, salt, pepper. For extra flavor, add lemon slices underneath.\n3. PREP VEG: Cut '+vn+' into bite-size pieces. Toss with '+fn+', salt, Italian seasoning.\n4. ARRANGE: Place '+pn+' in center of baking dish. Surround with '+vn+' in a single layer.\n5. CHEESE: Sprinkle '+chn+' over '+pn+' and vegetables.\n6. BAKE: 22-28 min until '+pn+' reaches safe internal temp (chicken 165¬∞F, fish 145¬∞F, pork 145¬∞F). Vegetables should be fork-tender.\n7. REST: Remove from oven, tent with foil, rest 5 min. This redistributes juices for maximum tenderness.\n8. GRAIN: Serve alongside ¬Ω cup '+cn+', prepared while baking.\n9. PLATE: Protein center, vegetables around, grain on side. Drizzle any pan juices over top.\n\n'+bT+'The baking method keeps everything moist and soft. Slice protein thin before eating. Rest period is essential for texture.',cal:cal},
    {name:pn+' Stir-Fry',desc:'Quick stir-fried '+pn+' with '+vn+' over '+cn,
     health:'Quick stir-frying (2-3 minutes) retains up to 80% more vitamins than boiling. Garlic-infused oil is FODMAP-safe because the fructans don\'t transfer to oil ‚Äî safe flavor without the IBS trigger.',
     prep:'PREP TIME: 10 min | COOK: 8 min | TOTAL: 18 min\n\n1. SLICE THIN: Cut '+pn+' into very thin strips (‚Öõ-inch). Thinner = faster cook = more tender. This is the most important step for bypass patients.\n2. MARINATE (optional): Toss strips with 1T tamari, ¬Ωt ginger, ¬Ωt sesame oil. Let sit 5 min while prepping veg.\n3. VEG PREP: Slice '+vn+' into thin, uniform strips. Uniform = even cooking.\n4. WOK HEAT: Heat '+fn+' in wok or large skillet over medium-high until shimmering (not smoking).\n5. PROTEIN: Add '+pn+' strips in a single layer. Don\'t crowd ‚Äî cook in batches if needed. Sear 2 min, flip, 1 min more. Remove to plate.\n6. VEGETABLES: Same wok, add '+vn+'. Toss constantly for 2-3 min until bright and tender-crisp.\n7. COMBINE: Return '+pn+' to wok. Add sauce (tamari + ginger + rice vinegar). Toss 30 seconds.\n8. PLATE: Serve over ¬Ω cup '+cn+'. Garnish with sesame seeds and green onion tops.\n\n'+bT+'The thin-slicing technique is essential. Thick pieces can cause food to stick in the pouch. Always slice against the grain.',cal:cal},
    {name:'Slow-Cooked '+pn,desc:pn+' slow-cooked with '+vn+', herbs, served over '+cn,
     health:'Slow cooking breaks down tough connective tissue into gelatin, making proteins incredibly tender and easy to digest. The low, slow method is considered the gold standard for post-bariatric cooking.',
     prep:'PREP TIME: 10 min | COOK: 4-6 hours | TOTAL: ~4-6 hours (mostly hands-off)\n\n1. PREP: Cut '+pn+' into large pieces (they\'ll shred later). Season generously with: salt, pepper, smoked paprika, cumin, dried thyme.\n2. SEAR (optional but worth it): Heat '+fn+' in a skillet. Sear '+pn+' pieces 2 min per side for deep flavor. Transfer to slow cooker.\n3. VEGETABLES: Cut '+vn+' into chunks. Layer on top of and around '+pn+'.\n4. LIQUID: Add ¬Ω cup low-sodium broth (chicken, beef, or vegetable). Add a bay leaf and a sprig of fresh thyme.\n5. COOK: Cover. Set to LOW for 5-6 hours or HIGH for 3-4 hours. Protein should be fall-apart tender.\n6. SHRED: Use two forks to shred '+pn+' directly in the slow cooker. Mix with juices.\n7. GRAIN: Cook '+cn+' during the last 30 min.\n8. SERVE: Ladle shredded '+pn+' and '+vn+' over ¬Ω cup '+cn+'. Spoon some cooking liquid over the top.\n9. STORE: This makes excellent leftovers ‚Äî reheat gently with a splash of broth.\n\n'+bT+'Slow-cooked proteins are the EASIEST to digest post-bypass. The fall-apart texture naturally prevents large pieces from causing issues.',cal:cal},
    {name:chn+'-Stuffed '+pn,desc:pn+' stuffed with '+vn+' and '+chn+', baked golden',
     health:'Stuffed proteins are naturally portion-controlled ‚Äî one piece = one meal. Cheese inside provides calcium (1500mg/day needed post-bypass) with virtually zero lactose in aged varieties.',
     prep:'PREP TIME: 15 min | COOK: 25 min | TOTAL: 40 min\n\n1. PREHEAT: Oven to 375¬∞F. Prepare a baking dish with '+fn+' to prevent sticking.\n2. BUTTERFLY: Place '+pn+' on cutting board. Slice horizontally through the middle, stopping ¬æ of the way through. Open like a book.\n3. POUND: If thick, cover with plastic wrap and gently pound to even ¬Ω-inch thickness. Even thickness = even cooking.\n4. FILLING: Saut√© '+vn+' in '+fn+' for 2 min until wilted. Season with salt, pepper, pinch of nutmeg. Let cool 1 min.\n5. STUFF: Layer saut√©ed '+vn+' on one half of '+pn+'. Top with '+chn+' (sliced thin or crumbled). Fold the other half over.\n6. SECURE: Use 2-3 toothpicks or tie with kitchen twine to hold shut during baking.\n7. SEASON OUTSIDE: Brush with '+fn+', season with salt, pepper, herbs.\n8. BAKE: 22-28 min until internal temp reaches safe level and '+chn+' is melted inside.\n9. REST: 5 min. Remove toothpicks. Slice in half to show the melted '+chn+' center.\n10. SIDE: Serve with ¬Ω cup '+cn+' and any remaining '+vn+'.\n\n'+bT+'Slice the stuffed '+pn+' into thin rounds for easier bypass portions. The melted cheese inside keeps every bite moist.',cal:cal},
    {name:pn+' Sheet Pan Dinner',desc:'One-pan roasted '+pn+' with '+vn+', '+cn+', '+fn,
     health:'Sheet pan cooking concentrates flavors through caramelization while requiring minimal added fat. The Maillard reaction creates deep, satisfying flavors that make healthy bypass eating enjoyable long-term.',
     prep:'PREP TIME: 12 min | COOK: 25 min | TOTAL: 37 min\n\n1. PREHEAT: Oven to 425¬∞F. Line a large sheet pan with parchment paper.\n2. CUT EVENLY: Cut '+vn+' into similar-sized pieces so everything finishes at the same time. Harder vegetables (root veg) = smaller pieces.\n3. TOSS VEG: In a bowl, toss '+vn+' with '+fn+' (1T), salt, pepper, and your choice of dried herbs (rosemary, thyme, or Italian blend).\n4. SPREAD: Arrange '+vn+' on sheet pan in a single layer. Crowding = steaming instead of roasting.\n5. ROAST VEG: Place in oven for 10 min to get a head start on harder vegetables.\n6. PREP PROTEIN: While veg roasts, season '+pn+' with paprika, garlic powder, salt, pepper. Brush with '+fn+'.\n7. ADD PROTEIN: Remove pan, push veg to sides, place '+pn+' in center. Return to oven 15-18 min.\n8. CHECK: '+pn+' done when it reaches safe temp. Veg should be golden and caramelized.\n9. REST & SERVE: Rest 5 min. Serve with ¬Ω cup '+cn+'. Top with '+chn+' shavings.\n\n'+bT+'One sheet pan = one mess. Batch cook 2-3 days of portions. Leftovers reheat well at 300¬∞F for 10 min.',cal:cal},
    {name:sdn+' Pizza Night',desc:'Thin '+sdn+' base with '+pn+', '+vn+', '+chn,
     health:'Sourdough pizza satisfies cravings while being bypass-safe. The fermented base has 90% fewer FODMAPs than regular pizza dough, and thin crust means more protein-to-bread ratio.',
     prep:'PREP TIME: 10 min | COOK: 12 min | TOTAL: 22 min\n\n1. PREHEAT: Oven to 425¬∞F with a baking sheet inside (hot pan = crispy crust).\n2. PREP DOUGH: Roll or press '+sdn+' dough very thin (‚Öõ-inch). Thinner = crispier = easier to digest.\n3. SAUCE: Brush with '+fn+' (no tomato sauce if acidic foods trigger symptoms, otherwise thin layer is fine).\n4. PROTEIN: Slice or dice '+pn+' very small. Pre-cook if raw ‚Äî pizza oven time is short.\n5. VEG: Slice '+vn+' thin. Pat dry to prevent soggy pizza.\n6. ASSEMBLE: Layer in order: sauce/oil ‚Üí '+chn+' (half) ‚Üí '+pn+' ‚Üí '+vn+' ‚Üí remaining '+chn+'.\n7. BAKE: Carefully slide onto hot sheet pan. Bake 10-12 min until crust is golden and cheese is bubbly.\n8. COOL: Let stand 3-4 min. Cut into small squares (not wedges) ‚Äî easier bypass portions.\n\n'+bT+'Two small squares = one bypass meal. Cut small, eat slowly. Enjoy the normalcy of pizza night without overdoing it.',cal:cal}
  ],
  snacks:[
    {name:chn+' & '+frn+' Plate',desc:chn+' slices + '+frn+' + '+fn+' drizzle',
     health:'Aged cheese is naturally low-lactose (fermentation consumes the lactose). Protein between meals prevents the muscle loss that affects 35% of bypass patients in the first year.',
     prep:'PREP TIME: 3 min\n\n1. Slice '+chn+' thin ‚Äî about 1 oz (size of 4 dice).\n2. Wash and portion '+frn+' ‚Äî about ¬Ω cup.\n3. Arrange on a small plate. Drizzle '+fn+' over cheese.\n4. Eat cheese first (protein), then '+frn+'.\n5. Take 10 min to finish this small snack.\n\n'+bT+'Snacks should be 100-150 calories max. This combo delivers protein + vitamins + healthy fat in a bypass-perfect portion.',cal:Math.round(cal*0.5)},
    {name:dsn+' + '+frn+' Treat',desc:'Small portion '+dsn+' paired with '+frn,
     health:'Dark chocolate (85%+) is low-FODMAP and contains flavanols that improve blood flow and mood. A small controlled treat prevents the deprivation that leads to unhealthy binging.',
     prep:'PREP TIME: 2 min\n\n1. Portion '+dsn+' ‚Äî keep to recommended serving size only.\n2. Wash and prep '+frn+'.\n3. Alternate small bites of '+dsn+' with '+frn+'.\n4. Let each bite melt/dissolve ‚Äî don\'t gulp.\n\n'+bT+'With bypass, even small amounts of sugar can trigger dumping syndrome. 85%+ dark chocolate is safe because sugar content is minimal.',cal:Math.round(cal*0.5)},
    {name:gfn+' + '+chn+' Snack',desc:gfn+' topped with '+chn,
     health:'GF crackers avoid the wheat fructans that trigger IBS bloating. Pairing with aged cheese adds 6-8g protein, sustaining energy for 2-3 hours between meals.',
     prep:'PREP TIME: 2 min\n\n1. Lay out 4-6 '+gfn+' on a plate.\n2. Top each with a thin slice or crumble of '+chn+'.\n3. Optional: tiny drop of '+fn+' or mustard on each.\n4. Eat one at a time, chewing thoroughly.\n\n'+bT+'This is a perfect "bridge" snack between meals. The crunch satisfies, the cheese delivers protein.',cal:Math.round(cal*0.5)},
    {name:pbn+' Cup',desc:pbn+' topped with '+frn+' and '+fn,
     health:'Regular probiotic intake reduces IBS symptom severity by 40-60% in clinical studies. '+pbn+' provides both probiotics and protein ‚Äî a double benefit post-bypass.',
     prep:'PREP TIME: 2 min\n\n1. Portion ¬Ω cup '+pbn+' into a small bowl.\n2. Top with ¬º cup '+frn+'.\n3. Drizzle with '+fn+'.\n4. Optional: 1 tsp chia or flax seeds for fiber.\n5. Eat slowly with a small spoon.\n\n'+bT+'Cold, smooth foods like '+pbn+' are well-tolerated even on days when the pouch feels tight. Always have this as a backup snack.',cal:Math.round(cal*0.5)},
    {name:pn+' Roll-Ups',desc:'Thin '+pn+' rolled with '+chn+' and '+vn,
     health:'Protein-based snacks are ideal post-bypass. This no-bread option delivers 12-18g protein per serving while being easy to portion and transport.',
     prep:'PREP TIME: 5 min\n\n1. Use thin deli-style '+pn+' slices (or slice cooked '+pn+' very thin).\n2. Place a thin strip of '+chn+' and a few pieces of '+vn+' on each slice.\n3. Roll up tightly. Secure with a toothpick if needed.\n4. Make 3-4 roll-ups per snack.\n5. Eat slowly, removing toothpicks first!\n\n'+bT+'These are one of the best bypass snacks ‚Äî portable, protein-rich, no cooking needed. Great for work or travel.',cal:Math.round(cal*0.5)}
  ]};
  var pool=meals[type]||meals.breakfast;
  return pool[Math.floor(Math.random()*pool.length)];
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FOOD PANEL ‚Äî standalone component with N/A
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function FoodPanel(props){
  var catKey=props.catKey,cat=DB[catKey],sel=props.sel,onToggle=props.onToggle,onSelAll=props.onSelAll,onClrAll=props.onClrAll,onToggleNA=props.onToggleNA,search=props.search,t=props.t;
  if(!cat)return null;
  var selectedInCat=(sel[catKey]||[]);var cnt=selectedInCat.length;var total=flatDB(cat).length;var sLow=search?search.toLowerCase():'';
  var catNAid='na-'+catKey;var catNAactive=false;
  for(var ni=0;ni<selectedInCat.length;ni++){if(selectedInCat[ni].id===catNAid){catNAactive=true;break;}}
  var subKeys=Object.keys(cat.subs);var sections=[];
  for(var si=0;si<subKeys.length;si++){
    var subName=subKeys[si];var subItems=cat.subs[subName];
    var filtered=sLow?subItems.filter(function(itm){return itm.n.toLowerCase().indexOf(sLow)>=0;}):subItems;
    if(!filtered.length)continue;
    var subNAid='na-'+catKey+'-'+si;var subNAactive=false;
    for(var sni=0;sni<selectedInCat.length;sni++){if(selectedInCat[sni].id===subNAid){subNAactive=true;break;}}
    var buttons=[h('button',{key:subNAid,onClick:onToggleNA.bind(null,catKey,{id:subNAid,n:'N/A',cal:0,pro:0,crb:0,fat:0,na:true}),style:{padding:'6px 14px',borderRadius:100,fontSize:12,fontWeight:subNAactive?600:400,border:'1.5px solid '+(subNAactive?P.bark:P.warm),background:subNAactive?P.bark+'18':'transparent',color:subNAactive?P.bark:P.warm,whiteSpace:'nowrap',display:'inline-flex',alignItems:'center',gap:4,marginBottom:4,fontStyle:'italic'}},subNAactive?h('span',{style:{fontSize:10}},'‚úì'):null,'üö´ N/A')];
    for(var bi=0;bi<filtered.length;bi++){
      var item=filtered[bi];var isSelected=false;
      for(var si2=0;si2<selectedInCat.length;si2++){if(selectedInCat[si2].id===item.id){isSelected=true;break;}}
      buttons.push(h('button',{key:item.id,onClick:onToggle.bind(null,catKey,item),style:{padding:'6px 14px',borderRadius:100,fontSize:12,fontWeight:isSelected?600:400,border:'1.5px solid '+(isSelected?cat.clr:P.stone),background:isSelected?cat.clr+'15':'transparent',color:isSelected?cat.clr:P.bark,whiteSpace:'nowrap',display:'inline-flex',alignItems:'center',gap:4,marginBottom:4,opacity:catNAactive?.4:1}},isSelected?h('span',{style:{fontSize:10}},'‚úì'):null,item.n,item.cal>0?h('span',{style:{fontSize:9,opacity:.35,marginLeft:2}},item.cal):null));
    }
    sections.push(h('div',{key:subName,style:{marginBottom:16}},h('div',{style:{fontSize:10,fontWeight:600,color:P.bark,textTransform:'uppercase',letterSpacing:'.04em',marginBottom:8,paddingBottom:4,borderBottom:'1px solid '+P.stone}},subName),h('div',{style:{display:'flex',flexWrap:'wrap',gap:6}},buttons)));
  }
  return h('div',{style:{padding:'14px 20px 20px'}},
    h('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14,flexWrap:'wrap',gap:6}},
      h('div',{style:{display:'flex',alignItems:'center',gap:6}},h('span',{style:{fontSize:22}},cat.ico),h('span',{style:{fontSize:16,fontWeight:600,color:cat.clr,fontFamily:"'Fraunces',serif"}},t[cat.k]),h('span',{style:{fontSize:12,color:P.bark,fontWeight:500}},cnt+'/'+total)),
      h('div',{style:{display:'flex',gap:5,flexWrap:'wrap'}},
        h('button',{onClick:function(){onToggleNA(catKey,{id:catNAid,n:'N/A ‚Äî Skip Category',cal:0,na:true});},style:{padding:'5px 12px',borderRadius:8,fontSize:11,fontWeight:catNAactive?700:600,background:catNAactive?P.bark+'22':P.sand,color:catNAactive?P.ink:P.bark,border:'1.5px solid '+(catNAactive?P.bark:P.warm)}},(catNAactive?'‚úì ':'')+'üö´ N/A'),
        h('button',{onClick:function(){onSelAll(catKey);},style:{padding:'5px 12px',borderRadius:8,fontSize:11,fontWeight:600,background:cat.clr+'15',color:cat.clr,border:'1px solid '+cat.clr+'40'}},t.allBtn),
        cnt>0?h('button',{onClick:function(){onClrAll(catKey);},style:{padding:'5px 12px',borderRadius:8,fontSize:11,fontWeight:600,background:P.cL,color:P.coral,border:'1px solid '+P.coral+'40'}},t.clrBtn):null)),
    catNAactive?h('div',{style:{background:P.sand,borderRadius:12,padding:'10px 16px',marginBottom:14,display:'flex',alignItems:'center',gap:8}},h('span',{style:{fontSize:16}},'üö´'),h('span',{style:{fontSize:13,color:P.bark,fontStyle:'italic'}},'Category marked N/A ‚Äî defaults used in meal plans'),h('button',{onClick:function(){onToggleNA(catKey,{id:catNAid,n:'N/A',cal:0,na:true});},style:{marginLeft:'auto',padding:'4px 10px',borderRadius:8,fontSize:11,color:P.coral,border:'1px solid '+P.coral+'40',background:P.cL}},'Remove')):null,
    sections.length>0?sections:h('p',{style:{fontSize:13,color:P.warm,textAlign:'center',padding:20}},'No matches'));
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN APP
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function App(){
  var _v=useState('plan'),view=_v[0],setView=_v[1];
  var _l=useState('en'),lang=_l[0],setLang=_l[1];
  var _lo=useState(false),lo=_lo[0],setLo=_lo[1];
  var _pr=useState(function(){try{return JSON.parse(localStorage.getItem('gw-prof'));}catch(e){return null;}}),profile=_pr[0],setProfile=_pr[1];
  var _sp=useState(true),showProf=_sp[0],setShowProf=_sp[1];
  var _pf=useState({sex:'male',age:'',weight:'',htFt:'',htIn:'',htCm:'',unit:'imperial'}),pf=_pf[0],setPf=_pf[1];
  var _go=useState(function(){return localStorage.getItem('gw-goal')||'maintain';}),goal=_go[0],setGoal=_go[1];
  var _sl=useState({}),sel=_sl[0],setSel=_sl[1];
  var _mn=useState(null),menu=_mn[0],setMenu=_mn[1];
  var _hi=useState(function(){try{return JSON.parse(localStorage.getItem('gw5'))||[];}catch(e){return[];}}),hist=_hi[0],setHist=_hi[1];
  var _ga=useState(false),ga=_ga[0],setGa=_ga[1];
  var _ex=useState({}),ex=_ex[0],setEx=_ex[1];
  var _ac=useState('proteins'),activeCat=_ac[0],setActiveCat=_ac[1];
  var _sr=useState(''),search=_sr[0],setSearch=_sr[1];
  var _gs=useState(null),goSec=_gs[0],setGoSec=_gs[1];
  var t=TX[lang];
  useEffect(function(){if(profile)setShowProf(false);},[]);
  var sH=function(hh){try{localStorage.setItem('gw5',JSON.stringify(hh));}catch(e){}};
  var saveGoal=function(g){setGoal(g);localStorage.setItem('gw-goal',g);};
  var doCalc=function(){
    var sex=pf.sex,age=pf.age,weight=pf.weight,htFt=pf.htFt,htIn=pf.htIn,htCm=pf.htCm,unit=pf.unit;
    if(!age||!weight)return;var wk,hc;
    if(unit==='imperial'){wk=parseFloat(weight)*0.453592;hc=(parseFloat(htFt||0)*12+parseFloat(htIn||0))*2.54;}
    else{wk=parseFloat(weight);hc=parseFloat(htCm);}
    if(!wk||!hc||hc<50)return;
    var bmi=Math.round(calcBMI(wk,hc)*10)/10,bmr=Math.round(calcBMR(sex,wk,hc,parseInt(age))),tdee=calcTDEE(bmr);
    var prof={sex:sex,age:parseInt(age),wtKg:Math.round(wk*10)/10,htCm:Math.round(hc*10)/10,bmi:bmi,bmr:bmr,tdee:tdee,unit:unit,wtO:weight,htFO:htFt,htIO:htIn,htCO:htCm};
    setProfile(prof);localStorage.setItem('gw-prof',JSON.stringify(prof));setShowProf(false);
  };
  var targetCal=profile?goalCal(profile.tdee,goal):1600;var macros=macroSplit(targetCal,goal);var perMeal=Math.round(targetCal/5);

  var tog=function(catKey,item){setSel(function(prev){var arr=prev[catKey]||[];var catNAid='na-'+catKey;var cleaned=[];var found=false;for(var i=0;i<arr.length;i++){if(arr[i].id===catNAid)continue;if(arr[i].id===item.id){found=true;continue;}cleaned.push(arr[i]);}if(!found)cleaned.push(item);var out={};for(var k in prev)out[k]=prev[k];out[catKey]=cleaned;return out;});};
  var togNA=function(catKey,naItem){setSel(function(prev){var arr=prev[catKey]||[];var catNAid='na-'+catKey;var isCatLevel=naItem.id===catNAid;var alreadyActive=false;for(var i=0;i<arr.length;i++){if(arr[i].id===naItem.id){alreadyActive=true;break;}}var next;if(alreadyActive){next=arr.filter(function(x){return x.id!==naItem.id;});}else if(isCatLevel){next=[naItem];}else{next=arr.filter(function(x){return x.id!==catNAid;});next.push(naItem);}var out={};for(var k in prev)out[k]=prev[k];out[catKey]=next;return out;});};
  var ts=0;var selKeys=Object.keys(sel);for(var si=0;si<selKeys.length;si++)ts+=sel[selKeys[si]].length;
  var hm=function(){return(sel.proteins&&sel.proteins.length>0)&&(sel.carbs&&sel.carbs.length>0)&&(sel.vegetables&&sel.vegetables.length>0);};
  var selAll=function(ck){setSel(function(prev){var out={};for(var k in prev)out[k]=prev[k];out[ck]=flatDB(DB[ck]);return out;});};
  var clrAll=function(ck){setSel(function(prev){var out={};for(var k in prev)out[k]=prev[k];out[ck]=[];return out;});};
  var catCnt=function(ck){return sel[ck]?sel[ck].length:0;};
  var te=function(k){setEx(function(prev){var out={};for(var kk in prev)out[kk]=prev[kk];out[k]=!prev[k];return out;});};
  var mK=['breakfast','lunch','dinner','snack1','snack2'];
  var mTypes=['breakfast','lunch','dinner','snacks','snacks'];
  var mL=[t.bf,t.lu,t.di,t.s1,t.s2];

  /* SWAP a single meal */
  var swapMeal=function(dayIdx,mealKey,mealType){
    if(!menu)return;
    var newMeal=genMeal(mealType,sel,perMeal);
    var newWeek=menu.week.map(function(day,i){
      if(i!==dayIdx)return day;
      var updated={};for(var k in day)updated[k]=day[k];
      updated[mealKey]=newMeal;
      return updated;
    });
    setMenu(Object.assign({},menu,{week:newWeek}));
  };

  var doGen=function(){setGa(true);setEx({});setTimeout(function(){
    var days=['mo','tu','we','th','fr','sa','su'].map(function(d){return t[d];});
    var wm=days.map(function(day){return{day:day,breakfast:genMeal('breakfast',sel,perMeal),lunch:genMeal('lunch',sel,perMeal),dinner:genMeal('dinner',sel,perMeal),snack1:genMeal('snacks',sel,perMeal),snack2:genMeal('snacks',sel,perMeal)};});
    var supps=(sel.supplements||[]).map(function(s){return{name:s.n,note:s.note};});
    setMenu({week:wm,supps:supps,targetCal:targetCal,goal:goal,macros:macros});setGa(false);
  },500);};
  var doSave=function(){if(!menu)return;var en={id:Date.now(),wO:new Date().toLocaleDateString(),menu:menu.week,supps:menu.supps,no:'',tr:{},targetCal:targetCal,goal:goal};var u=[en].concat(hist);setHist(u);sH(u);};
  var tTr=function(hid,d,m){setHist(function(prev){var u=prev.map(function(hh){if(hh.id!==hid)return hh;var nt={};for(var kk in hh.tr)nt[kk]=hh.tr[kk];nt[d+'-'+m]=!hh.tr[d+'-'+m];return Object.assign({},hh,{tr:nt});});sH(u);return u;});};
  var uN=function(hid,v){setHist(function(prev){var u=prev.map(function(hh){return hh.id===hid?Object.assign({},hh,{no:v}):hh;});sH(u);return u;});};
  var dH=function(hid){setHist(function(prev){var u=prev.filter(function(hh){return hh.id!==hid;});sH(u);return u;});};

  var langs=[{c:'en',l:'English',f:'üá∫üá∏'},{c:'es',l:'Espa√±ol',f:'üá™üá∏'},{c:'fr',l:'Fran√ßais',f:'üá´üá∑'},{c:'it',l:'Italiano',f:'üáÆüáπ'}];
  var curLang=langs.filter(function(l){return l.c===lang;})[0];
  var Inp=function(pr){return h('input',Object.assign({},{style:Object.assign({width:'100%',padding:'12px 16px',borderRadius:12,border:'1.5px solid '+P.stone,background:P.white,fontSize:15,color:P.ink},pr.sx||{})},pr));};
  var gc={lose:{l:t.goalLose,c:P.coral,i:'üìâ',d:t.goalLoseD},maintain:{l:t.goalMaint,c:P.green,i:'‚öñÔ∏è',d:t.goalMaintD},gain:{l:t.goalGain,c:P.sky,i:'üìà',d:t.goalGainD}};

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RENDER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  return h('div',{style:{minHeight:'100vh',background:P.cream}},
    h('header',{style:{background:P.white+'EE',borderBottom:'1px solid '+P.stone,position:'sticky',top:0,zIndex:100,backdropFilter:'blur(20px)'}},
      h('div',{style:{maxWidth:1200,margin:'0 auto',padding:'10px 20px',display:'flex',alignItems:'center',justifyContent:'space-between',gap:10,flexWrap:'wrap'}},
        h('div',{style:{display:'flex',alignItems:'center',gap:8}},
          h('div',{style:{width:34,height:34,borderRadius:10,background:'linear-gradient(135deg,'+P.green+','+P.gD+')',display:'flex',alignItems:'center',justifyContent:'center',fontSize:16}},'üåø'),
          h('div',null,h('div',{style:{fontFamily:"'Fraunces',serif",fontSize:18,fontWeight:700,color:P.green}},t.brand),h('div',{style:{fontSize:9,color:P.bark,textTransform:'uppercase',fontWeight:500}},t.tag))),
        h('div',{style:{display:'flex',gap:6,alignItems:'center',flexWrap:'wrap'}},
          h('nav',{style:{display:'flex',gap:3,background:P.sand,borderRadius:100,padding:3}},
            [{k:'guide',l:t.tG},{k:'plan',l:t.tP},{k:'hist',l:t.tH}].map(function(tab){return h('button',{key:tab.k,onClick:function(){setView(tab.k);},style:{padding:'7px 16px',borderRadius:100,fontSize:12,fontWeight:view===tab.k?600:400,color:view===tab.k?P.white:P.earth,background:view===tab.k?P.green:'transparent'}},tab.l);})),
          h('div',{style:{position:'relative'}},
            h('button',{onClick:function(){setLo(!lo);},style:{display:'flex',alignItems:'center',gap:4,padding:'6px 12px',borderRadius:100,background:P.sand,fontSize:12,color:P.earth}},curLang.f,' ',curLang.l),
            lo?h('div',{style:{position:'absolute',top:'calc(100%+4px)',right:0,background:P.white,border:'1px solid '+P.stone,borderRadius:14,boxShadow:'0 12px 40px rgba(0,0,0,.1)',minWidth:140,zIndex:200}},langs.map(function(o){return h('button',{key:o.c,onClick:function(){setLang(o.c);setLo(false);setMenu(null);},style:{width:'100%',padding:'10px 14px',background:lang===o.c?P.gL:'transparent',color:lang===o.c?P.green:P.earth,fontSize:13,fontWeight:lang===o.c?600:400,display:'flex',gap:6,alignItems:'center'}},o.f,' ',o.l);})):null)))),
    h('main',{style:{maxWidth:1200,margin:'0 auto',padding:'18px 18px'}},
      /* GUIDE */
      view==='guide'?h('div',{className:'au'},
        h('div',{style:{background:P.white,borderRadius:20,border:'1px solid '+P.stone,marginBottom:20}},h('div',{style:{padding:'24px 22px',background:'linear-gradient(135deg,'+P.gL+','+P.white+')'}},h('h2',{style:{fontSize:20,color:P.green,marginBottom:6}},t.ibsT+' & '+t.bypT),h('p',{style:{fontSize:13.5,color:P.bark,lineHeight:1.7,maxWidth:700}},t.gI))),
        [{k:'ibs',ti:t.ibsT,ic:'üî¨',clr:P.green,bg:P.gL,panels:[{t:t.avT,i:'‚õî',bg:P.cL,c:P.coral,list:t.ibsA},{t:t.saT,i:'‚úÖ',bg:P.gL,c:P.green,list:t.ibsS}]},{k:'byp',ti:t.bypT,ic:'üè•',clr:P.sky,bg:P.sL,panels:[{t:t.ruT,i:'üìå',bg:P.sL,c:P.sky,list:t.bypR},{t:t.caT,i:'‚ö†Ô∏è',bg:P.aL,c:P.amber,list:t.bypC}]}].map(function(sec){return h('div',{key:sec.k,style:{background:P.white,borderRadius:20,border:'1px solid '+P.stone,marginBottom:14}},h('button',{onClick:function(){setGoSec(goSec===sec.k?null:sec.k);},style:{width:'100%',padding:'14px 20px',display:'flex',justifyContent:'space-between',alignItems:'center',background:sec.bg,borderRadius:goSec===sec.k?'20px 20px 0 0':'20px'}},h('span',{style:{fontSize:15,fontFamily:"'Fraunces',serif",fontWeight:600,color:sec.clr}},sec.ic,' ',sec.ti),h('span',{style:{fontSize:14,transform:goSec===sec.k?'rotate(180deg)':'',transition:'.3s',color:sec.clr}},'‚ñæ')),goSec===sec.k?h('div',{style:{padding:'14px 20px',display:'grid',gridTemplateColumns:'1fr 1fr',gap:14},className:'grid-r as'},sec.panels.map(function(p){return h('div',{key:p.t,style:{background:p.bg,borderRadius:14,padding:'14px 16px'}},h('h4',{style:{fontSize:13,color:p.c,marginBottom:8,fontFamily:"'Fraunces',serif"}},p.i,' ',p.t),p.list.map(function(it,i){return h('p',{key:i,style:{fontSize:12.5,color:P.earth,lineHeight:1.65,margin:'4px 0',paddingLeft:14,position:'relative'}},h('span',{style:{position:'absolute',left:0,color:p.c,fontWeight:700}},'¬∑'),it);}));})):null);})):null,
      /* PLANNER */
      view==='plan'?h('div',null,
        /* PROFILE */
        !showProf&&profile?h('div',{className:'au',style:{marginBottom:20}},h('div',{style:{background:P.white,borderRadius:20,border:'1px solid '+P.stone}},h('div',{style:{padding:'14px 20px',display:'flex',alignItems:'center',justifyContent:'space-between',flexWrap:'wrap',gap:12}},h('div',{style:{display:'flex',alignItems:'center',gap:14,flexWrap:'wrap'}},h('div',{style:{width:52,height:52,borderRadius:'50%',background:bmiCat(profile.bmi,t).bg,border:'3px solid '+bmiCat(profile.bmi,t).c,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center'}},h('span',{style:{fontSize:15,fontWeight:700,color:bmiCat(profile.bmi,t).c,lineHeight:1}},profile.bmi),h('span',{style:{fontSize:7,color:bmiCat(profile.bmi,t).c,fontWeight:600,textTransform:'uppercase'}},'BMI')),h('div',null,h('div',{style:{fontSize:9,color:P.bark,fontWeight:600,textTransform:'uppercase'}},t.catLabel),h('div',{style:{fontSize:13,fontWeight:700,color:bmiCat(profile.bmi,t).c}},bmiCat(profile.bmi,t).l)),h('div',null,h('div',{style:{fontSize:9,color:P.bark,fontWeight:600,textTransform:'uppercase'}},t.tdeeLabel),h('div',{style:{fontSize:13,fontWeight:700,color:P.green}},profile.tdee+' kcal')),h('div',null,h('div',{style:{fontSize:9,color:P.bark,fontWeight:600,textTransform:'uppercase'}},t.targetLabel),h('div',{style:{fontSize:13,fontWeight:700,color:gc[goal].c}},targetCal+' kcal')),h('div',null,h('div',{style:{fontSize:9,color:P.bark,fontWeight:600,textTransform:'uppercase'}},t.mealLabel),h('div',{style:{fontSize:13,fontWeight:700,color:P.earth}},perMeal+' kcal'))),h('div',{style:{display:'flex',gap:6,alignItems:'center',flexWrap:'wrap'}},['lose','maintain','gain'].map(function(g){var d=gc[g];var act=goal===g;return h('button',{key:g,onClick:function(){saveGoal(g);},style:{padding:'6px 13px',borderRadius:100,fontSize:11,fontWeight:act?700:400,border:'2px solid '+(act?d.c:P.stone),background:act?d.c+'18':'transparent',color:act?d.c:P.bark}},d.i,' ',d.l);}),h('button',{onClick:function(){setShowProf(true);setPf({sex:profile.sex,age:''+profile.age,weight:profile.wtO||'',htFt:profile.htFO||'',htIn:profile.htIO||'',htCm:profile.htCO||'',unit:profile.unit});},style:{padding:'6px 12px',borderRadius:100,fontSize:11,color:P.bark,border:'1px solid '+P.stone}},'‚úèÔ∏è ',t.editBtn))),h('div',{style:{padding:'8px 20px',background:P.sand,display:'flex',gap:16,flexWrap:'wrap',borderTop:'1px solid '+P.stone}},[{l:t.proLabel,v:macros.pro+'g',c:P.coral},{l:t.carbLabel,v:macros.crb+'g',c:P.amber},{l:t.fatLabel,v:macros.fat+'g',c:P.green},{l:t.fibLabel,v:macros.fib+'g',c:P.plum}].map(function(m){return h('div',{key:m.l,style:{display:'flex',gap:4,alignItems:'center'}},h('span',{style:{fontSize:10,fontWeight:600,color:P.bark}},m.l+':'),h('span',{style:{fontSize:12,fontWeight:700,color:m.c}},m.v));}))))
        :showProf?h('div',{className:'au',style:{marginBottom:20}},h('div',{style:{background:P.white,borderRadius:24,border:'1px solid '+P.stone,boxShadow:'0 8px 32px rgba(0,0,0,.06)'}},h('div',{style:{padding:'28px 24px',background:'linear-gradient(135deg,'+P.gL+','+P.white+')'}},h('div',{style:{display:'flex',alignItems:'center',gap:14,marginBottom:20}},h('div',{style:{width:50,height:50,borderRadius:16,background:'linear-gradient(135deg,'+P.green+','+P.gD+')',display:'flex',alignItems:'center',justifyContent:'center',fontSize:22}},'üßÆ'),h('div',null,h('h2',{style:{fontSize:22,color:P.green,margin:0}},t.profTitle),h('p',{style:{fontSize:13,color:P.bark,margin:0}},t.profSub))),h('div',{style:{display:'flex',gap:6,marginBottom:18}},['imperial','metric'].map(function(u){return h('button',{key:u,onClick:function(){setPf(Object.assign({},pf,{unit:u}));},style:{padding:'8px 20px',borderRadius:100,fontSize:13,fontWeight:pf.unit===u?600:400,border:'2px solid '+(pf.unit===u?P.green:P.stone),background:pf.unit===u?P.gL:'transparent',color:pf.unit===u?P.green:P.bark}},t[u]);})),h('div',{className:'prof-grid',style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16}},h('div',null,h('label',{style:{fontSize:12,fontWeight:600,color:P.bark,display:'block',marginBottom:6}},t.sexLbl),h('div',{style:{display:'flex',gap:8}},['male','female'].map(function(s){return h('button',{key:s,onClick:function(){setPf(Object.assign({},pf,{sex:s}));},style:{flex:1,padding:'11px',borderRadius:12,fontSize:14,fontWeight:pf.sex===s?600:400,border:'2px solid '+(pf.sex===s?P.green:P.stone),background:pf.sex===s?P.gL:P.white,color:pf.sex===s?P.green:P.earth}},s==='male'?'‚ôÇ ':'‚ôÄ ',t[s]);}))),h('div',null,h('label',{style:{fontSize:12,fontWeight:600,color:P.bark,display:'block',marginBottom:6}},t.ageLbl),Inp({type:'number',placeholder:'35',value:pf.age,onChange:function(ev){setPf(Object.assign({},pf,{age:ev.target.value}));},min:18,max:100})),h('div',null,h('label',{style:{fontSize:12,fontWeight:600,color:P.bark,display:'block',marginBottom:6}},t.wtLbl+' ('+t[pf.unit==='imperial'?'lbs':'kg']+')'),Inp({type:'number',placeholder:pf.unit==='imperial'?'185':'84',value:pf.weight,onChange:function(ev){setPf(Object.assign({},pf,{weight:ev.target.value}));}})),h('div',null,h('label',{style:{fontSize:12,fontWeight:600,color:P.bark,display:'block',marginBottom:6}},t.htLbl+(pf.unit==='imperial'?' ('+t.ft+'/'+t.inches+')':' ('+t.cm+')')),pf.unit==='imperial'?h('div',{style:{display:'flex',gap:8}},Inp({type:'number',placeholder:t.ft,value:pf.htFt,onChange:function(ev){setPf(Object.assign({},pf,{htFt:ev.target.value}));},sx:{flex:1,width:'auto'}}),Inp({type:'number',placeholder:t.inches,value:pf.htIn,onChange:function(ev){setPf(Object.assign({},pf,{htIn:ev.target.value}));},sx:{flex:1,width:'auto'}})):Inp({type:'number',placeholder:'175',value:pf.htCm,onChange:function(ev){setPf(Object.assign({},pf,{htCm:ev.target.value}));}}))),h('div',{style:{marginTop:20,display:'flex',justifyContent:'center',gap:10}},h('button',{onClick:doCalc,style:{padding:'14px 44px',borderRadius:100,fontSize:16,fontWeight:700,color:P.white,background:'linear-gradient(135deg,'+P.green+','+P.gD+')',boxShadow:'0 6px 24px rgba(76,140,74,.3)'}},t.calcBtn),profile?h('button',{onClick:function(){setShowProf(false);},style:{padding:'14px 18px',borderRadius:100,fontSize:14,color:P.bark,border:'1px solid '+P.stone}},'‚úï'):null)))):null,
        /* INGREDIENT SELECTOR */
        h('div',{style:{background:P.white,borderRadius:20,border:'1px solid '+P.stone,marginBottom:24}},
          h('div',{style:{padding:'16px 20px',borderBottom:'1px solid '+P.stone,display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:10}},h('div',null,h('h2',{style:{fontSize:18,color:P.ink,margin:'0 0 2px'}},t.piT),h('p',{style:{fontSize:12.5,color:P.bark}},t.piD)),ts>0?h('div',{style:{background:P.green,color:P.white,padding:'5px 14px',borderRadius:100,fontSize:12,fontWeight:600}},ts+' '+t.sel):null),
          h('div',{style:{padding:'12px 20px 0'}},h('div',{style:{position:'relative'}},h('input',{type:'text',value:search,onChange:function(ev){setSearch(ev.target.value);},placeholder:'üîç '+t.searchPh,style:{width:'100%',padding:'10px 14px',borderRadius:12,border:'1.5px solid '+P.stone,background:P.cream,fontSize:13,color:P.ink}}),search?h('button',{onClick:function(){setSearch('');},style:{position:'absolute',right:10,top:'50%',transform:'translateY(-50%)',color:P.bark,fontSize:14}},'‚úï'):null)),
          h('div',{style:{padding:'12px 20px 0'}},h('div',{className:'cattabs'},catKeys.map(function(k){var c=DB[k];var n=catCnt(k);var act=activeCat===k;return h('button',{key:k,onClick:function(){setActiveCat(k);},style:{padding:'8px 14px',borderRadius:12,fontSize:11.5,fontWeight:act?600:400,color:act?c.clr:P.bark,background:act?c.bg:P.sand,border:act?'2px solid '+c.clr:'2px solid transparent',whiteSpace:'nowrap',display:'inline-flex',alignItems:'center',gap:4,flexShrink:0}},h('span',{style:{fontSize:15}},c.ico),t[c.k],n>0?h('span',{style:{background:c.clr,color:P.white,fontSize:9,fontWeight:700,borderRadius:100,minWidth:18,height:18,display:'inline-flex',alignItems:'center',justifyContent:'center',padding:'0 4px',marginLeft:2}},n):null);}))),
          h(FoodPanel,{key:activeCat,catKey:activeCat,sel:sel,onToggle:tog,onToggleNA:togNA,onSelAll:selAll,onClrAll:clrAll,search:search,t:t})),
        /* GENERATE */
        h('div',{style:{textAlign:'center',margin:'20px 0'}},h('button',{onClick:doGen,disabled:!hm()||ga,style:{padding:'14px 42px',borderRadius:100,fontSize:15,fontWeight:700,color:hm()?P.white:P.warm,background:hm()?'linear-gradient(135deg,'+P.green+','+P.gD+')':P.sand,boxShadow:hm()?'0 6px 24px rgba(76,140,74,.25)':'none',opacity:ga?.6:1}},ga?'‚è≥ '+t.ging:menu?'üîÑ '+t.regen:'‚ú® '+t.gen),!hm()?h('p',{style:{fontSize:12,color:P.amber,marginTop:8}},t.minW):null),
        /* WEEKLY MENU with SWAP buttons */
        menu?h('div',{className:'au'},
          h('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14,flexWrap:'wrap',gap:8}},h('div',null,h('h2',{style:{fontSize:18,color:P.green,margin:0}},t.mT),h('p',{style:{fontSize:11,color:P.bark,marginTop:2}},'üéØ '+targetCal+' kcal/day ¬∑ '+t.proLabel+': '+macros.pro+'g ¬∑ '+t.carbLabel+': '+macros.crb+'g ¬∑ '+t.fatLabel+': '+macros.fat+'g')),h('button',{onClick:doSave,style:{padding:'9px 22px',borderRadius:100,border:'2px solid '+P.green,color:P.green,fontSize:13,fontWeight:600}},'üíæ '+t.sav)),
          menu.supps&&menu.supps.length>0?h('div',{style:{background:P.sL,border:'1px solid '+P.sky+'33',borderRadius:14,padding:'10px 16px',marginBottom:12,display:'flex',flexWrap:'wrap',gap:5,alignItems:'center'}},h('span',{style:{fontSize:12,fontWeight:600,color:P.sky}},'üíä '+t.sup+':'),menu.supps.map(function(s,i){return h('span',{key:i,style:{background:P.white,padding:'2px 10px',borderRadius:100,fontSize:11,color:P.earth,border:'1px solid '+P.stone}},s.name+(s.note?' ‚Äî '+s.note:''));})):null,
          menu.week.map(function(day,di){
            return h('div',{key:di,className:'au',style:{background:P.white,borderRadius:20,border:'1px solid '+P.stone,marginBottom:10,animationDelay:di*.04+'s'}},
              h('div',{style:{padding:'9px 18px',background:'linear-gradient(135deg,'+P.gL+','+P.white+')',borderBottom:'1px solid '+P.stone,display:'flex',justifyContent:'space-between',alignItems:'center'}},h('h3',{style:{fontSize:14,color:P.green,margin:0}},day.day),h('span',{style:{fontSize:11,color:P.bark,fontWeight:500}},[day.breakfast,day.lunch,day.dinner,day.snack1,day.snack2].reduce(function(a,m){return a+(m?m.cal:0);},0)+' kcal')),
              mK.map(function(mk,mi){
                var meal=day[mk];if(!meal)return null;var ek=di+'-'+mi;var isE=ex[ek];
                return h('div',{key:mk,className:'meal-row'},
                  h('div',{style:{padding:'9px 16px',borderBottom:'1px solid '+(mi<4?P.sand:'transparent'),display:'flex',alignItems:'center',gap:0}},
                    h('div',{onClick:function(){te(ek);},style:{flex:1,cursor:'pointer',display:'flex',justifyContent:'space-between',alignItems:'center'}},
                      h('div',{style:{flex:1,minWidth:0}},
                        h('div',{style:{fontSize:9,color:P.bark,fontWeight:600,textTransform:'uppercase',marginBottom:1}},mL[mi]),
                        h('p',{style:{fontSize:13,fontWeight:600,color:P.ink,margin:0,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}},meal.name)),
                      h('div',{style:{display:'flex',gap:5,alignItems:'center',flexShrink:0,marginLeft:8}},
                        h('span',{style:{fontSize:10,color:P.green,fontWeight:600,background:P.gL,padding:'2px 7px',borderRadius:100}},meal.cal+' kcal'),
                        h('span',{style:{fontSize:11,color:P.bark,transform:isE?'rotate(180deg)':'',transition:'.3s'}},'‚ñæ'))),
                    /* SWAP BUTTON */
                    h('button',{className:'swap-btn',onClick:function(e){e.stopPropagation();swapMeal(di,mk,mTypes[mi]);},style:{marginLeft:8,padding:'4px 10px',borderRadius:8,fontSize:10,fontWeight:600,color:P.sky,background:P.sL,border:'1px solid '+P.sky+'40',whiteSpace:'nowrap',flexShrink:0},title:'Swap this meal only'},'üîÑ '+t.swapBtn)),
                  isE?h('div',{className:'as',style:{padding:'12px 16px',background:P.cream,borderBottom:'1px solid '+P.stone}},
                    h('p',{style:{fontSize:12.5,color:P.earth,marginBottom:10,fontStyle:'italic',lineHeight:1.6}},meal.desc),
                    h('div',{style:{background:P.gL,borderRadius:14,padding:'10px 14px',marginBottom:8}},h('h4',{style:{fontSize:12,color:P.green,margin:'0 0 4px',fontFamily:"'Fraunces',serif"}},'üåø '+t.hlT),h('p',{style:{fontSize:12,color:P.earth,lineHeight:1.7,margin:0}},meal.health)),
                    h('div',{style:{background:P.aL,borderRadius:14,padding:'10px 14px'}},h('h4',{style:{fontSize:12,color:P.amber,margin:'0 0 4px',fontFamily:"'Fraunces',serif"}},'üë®‚Äçüç≥ '+t.prT),h('p',{style:{fontSize:12,color:P.earth,lineHeight:1.7,margin:0,whiteSpace:'pre-line'}},meal.prep))):null);
              }));})
        ):null
      ):null,
      /* HISTORY */
      view==='hist'?h('div',{className:'au'},h('div',{style:{marginBottom:14}},h('h2',{style:{fontSize:18,color:P.ink,marginBottom:3}},t.hT),h('p',{style:{fontSize:12.5,color:P.bark}},t.hD)),hist.length===0?h('div',{style:{background:P.white,borderRadius:20,border:'1px solid '+P.stone,padding:44,textAlign:'center'}},h('div',{style:{fontSize:40,marginBottom:10}},'üìã'),h('p',{style:{fontSize:14,color:P.bark}},t.nH),h('p',{style:{fontSize:12,color:P.warm}},t.nHS)):hist.map(function(entry){var tm=entry.menu.length*5;var dn=0;var trKeys=Object.keys(entry.tr||{});for(var i=0;i<trKeys.length;i++){if(entry.tr[trKeys[i]])dn++;}var pct=Math.round(dn/tm*100);return h('div',{key:entry.id,style:{background:P.white,borderRadius:20,border:'1px solid '+P.stone,marginBottom:14}},h('div',{style:{padding:'11px 18px',borderBottom:'1px solid '+P.stone,display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:8}},h('div',null,h('h3',{style:{fontSize:14,margin:0,fontFamily:"'Fraunces',serif"}},t.wO+' '+entry.wO),h('p',{style:{fontSize:11,color:P.bark,marginTop:2}},dn+'/'+tm+' '+t.oM+' ('+pct+'%)'+(entry.targetCal?' ¬∑ üéØ '+entry.targetCal+' kcal':''))),h('div',{style:{display:'flex',gap:6,alignItems:'center'}},h('div',{style:{width:80,height:6,background:P.sand,borderRadius:100,overflow:'hidden'}},h('div',{style:{width:pct+'%',height:'100%',borderRadius:100,background:pct>=80?P.green:pct>=50?P.amber:P.coral}})),h('button',{onClick:function(){dH(entry.id);},style:{padding:'3px 8px',borderRadius:8,background:P.cL,color:P.coral,fontSize:10,fontWeight:600}},'üóë'))),h('div',{style:{overflowX:'auto'}},h('table',{style:{width:'100%',borderCollapse:'collapse'}},h('thead',null,h('tr',{style:{background:P.sand}},h('th',{style:{padding:'7px 12px',textAlign:'left',fontSize:10,color:P.bark,fontWeight:600}},t.day),mL.map(function(m){return h('th',{key:m,style:{padding:'7px 6px',textAlign:'center',fontSize:10,color:P.bark,fontWeight:600}},m);}))),h('tbody',null,entry.menu.map(function(day){return h('tr',{key:day.day,style:{borderTop:'1px solid '+P.sand}},h('td',{style:{padding:'7px 12px',fontWeight:600,fontSize:11,color:P.ink,whiteSpace:'nowrap'}},day.day),mK.map(function(mk){var k=day.day+'-'+mk;var d=entry.tr?entry.tr[k]:false;return h('td',{key:mk,style:{padding:'5px 6px',textAlign:'center'}},h('button',{onClick:function(){tTr(entry.id,day.day,mk);},style:{width:28,height:28,borderRadius:8,border:'2px solid '+(d?P.green:P.stone),background:d?P.gL:'transparent',color:d?P.green:P.warm,fontSize:13,fontWeight:700,display:'flex',alignItems:'center',justifyContent:'center'}},d?'‚úì':'‚óã'));}));})))),h('div',{style:{padding:'8px 18px',borderTop:'1px solid '+P.sand}},h('label',{style:{fontSize:10,color:P.bark,fontWeight:600,display:'block',marginBottom:3}},'üìù '+t.no),h('textarea',{value:entry.no||'',onChange:function(ev){uN(entry.id,ev.target.value);},placeholder:t.noP,style:{width:'100%',minHeight:38,padding:8,borderRadius:10,border:'1px solid '+P.stone,background:P.cream,color:P.ink,fontSize:12,resize:'vertical'}})));})):null),
    h('footer',{style:{textAlign:'center',padding:'24px 18px',borderTop:'1px solid '+P.stone,marginTop:14}},h('p',{style:{fontSize:11,color:P.warm,maxWidth:600,margin:'0 auto',lineHeight:1.7}},t.disc)));
}
ReactDOM.render(React.createElement(App),document.getElementById('root'));
</script>
</body>
</html>
